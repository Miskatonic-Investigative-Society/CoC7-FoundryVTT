{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/pdfoundry/Api.ts","src/pdfoundry/Main.ts","src/pdfoundry/Setup.ts","src/pdfoundry/Util.ts","src/pdfoundry/app/PDFItemSheet.ts","src/pdfoundry/app/PlayerSelect.ts","src/pdfoundry/cache/CacheError.ts","src/pdfoundry/cache/CacheHelper.ts","src/pdfoundry/cache/PDFCache.ts","src/pdfoundry/common/helpers/events.ts","src/pdfoundry/enricher/HTMLEnricher.ts","src/pdfoundry/enricher/TinyMCEPlugin.ts","src/pdfoundry/settings/I18n.ts","src/pdfoundry/settings/Settings.ts","src/pdfoundry/socket/Socket.ts","src/pdfoundry/socket/events/PreloadEvent.ts","src/pdfoundry/socket/events/SetViewEvent.ts","src/pdfoundry/socket/events/SocketEvent.ts","src/pdfoundry/viewer/Viewer.ts"],"names":[],"mappings":"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","file":"bundle.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { fileExists, getAbsoluteURL, getPDFDataFromItem, validateAbsoluteURL } from './Util';\r\nimport Viewer from './viewer/Viewer';\r\nimport { PDFData } from './common/types/PDFData';\r\nimport Settings from './settings/Settings';\r\nimport PDFCache from './cache/PDFCache';\r\n\r\n/**\r\n * A function to passed to getPDFData to find user specified PDF data.\r\n */\r\ntype ItemComparer = (item: Item) => boolean;\r\n\r\n/**\r\n * Open the specified PDF in a provided viewer\r\n * @param viewer\r\n * @param url\r\n * @param page\r\n * @param cache\r\n * @private\r\n */\r\nasync function _handleOpen(viewer: Viewer, url: string, page: number, cache: boolean) {\r\n    if (cache) {\r\n        const cachedBytes = await PDFCache.getCache(url);\r\n        // If we have a cache hit open the cached data\r\n        if (cachedBytes) {\r\n            await viewer.open(cachedBytes, page);\r\n        } else {\r\n            // Otherwise we should open it by url\r\n            await viewer.open(url, page);\r\n            // And when the download is complete set the cache\r\n            viewer.download().then((bytes) => {\r\n                PDFCache.setCache(url, bytes);\r\n            });\r\n        }\r\n    } else {\r\n        await viewer.open(url, page);\r\n    }\r\n}\r\n\r\n/**\r\n * The PDFoundry API\r\n *\r\n * ## You can access the API with `ui.PDFoundry`.\r\n */\r\nexport default class Api {\r\n    /**\r\n     * Enable additional debug information for the specified category.\r\n     * @category Debug\r\n     */\r\n    public static DEBUG = {\r\n        /**\r\n         * When set to true, enables the logging event names and arguments to console.\r\n         */\r\n        EVENTS: false,\r\n    };\r\n\r\n    // <editor-fold desc=\"GetPDFData Methods\">\r\n\r\n    /**\r\n     * Helper method. Alias for {@link Api.getPDFData} with a comparer that searches by PDF Code.\r\n     * @param code Which code to search for a PDF with.\r\n     * @category PDFData\r\n     */\r\n    public static getPDFDataByCode(code: string): PDFData | null {\r\n        return Api.getPDFData((item) => {\r\n            return item.data.data.code === code;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Helper method. Alias for {@link Api.getPDFData} with a comparer that searches by PDF Name.\r\n     * @param name Which name to search for a PDF with.\r\n     * @param caseInsensitive If a case insensitive search should be done.\r\n     * @category PDFData\r\n     */\r\n    public static getPDFDataByName(name: string, caseInsensitive: boolean = true): PDFData | null {\r\n        if (caseInsensitive) {\r\n            return Api.getPDFData((item) => {\r\n                return item.name.toLowerCase() === name.toLowerCase();\r\n            });\r\n        } else {\r\n            return Api.getPDFData((item) => {\r\n                return item.name === name;\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Finds a PDF entity created by the user and constructs a {@link PDFData} object of the resulting PDF's data.\r\n     * @param comparer A comparison function that will be used.\r\n     * @param allowInvisible If true, PDFs hidden from the active user will be returned.\r\n     * @category PDFData\r\n     */\r\n    public static getPDFData(comparer: ItemComparer, allowInvisible: boolean = true): PDFData | null {\r\n        const pdf: Item = game.items.find((item: Item) => {\r\n            return item.type === Settings.PDF_ENTITY_TYPE && (item.visible || allowInvisible) && comparer(item);\r\n        });\r\n\r\n        return getPDFDataFromItem(pdf);\r\n    }\r\n\r\n    // </editor-fold>\r\n\r\n    // <editor-fold desc=\"OpenPDF Methods\">\r\n\r\n    /**\r\n     * Open the PDF with the provided code to the specified page.\r\n     * Helper for {@link getPDFDataByCode} then {@link openPDF}.\r\n     * @category Open\r\n     */\r\n    public static async openPDFByCode(code: string, page: number = 1): Promise<Viewer> {\r\n        const pdf = this.getPDFDataByCode(code);\r\n\r\n        if (pdf === null) {\r\n            const error = game.i18n.localize('PDFOUNDRY.ERROR.NoPDFWithCode');\r\n\r\n            if (Settings.NOTIFICATIONS) {\r\n                ui.notifications.error(error);\r\n            }\r\n\r\n            return Promise.reject(error);\r\n        }\r\n\r\n        return this.openPDF(pdf, page);\r\n    }\r\n\r\n    /**\r\n     * Open the PDF with the provided code to the specified page.\r\n     * Helper for {@link getPDFDataByCode} then {@link openPDF}.\r\n     * @category Open\r\n     */\r\n    public static async openPDFByName(name: string, page: number = 1): Promise<Viewer> {\r\n        const pdf = this.getPDFDataByName(name);\r\n\r\n        if (pdf === null) {\r\n            const message = game.i18n.localize('PDFOUNDRY.ERROR.NoPDFWithName');\r\n            const error = new Error(message);\r\n\r\n            if (Settings.NOTIFICATIONS) {\r\n                ui.notifications.error(error.message);\r\n            }\r\n\r\n            return Promise.reject(error);\r\n        }\r\n\r\n        return this.openPDF(pdf, page);\r\n    }\r\n\r\n    /**\r\n     * Open the provided {@link PDFData} to the specified page.\r\n     * @param pdf The PDF to open. See {@link Api.getPDFData}.\r\n     * @param page The page to open the PDF to.\r\n     * @category Open\r\n     */\r\n    public static async openPDF(pdf: PDFData, page: number = 1): Promise<Viewer> {\r\n        let { url, offset, cache } = pdf;\r\n\r\n        if (typeof offset === 'string') {\r\n            offset = parseInt(offset);\r\n        }\r\n\r\n        if (!validateAbsoluteURL(url)) {\r\n            url = getAbsoluteURL(url);\r\n        }\r\n\r\n        const viewer = new Viewer(pdf);\r\n        viewer.render(true);\r\n\r\n        await _handleOpen(viewer, url, page + offset, cache);\r\n\r\n        return viewer;\r\n    }\r\n\r\n    /**\r\n     * Open a URL as a PDF.\r\n     * @param url The URL to open (must be absolute).\r\n     * @param page Which page to open to. Must be >= 1.\r\n     * @param cache If URL based caching should be used.\r\n     * @category Open\r\n     */\r\n    public static async openURL(url: string, page: number = 1, cache: boolean = true): Promise<Viewer> {\r\n        if (isNaN(page) || page <= 0) {\r\n            throw new Error(`Page must be > 0, but ${page} was given.`);\r\n        }\r\n\r\n        if (!validateAbsoluteURL(url)) {\r\n            url = getAbsoluteURL(url);\r\n        }\r\n\r\n        const viewer = new Viewer();\r\n        viewer.render(true);\r\n\r\n        await _handleOpen(viewer, url, page, cache);\r\n\r\n        return viewer;\r\n    }\r\n\r\n    /**\r\n     * Shows the user manual to the active user.\r\n     * @category Utility\r\n     */\r\n    public static async showHelp(): Promise<Viewer> {\r\n        await game.user.setFlag(Settings.EXTERNAL_SYSTEM_NAME, Settings.SETTING_KEY.HELP_SEEN, true);\r\n\r\n        const lang = game.i18n.lang;\r\n        let manualPath = `${window.origin}/systems/${Settings.DIST_PATH}/assets/manual/${lang}/manual.pdf`;\r\n        const manualExists = await fileExists(manualPath);\r\n\r\n        if (!manualExists) {\r\n            manualPath = `${window.origin}/systems/${Settings.DIST_PATH}/assets/manual/en/manual.pdf`;\r\n        }\r\n\r\n        const pdfData: PDFData = {\r\n            name: game.i18n.localize('PDFOUNDRY.MANUAL.Name'),\r\n            code: '',\r\n            offset: 0,\r\n            url: manualPath,\r\n            cache: false,\r\n        };\r\n\r\n        return Api.openPDF(pdfData);\r\n    }\r\n\r\n    // </editor-fold>\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport Setup from './Setup';\r\n\r\nSetup.run();\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { getAbsoluteURL, getPDFDataFromItem } from './Util';\r\nimport { PDFItemSheet } from './app/PDFItemSheet';\r\nimport PreloadEvent from './socket/events/PreloadEvent';\r\nimport { Socket } from './socket/Socket';\r\nimport Settings from './settings/Settings';\r\nimport PDFCache from './cache/PDFCache';\r\nimport I18n from './settings/I18n';\r\nimport Api from './Api';\r\nimport HTMLEnricher from './enricher/HTMLEnricher';\r\nimport TinyMCEPlugin from './enricher/TinyMCEPlugin';\r\n\r\n/**\r\n * A collection of methods used for setting up the API & system state.\r\n * @private\r\n */\r\nexport default class Setup {\r\n    /**\r\n     * Run setup tasks.\r\n     */\r\n    public static run() {\r\n        // Register the PDFoundry APi on the UI\r\n        ui['PDFoundry'] = Api;\r\n\r\n        // Register system & css synchronously\r\n        Setup.registerSystem();\r\n        Setup.injectStyles();\r\n\r\n        // Setup tasks requiring FVTT is loaded\r\n        Hooks.once('ready', Setup.lateRun);\r\n    }\r\n\r\n    /**\r\n     * Late setup tasks happen when the system is loaded\r\n     */\r\n    public static lateRun() {\r\n        // Register the PDF sheet with the class picker\r\n        Setup.setupSheets();\r\n        // Register socket event handlers\r\n        Socket.initialize();\r\n\r\n        // Bind always-run event handlers\r\n        // Enrich Journal & Item Sheet rich text links\r\n        Hooks.on('renderItemSheet', HTMLEnricher.HandleEnrich);\r\n        Hooks.on('renderJournalSheet', HTMLEnricher.HandleEnrich);\r\n        Hooks.on('renderActorSheet', HTMLEnricher.HandleEnrich);\r\n\r\n        // Register TinyMCE drag + drop events\r\n        TinyMCEPlugin.Register();\r\n\r\n        return new Promise(async () => {\r\n            // Initialize the settings\r\n            await Settings.initialize();\r\n            await PDFCache.initialize();\r\n            await I18n.initialize();\r\n\r\n            // PDFoundry is ready\r\n            Setup.userLogin();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Inject the CSS file into the header, so it doesn't have to be referenced in the system.json\r\n     */\r\n    public static injectStyles() {\r\n        const head = $('head');\r\n        const link = `<link href=\"systems/${Settings.DIST_PATH}/bundle.css\" rel=\"stylesheet\" type=\"text/css\" media=\"all\">`;\r\n        head.append($(link));\r\n    }\r\n\r\n    /**\r\n     * Pulls the system name from the script tags.\r\n     */\r\n    public static registerSystem() {\r\n        const scripts = $('script');\r\n        for (let i = 0; i < scripts.length; i++) {\r\n            const script = scripts.get(i) as HTMLScriptElement;\r\n            const folders = script.src.split('/');\r\n            const distIdx = folders.indexOf(Settings.DIST_NAME);\r\n            if (distIdx === -1) continue;\r\n\r\n            if (folders[distIdx - 1] === 'pdfoundry') break;\r\n\r\n            Settings.EXTERNAL_SYSTEM_NAME = folders[distIdx - 1];\r\n            break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Register the PDF sheet and unregister invalid sheet types from it.\r\n     */\r\n    public static setupSheets() {\r\n        Items.registerSheet(Settings.INTERNAL_MODULE_NAME, PDFItemSheet, {\r\n            types: [Settings.PDF_ENTITY_TYPE],\r\n            makeDefault: true,\r\n        });\r\n\r\n        // Unregister all other item sheets for the PDF entity\r\n        const pdfoundryKey = `${Settings.INTERNAL_MODULE_NAME}.${PDFItemSheet.name}`;\r\n        const sheets = CONFIG.Item.sheetClasses[Settings.PDF_ENTITY_TYPE];\r\n        for (const key of Object.keys(sheets)) {\r\n            const sheet = sheets[key];\r\n            // keep the PDFoundry sheet\r\n            if (sheet.id === pdfoundryKey) {\r\n                continue;\r\n            }\r\n\r\n            // id is MODULE.CLASS_NAME\r\n            const [module] = sheet.id.split('.');\r\n            Items.unregisterSheet(module, sheet.cls, {\r\n                types: [Settings.PDF_ENTITY_TYPE],\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get additional context menu icons for PDF items\r\n     * @param html\r\n     * @param options\r\n     */\r\n    public static getItemContextOptions(html, options: any[]) {\r\n        const getItemFromContext = (html: JQuery<HTMLElement>): Item => {\r\n            const id = html.data('entity-id');\r\n            return game.items.get(id);\r\n        };\r\n\r\n        if (game.user.isGM) {\r\n            options.unshift({\r\n                name: game.i18n.localize('PDFOUNDRY.CONTEXT.PreloadPDF'),\r\n                icon: '<i class=\"fas fa-download fa-fw\"></i>',\r\n                condition: (entityHtml: JQuery<HTMLElement>) => {\r\n                    const item = getItemFromContext(entityHtml);\r\n                    if (item.type !== Settings.PDF_ENTITY_TYPE) {\r\n                        return false;\r\n                    }\r\n\r\n                    const { url } = item.data.data;\r\n                    return url !== '';\r\n                },\r\n                callback: (entityHtml: JQuery<HTMLElement>) => {\r\n                    const item = getItemFromContext(entityHtml);\r\n                    const pdf = getPDFDataFromItem(item);\r\n\r\n                    if (pdf === null) {\r\n                        //TODO: Error handling\r\n                        return;\r\n                    }\r\n\r\n                    const { url } = pdf;\r\n                    const event = new PreloadEvent(null, getAbsoluteURL(url));\r\n                    event.emit();\r\n\r\n                    PDFCache.preload(url);\r\n                },\r\n            });\r\n        }\r\n\r\n        options.unshift({\r\n            name: game.i18n.localize('PDFOUNDRY.CONTEXT.OpenPDF'),\r\n            icon: '<i class=\"far fa-file-pdf\"></i>',\r\n            condition: (entityHtml: JQuery<HTMLElement>) => {\r\n                const item = getItemFromContext(entityHtml);\r\n                if (item.type !== Settings.PDF_ENTITY_TYPE) {\r\n                    return false;\r\n                }\r\n\r\n                const { url } = item.data.data;\r\n                return url !== '';\r\n            },\r\n            callback: (entityHtml: JQuery<HTMLElement>) => {\r\n                const item = getItemFromContext(entityHtml);\r\n                const pdf = getPDFDataFromItem(item);\r\n\r\n                if (pdf === null) {\r\n                    //TODO: Error handling\r\n                    return;\r\n                }\r\n\r\n                Api.openPDF(pdf, 1);\r\n            },\r\n        });\r\n    }\r\n\r\n    private static userLogin() {\r\n        let viewed;\r\n        try {\r\n            viewed = game.user.getFlag(Settings.EXTERNAL_SYSTEM_NAME, Settings.SETTING_KEY.HELP_SEEN);\r\n        } catch (error) {\r\n            viewed = false;\r\n        } finally {\r\n            if (!viewed) {\r\n                Api.showHelp();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Hook handler for default data for a PDF\r\n     */\r\n    public static async preCreateItem(entity, ...args) {\r\n        if (entity.type !== Settings.PDF_ENTITY_TYPE) {\r\n            return;\r\n        }\r\n        entity.img = `systems/${Settings.DIST_PATH}/assets/pdf_icon.svg`;\r\n    }\r\n\r\n    /**\r\n     * Hook handler for rendering the settings tab\r\n     */\r\n    public static onRenderSettings(settings: any, html: JQuery<HTMLElement>, data: any) {\r\n        const icon = '<i class=\"far fa-file-pdf\"></i>';\r\n        const button = $(`<button>${icon} ${game.i18n.localize('PDFOUNDRY.SETTINGS.OpenHelp')}</button>`);\r\n        button.on('click', Api.showHelp);\r\n\r\n        html.find('h2').last().before(button);\r\n    }\r\n}\r\n\r\n// <editor-fold desc=\"Persistent Hooks\">\r\n\r\n// preCreateItem - Setup default values for a new PDFoundry_PDF\r\nHooks.on('preCreateItem', Setup.preCreateItem);\r\n// getItemDirectoryEntryContext - Setup context menu for 'Open PDF' links\r\nHooks.on('getItemDirectoryEntryContext', Setup.getItemContextOptions);\r\n// renderSettings - Inject a 'Open Manual' button into help section\r\nHooks.on('renderSettings', Setup.onRenderSettings);\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { PDFData } from './common/types/PDFData';\r\nimport Settings from './settings/Settings';\r\n\r\n/**\r\n * Helper method. Convert a relative URL to a absolute URL\r\n *  by prepending the window origin to the relative URL.\r\n * @param dataUrl\r\n */\r\nexport function getAbsoluteURL(dataUrl: string): string {\r\n    // Amazon S3 buckets are already absolute\r\n    if (dataUrl.includes('amazonaws.com')) {\r\n        return dataUrl;\r\n    }\r\n    return `${window.origin}/${dataUrl}`;\r\n}\r\n\r\n/**\r\n * Pull relevant data from an item, creating a {@link PDFData}.\r\n * @param item The item to pull data from.\r\n */\r\nexport function getPDFDataFromItem(item: Item): PDFData | null {\r\n    if (item === undefined || item === null) {\r\n        return null;\r\n    }\r\n\r\n    let { code, url, offset, cache } = item.data.data;\r\n    let name = item.name;\r\n\r\n    if (typeof offset === 'string') {\r\n        offset = parseInt(offset);\r\n    }\r\n\r\n    return {\r\n        name,\r\n        code,\r\n        url,\r\n        offset,\r\n        cache,\r\n    };\r\n}\r\n\r\n/**\r\n * Returns true if the URL starts with the origin.\r\n * @param dataUrl A url.\r\n */\r\nexport function validateAbsoluteURL(dataUrl: string): boolean {\r\n    return dataUrl.startsWith(window.origin);\r\n}\r\n\r\n/**\r\n * Return all users ids except the active user\r\n */\r\nexport function getUserIdsExceptMe() {\r\n    return game.users\r\n        .filter((user) => {\r\n            return user.id !== game.userId;\r\n        })\r\n        .map((user) => user.id);\r\n}\r\n\r\n/**\r\n * Gets users with a role number between the provided lower inclusive and upper inclusive bounds.\r\n * @param lower\r\n * @param upper\r\n */\r\nexport function getUserIdsBetweenRoles(lower: number, upper: number) {\r\n    return game.users\r\n        .filter((user) => {\r\n            return user.role >= lower && user.role <= upper;\r\n        })\r\n        .map((user) => user.id);\r\n}\r\n\r\n/**\r\n * Gets users with a role number exactly matching the one provided.\r\n * @param role\r\n */\r\nexport function getUserIdsOfRole(role: number) {\r\n    return game.users\r\n        .filter((user) => {\r\n            return user.role === role;\r\n        })\r\n        .map((user) => user.id);\r\n}\r\n\r\n/**\r\n * Gets users with a role number at least the one provided.\r\n * @param role\r\n */\r\nexport function getUserIdsAtLeastRole(role: number) {\r\n    return game.users\r\n        .filter((user) => {\r\n            return user.role >= role;\r\n        })\r\n        .map((user) => user.id);\r\n}\r\n\r\n/**\r\n * Gets users with a role number at most the one provided.\r\n * @param role\r\n */\r\nexport function getUserIdsAtMostRole(role: number) {\r\n    return game.users\r\n        .filter((user) => {\r\n            return user.role <= role;\r\n        })\r\n        .map((user) => user.id);\r\n}\r\n\r\n/**\r\n * Checks if a remote file exists at the specified path. That is, if the URL is valid. This does not guarantee a\r\n * valid file exists at that location. For example, an HTML file will result in true but not be a valid PDF.\r\n * @param path\r\n */\r\nexport function fileExists(path: string): Promise<boolean> {\r\n    return new Promise<boolean>((resolve, reject) => {\r\n        $.ajax(path, {\r\n            type: 'HEAD',\r\n            success: () => {\r\n                resolve(true);\r\n            },\r\n            error: () => {\r\n                resolve(false);\r\n            },\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * Returns true if the provided entity is a PDF\r\n * @param entity\r\n */\r\nexport function isPDF(entity: Entity) {\r\n    return entity.data.type === Settings.PDF_ENTITY_TYPE;\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport Settings from '../settings/Settings';\r\nimport Api from '../Api';\r\nimport { getAbsoluteURL } from '../Util';\r\n\r\n/**\r\n * Extends the base ItemSheet for linked PDF viewing.\r\n * @private\r\n */\r\nexport class PDFItemSheet extends ItemSheet {\r\n    static get defaultOptions() {\r\n        const options = super.defaultOptions;\r\n        options.classes = ['sheet', 'item'];\r\n        options.width = 650;\r\n        options.height = 'auto';\r\n        options.template = `systems/${Settings.DIST_PATH}/templates/sheet/pdf-sheet.html`;\r\n        return options;\r\n    }\r\n\r\n    /**\r\n     * Helper method to get a id in the html form\r\n     * html ids are prepended with the id of the item to preserve uniqueness\r\n     *  which is mandatory to allow multiple forms to be open\r\n     * @param html\r\n     * @param id\r\n     */\r\n    private _getByID(html: JQuery<HTMLElement>, id: string): JQuery<HTMLElement> {\r\n        return html.parent().parent().find(`#${this.item._id}-${id}`);\r\n    }\r\n\r\n    protected _getHeaderButtons(): any[] {\r\n        const buttons = super._getHeaderButtons();\r\n        buttons.unshift({\r\n            class: 'pdf-sheet-manual',\r\n            icon: 'fas fa-question-circle',\r\n            label: 'Help',\r\n            onclick: () => Api.showHelp(),\r\n        });\r\n        //TODO: Standardize this to function w/ the Viewer one\r\n        buttons.unshift({\r\n            class: 'pdf-sheet-github',\r\n            icon: 'fas fa-external-link-alt',\r\n            label: 'PDFoundry',\r\n            onclick: () => window.open('https://github.com/Djphoenix719/PDFoundry', '_blank'),\r\n        });\r\n        return buttons;\r\n    }\r\n\r\n    protected activateListeners(html: JQuery<HTMLElement>): void {\r\n        super.activateListeners(html);\r\n\r\n        const urlInput = this._getByID(html, 'data\\\\.url');\r\n        const offsetInput = this._getByID(html, 'data\\\\.offset');\r\n\r\n        // Block enter from displaying the PDF\r\n        html.find('input').on('keypress', function (event) {\r\n            if (event.key === 'Enter') {\r\n                event.preventDefault();\r\n            }\r\n        });\r\n\r\n        // Test button\r\n        this._getByID(html, 'pdf-test').on('click', function (event) {\r\n            event.preventDefault();\r\n\r\n            let urlValue = urlInput.val();\r\n            let offsetValue = offsetInput.val();\r\n\r\n            if (urlValue === null || urlValue === undefined) return;\r\n            if (offsetValue === null || offsetValue === undefined) return;\r\n\r\n            urlValue = urlValue.toString();\r\n\r\n            urlValue = getAbsoluteURL(urlValue);\r\n\r\n            if (offsetValue.toString().trim() === '') {\r\n                offsetValue = 0;\r\n            }\r\n            offsetValue = parseInt(offsetValue as string);\r\n\r\n            Api.openURL(urlValue, 5 + offsetValue, false);\r\n        });\r\n\r\n        // Browse button\r\n        this._getByID(html, 'pdf-browse').on('click', async function (event) {\r\n            event.preventDefault();\r\n\r\n            const fp = new FilePicker({});\r\n            // @ts-ignore TODO: foundry-pc-types\r\n            fp.extensions = ['.pdf'];\r\n            fp.field = urlInput[0];\r\n\r\n            let urlValue = urlInput.val();\r\n            if (urlValue !== undefined) {\r\n                await fp.browse(urlValue.toString().trim());\r\n            }\r\n\r\n            fp.render(true);\r\n        });\r\n    }\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport Settings from '../settings/Settings';\r\n\r\n/**\r\n * Callback type for player selection\r\n * @private\r\n */\r\nexport type PDFPlayerSelectCallback = (ids: []) => void;\r\n\r\n/**\r\n * An application that allows selection of players.\r\n * @private\r\n */\r\nexport default class PlayerSelect extends Application {\r\n    static get defaultOptions() {\r\n        const options = super.defaultOptions;\r\n        options.classes = ['sheet', 'item'];\r\n        options.template = `systems/${Settings.DIST_PATH}/templates/app/pdf-player-select.html`;\r\n        options.width = 'auto';\r\n        options.height = 'auto';\r\n        options.title = game.i18n.localize('PDFOUNDRY.VIEWER.SelectPlayers');\r\n        return options;\r\n    }\r\n\r\n    private readonly _ids;\r\n    private readonly _callback;\r\n\r\n    constructor(ids: string[], cb: PDFPlayerSelectCallback, options?: ApplicationOptions) {\r\n        super(options);\r\n\r\n        this._ids = ids;\r\n        this._callback = cb;\r\n    }\r\n\r\n    getData(options?: any): any | Promise<any> {\r\n        const data = super.getData(options);\r\n\r\n        const users: any[] = [];\r\n        for (const id of this._ids) {\r\n            users.push({\r\n                name: game.users.get(id).name,\r\n                id,\r\n            });\r\n        }\r\n\r\n        users.sort((a, b) => a.name.localeCompare(b.name));\r\n\r\n        data['users'] = users;\r\n        return data;\r\n    }\r\n\r\n    protected activateListeners(html: JQuery<HTMLElement> | HTMLElement): void {\r\n        super.activateListeners(html);\r\n\r\n        const button = $(html).find('#confirm');\r\n        button.on('click', () => {\r\n            this._callback(this.collectIds());\r\n            this.close();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Collect selected ids from the html\r\n     */\r\n    private collectIds(): string[] {\r\n        const ids: string[] = [];\r\n        const checkboxes = $(this.element).find('input[type=checkbox]');\r\n        for (let i = 0; i < checkboxes.length; i++) {\r\n            const checkbox = $(checkboxes[i]);\r\n            if (checkbox.prop('checked')) {\r\n                ids.push(checkbox.prop('id'));\r\n            }\r\n        }\r\n        return ids;\r\n    }\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/**\r\n * An error that occurs during cache operations\r\n * @private\r\n */\r\nexport class CacheError extends Error {\r\n    constructor(index: string, store: string, message?: string) {\r\n        super(`Error in ${index}>${store}: ${message}`);\r\n    }\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { CacheError } from './CacheError';\r\n\r\n/**\r\n * Class that deals with getting/setting from an indexed db\r\n * Mostly exists to separate logic for the PDFCache from logic\r\n * dealing with the database\r\n * @private\r\n */\r\nexport default class CacheHelper {\r\n    private _version: number;\r\n\r\n    private readonly _indexName: string;\r\n    private readonly _storeNames: string[];\r\n\r\n    private _db: IDBDatabase;\r\n\r\n    public static async createAndOpen(indexName: string, storeNames: string[], version: number) {\r\n        const helper = new CacheHelper(indexName, storeNames, version);\r\n        await helper.open();\r\n        return helper;\r\n    }\r\n\r\n    public get ready() {\r\n        return this._db !== undefined;\r\n    }\r\n\r\n    public constructor(indexName: string, storeNames: string[], version: number) {\r\n        this._indexName = `${indexName}`;\r\n        this._storeNames = storeNames;\r\n        this._version = version;\r\n    }\r\n\r\n    private newTransaction(storeName: string) {\r\n        const transaction = this._db.transaction(storeName, 'readwrite');\r\n        const store = transaction.objectStore(storeName);\r\n        return { transaction, store };\r\n    }\r\n\r\n    public open(): Promise<void> {\r\n        const that = this;\r\n        return new Promise<void>(function (resolve, reject) {\r\n            const request = indexedDB.open(that._indexName, that._version);\r\n            request.onsuccess = function (event) {\r\n                that._db = this.result;\r\n                resolve();\r\n            };\r\n            request.onupgradeneeded = function (event) {\r\n                that._db = this.result;\r\n                for (let i = 0; i < that._storeNames.length; i++) {\r\n                    try {\r\n                        // Create object store if it doesn't exist\r\n                        that._db.createObjectStore(that._storeNames[i], {});\r\n                    } catch (error) {\r\n                        // Otherwise pass\r\n                    }\r\n                }\r\n                resolve();\r\n            };\r\n            request.onerror = function (event) {\r\n                // @ts-ignore\r\n                reject(event.target.error);\r\n            };\r\n        });\r\n    }\r\n\r\n    public set(key: IDBValidKey, value: any, storeName: string, force: boolean = false): Promise<void> {\r\n        return new Promise<void>((resolve, reject) => {\r\n            if (!this._db) {\r\n                throw new CacheError(this._indexName, storeName, 'Database is not initialized.');\r\n            } else {\r\n                const that = this;\r\n                let { transaction, store } = this.newTransaction(storeName);\r\n\r\n                // Propagate errors upwards, otherwise they fail silently\r\n                transaction.onerror = function (event) {\r\n                    // @ts-ignore\r\n                    reject(event.target.error);\r\n                };\r\n\r\n                const keyRequest = store.getKey(key);\r\n                keyRequest.onsuccess = function (event) {\r\n                    // key already exists in the store\r\n                    if (keyRequest.result) {\r\n                        // should we force the new value by deleting the old?\r\n                        if (force) {\r\n                            that.del(key, storeName).then(() => {\r\n                                ({ transaction, store } = that.newTransaction(storeName));\r\n                                store.add(value, key);\r\n                                resolve();\r\n                            });\r\n                        } else {\r\n                            throw new CacheError(that._indexName, storeName, `Key ${key} already exists.`);\r\n                        }\r\n                    } else {\r\n                        store.add(value, key);\r\n                        resolve();\r\n                    }\r\n                };\r\n            }\r\n        });\r\n    }\r\n\r\n    public get(key: IDBValidKey, storeName: string): Promise<any> {\r\n        return new Promise<void>((resolve, reject) => {\r\n            if (!this._db) {\r\n                throw new CacheError(this._indexName, storeName, 'Database is not initialized.');\r\n            } else {\r\n                let { transaction, store } = this.newTransaction(storeName);\r\n\r\n                // Propagate errors upwards, otherwise they fail silently\r\n                transaction.onerror = function (event) {\r\n                    // @ts-ignore\r\n                    reject(event.target.error);\r\n                };\r\n\r\n                const getRequest = store.get(key);\r\n                getRequest.onsuccess = function (event) {\r\n                    resolve(this.result);\r\n                };\r\n\r\n                getRequest.onerror = function (event) {\r\n                    // @ts-ignore\r\n                    reject(event.target.error);\r\n                };\r\n            }\r\n        });\r\n    }\r\n\r\n    public del(key: IDBValidKey, storeName: string): Promise<void> {\r\n        return new Promise<void>((resolve, reject) => {\r\n            try {\r\n                const { transaction, store } = this.newTransaction(storeName);\r\n\r\n                transaction.onerror = function (event) {\r\n                    // @ts-ignore\r\n                    reject(event.target.error);\r\n                };\r\n                transaction.oncomplete = function (event) {\r\n                    resolve();\r\n                };\r\n\r\n                store.delete(key);\r\n            } catch (error) {\r\n                reject(error);\r\n            }\r\n        });\r\n    }\r\n\r\n    public keys(storeName: string): Promise<IDBValidKey[]> {\r\n        return new Promise<IDBValidKey[]>((resolve, reject) => {\r\n            try {\r\n                const { transaction, store } = this.newTransaction(storeName);\r\n                const keysRequest = store.getAllKeys();\r\n\r\n                keysRequest.onsuccess = function () {\r\n                    resolve(keysRequest.result);\r\n                };\r\n                keysRequest.onerror = function (event) {\r\n                    // @ts-ignore\r\n                    reject(event.target.error);\r\n                };\r\n\r\n                return;\r\n            } catch (error) {\r\n                reject(error);\r\n            }\r\n        });\r\n    }\r\n\r\n    public clr(storeName: string): Promise<void> {\r\n        return new Promise<void>((resolve, reject) => {\r\n            try {\r\n                const { store } = this.newTransaction(storeName);\r\n                const keys = store.getAllKeys();\r\n                keys.onsuccess = (result) => {\r\n                    const promises: Promise<void>[] = [];\r\n                    for (const key of keys.result) {\r\n                        promises.push(this.del(key, storeName));\r\n                    }\r\n                    Promise.all(promises).then(() => {\r\n                        resolve();\r\n                    });\r\n                };\r\n            } catch (error) {\r\n                reject(error);\r\n            }\r\n        });\r\n    }\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport Settings from '../settings/Settings';\r\nimport CacheHelper from './CacheHelper';\r\n\r\n/**\r\n * Meta information about a cache entry\r\n * @private\r\n */\r\ntype CacheData = {\r\n    /**\r\n     * The size in bytes this cache entry takes up.\r\n     */\r\n    size: number;\r\n    /**\r\n     * The date the cache was last accessed, represented by a ISO string.\r\n     */\r\n    dateAccessed: string;\r\n};\r\n\r\n/**\r\n * Handles caching for PDFs\r\n * @private\r\n */\r\nexport default class PDFCache {\r\n    // <editor-fold desc=\"Static Properties\">\r\n    /**\r\n     * Max size of the cache for the active user, defaults to 256 MB.\r\n     */\r\n    public static get MAX_BYTES() {\r\n        return game.settings.get(Settings.EXTERNAL_SYSTEM_NAME, 'CacheSize') * 2 ** 20;\r\n    }\r\n\r\n    private static readonly IDB_NAME: string = 'PDFoundry';\r\n    private static readonly IDB_VERSION: number = 1;\r\n\r\n    private static readonly CACHE: string = `Cache`;\r\n    private static readonly META: string = `Meta`;\r\n\r\n    private static _cacheHelper: CacheHelper;\r\n    // </editor-fold>\r\n\r\n    public static async initialize() {\r\n        PDFCache._cacheHelper = await CacheHelper.createAndOpen(PDFCache.IDB_NAME, [PDFCache.CACHE, PDFCache.META], PDFCache.IDB_VERSION);\r\n    }\r\n\r\n    /**\r\n     * Get meta information about a provided key (url).\r\n     * @param key\r\n     */\r\n    public static async getMeta(key: string): Promise<CacheData | null> {\r\n        try {\r\n            return await PDFCache._cacheHelper.get(key, PDFCache.META);\r\n        } catch (error) {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set meta information about a provided key (url). See {@link CacheData}.\r\n     * @param key\r\n     * @param meta\r\n     */\r\n    public static async setMeta(key: string, meta: CacheData): Promise<void> {\r\n        await PDFCache._cacheHelper.set(key, meta, PDFCache.META, true);\r\n    }\r\n\r\n    /**\r\n     * Get the byte array representing the key (url) from the user's cache.\r\n     * @param key\r\n     */\r\n    public static async getCache(key: string): Promise<Uint8Array | null> {\r\n        try {\r\n            const bytes = await PDFCache._cacheHelper.get(key, PDFCache.CACHE);\r\n            const meta: CacheData = {\r\n                dateAccessed: new Date().toISOString(),\r\n                size: bytes.length,\r\n            };\r\n            await PDFCache.setMeta(key, meta);\r\n\r\n            return bytes;\r\n        } catch (error) {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set the value of the cache for the specific key (url) to the provided byte array.\r\n     * @param key\r\n     * @param bytes\r\n     */\r\n    public static async setCache(key: string, bytes: Uint8Array) {\r\n        const meta: CacheData = {\r\n            dateAccessed: new Date().toISOString(),\r\n            size: bytes.length,\r\n        };\r\n\r\n        await PDFCache._cacheHelper.set(key, bytes, PDFCache.CACHE, true);\r\n        await PDFCache.setMeta(key, meta);\r\n        await this.prune();\r\n    }\r\n\r\n    /**\r\n     * Preload the PDF at the specified key (url), caching it immediately.\r\n     * @param key\r\n     */\r\n    public static preload(key: string): Promise<void> {\r\n        return new Promise<void>(async (resolve, reject) => {\r\n            const cachedBytes = await PDFCache.getCache(key);\r\n            if (cachedBytes !== null && cachedBytes.byteLength > 0) {\r\n                resolve();\r\n                return;\r\n            }\r\n\r\n            const response = await fetch(key);\r\n            if (response.ok) {\r\n                const fetchedBytes = new Uint8Array(await response.arrayBuffer());\r\n                if (fetchedBytes.byteLength > 0) {\r\n                    await PDFCache.setCache(key, fetchedBytes);\r\n                    resolve();\r\n                    return;\r\n                } else {\r\n                    reject('Fetch failed.');\r\n                }\r\n            } else {\r\n                reject('Fetch failed.');\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Prune the active user's cache until it is below the user's cache size limit.\r\n     */\r\n    public static async prune() {\r\n        const keys = await this._cacheHelper.keys(PDFCache.META);\r\n\r\n        let totalBytes = 0;\r\n        let metas: any[] = [];\r\n        for (const key of keys) {\r\n            const meta = await this._cacheHelper.get(key, PDFCache.META);\r\n            meta.dateAccessed = Date.parse(meta.dateAccessed);\r\n            meta.size = parseInt(meta.size);\r\n\r\n            totalBytes += meta.size;\r\n\r\n            metas.push({\r\n                key,\r\n                meta,\r\n            });\r\n        }\r\n\r\n        metas = metas.sort((a, b) => {\r\n            return a.meta.dateAccessed - b.meta.dateAccessed;\r\n        });\r\n\r\n        for (let i = 0; i < metas.length; i++) {\r\n            if (totalBytes < PDFCache.MAX_BYTES) {\r\n                break;\r\n            }\r\n\r\n            const next = metas[i];\r\n\r\n            await this._cacheHelper.del(next.key, PDFCache.META);\r\n            await this._cacheHelper.del(next.key, PDFCache.CACHE);\r\n\r\n            totalBytes -= next.meta.size;\r\n        }\r\n    }\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport Api from '../../Api';\r\n\r\n/**\r\n * @private\r\n */\r\nexport default class EventStore<TKeys extends string = string> {\r\n    private readonly _map: Map<string, Function[]>;\r\n\r\n    public constructor() {\r\n        this._map = new Map<string, Function[]>();\r\n    }\r\n\r\n    /**\r\n     * Turn on an event callback for the specified event.\r\n     * @param eventName\r\n     * @param callback\r\n     */\r\n    public on(eventName: TKeys, callback: Function) {\r\n        if (!this._map.has(eventName)) {\r\n            this._map.set(eventName, []);\r\n        }\r\n\r\n        const callbacks = this._map.get(eventName) as Function[];\r\n        for (let i = 0; i < callbacks.length; i++) {\r\n            if (callbacks[i] === callback) return;\r\n        }\r\n        callbacks.push(callback);\r\n    }\r\n\r\n    /**\r\n     * Like {@see on} but only fires once.\r\n     * @param eventName\r\n     * @param callback\r\n     */\r\n    public once(eventName: TKeys, callback: Function) {\r\n        const that = this;\r\n        const wrapper = function (...args) {\r\n            callback(args);\r\n            that.off(eventName, wrapper);\r\n        };\r\n        that.on(eventName, wrapper);\r\n    }\r\n\r\n    /**\r\n     * Turn off an event callback for the specified event.\r\n     * @param eventName\r\n     * @param callback\r\n     */\r\n    public off(eventName: TKeys, callback: Function) {\r\n        if (!this._map.has(eventName)) {\r\n            this._map.set(eventName, []);\r\n        }\r\n\r\n        const callbacks = this._map.get(eventName) as Function[];\r\n        for (let i = 0; i < callbacks.length; i++) {\r\n            if (callbacks[i] === callback) {\r\n                callbacks.splice(i, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Fire an event and forward the args to all handlers\r\n     * @param eventName\r\n     * @param args\r\n     */\r\n    public fire(eventName: TKeys, ...args) {\r\n        if (Api.DEBUG.EVENTS) {\r\n            console.debug(`PDFoundry::${eventName}`);\r\n            console.debug(args);\r\n        }\r\n\r\n        if (!this._map.has(eventName)) {\r\n            return;\r\n        }\r\n\r\n        const callbacks = this._map.get(eventName) as Function[];\r\n        for (const callback of callbacks) {\r\n            callback(...args);\r\n        }\r\n    }\r\n}\r\n","import { PDFItemSheet } from '../app/PDFItemSheet';\r\nimport Settings from '../settings/Settings';\r\nimport Api from '../Api';\r\n\r\n/**\r\n * @private\r\n * Enriches TinyMCE editor content\r\n */\r\nexport default class HTMLEnricher {\r\n    public static HandleEnrich(app: Application, html: JQuery, data: any) {\r\n        if (app instanceof PDFItemSheet) return;\r\n\r\n        HTMLEnricher.EnrichHTML(html);\r\n        HTMLEnricher.BindClicks(html);\r\n    }\r\n\r\n    private static EnrichHTML(html: JQuery) {\r\n        // Enrich HTML\r\n        for (const element of html.find('div.editor-content > *')) {\r\n            try {\r\n                // We replace one at a time until done\r\n                while (element.innerText.includes('@PDF')) {\r\n                    element.innerHTML = new HTMLEnricher($(element), element.innerHTML).enrich();\r\n                }\r\n            } catch (error) {\r\n                // Errors get propagated from instance for proper error modeling\r\n                if (Settings.NOTIFICATIONS) {\r\n                    ui.notifications.error(error.message);\r\n                } else {\r\n                    console.error(error);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private static BindClicks(html: JQuery) {\r\n        html.find('a.pdfoundry-link').on('click', (event) => {\r\n            event.preventDefault();\r\n\r\n            // This will always be an anchor\r\n            const target = $(event.currentTarget as HTMLAnchorElement);\r\n            const ref = target.data('ref');\r\n            const page = target.data('page');\r\n\r\n            // ref can match name or code\r\n            let pdfData = Api.getPDFData((item) => {\r\n                return item.name === ref || item.data.data.code === ref;\r\n            });\r\n\r\n            if (!pdfData) {\r\n                ui.notifications.error(`Unable to find a PDF with a name or code matching ${ref}.`);\r\n                return;\r\n            }\r\n            Api.openPDF(pdfData, page);\r\n        });\r\n    }\r\n\r\n    private readonly _sPos: number;\r\n    private readonly _ePos: number;\r\n    private readonly _text: string;\r\n    private readonly _element: JQuery;\r\n\r\n    constructor(p: JQuery, text: string) {\r\n        this._element = p;\r\n        this._text = text;\r\n\r\n        this._sPos = this._text.indexOf('@');\r\n        this._ePos = this._text.indexOf('}', this._sPos + 1);\r\n    }\r\n\r\n    public enrich(): string {\r\n        const enrichMe = this._text.slice(this._sPos, this._ePos + 1);\r\n\r\n        const lBracket = enrichMe.indexOf('[');\r\n        const rBracket = enrichMe.indexOf(']');\r\n        const lCurly = enrichMe.indexOf('{');\r\n        const rCurly = enrichMe.indexOf('}');\r\n\r\n        // Required character is missing\r\n        if (lBracket === -1 || rBracket === -1 || lCurly === -1 || rCurly === -1) {\r\n            throw new Error(game.i18n.localize('PDFOUNDRY.ENRICH.InvalidFormat'));\r\n        }\r\n        // Order is not correct\r\n        if (rCurly < lCurly || lCurly < rBracket || rBracket < lBracket) {\r\n            throw new Error(game.i18n.localize('PDFOUNDRY.ENRICH.InvalidFormat'));\r\n        }\r\n\r\n        const options = enrichMe.slice(lBracket + 1, rBracket);\r\n        // Multiple dividers are not supported\r\n        if (options.indexOf('|') !== options.lastIndexOf('|')) {\r\n            throw new Error(game.i18n.localize('PDFOUNDRY.ENRICH.InvalidFormat'));\r\n        }\r\n\r\n        let linkText = enrichMe.slice(lCurly + 1, rCurly);\r\n        // Empty names are not supported\r\n        if (linkText === undefined || linkText === '') {\r\n            throw new Error(game.i18n.localize('PDFOUNDRY.ENRICH.EmptyLinkText'));\r\n        }\r\n\r\n        let pageNumber = 1;\r\n        const [nameOrCode, queryString] = options.split('|');\r\n\r\n        // Getting the PDF without invisible PDFs to check permissions\r\n        let pdfData = Api.getPDFData((item) => {\r\n            return item.name === nameOrCode || item.data.data.code === nameOrCode;\r\n        }, false);\r\n\r\n        if (pdfData) {\r\n            // Case 1 - User has permissions to see the PDF\r\n            if (queryString !== undefined && queryString !== '') {\r\n                const [_, pageString] = queryString.split('=');\r\n                try {\r\n                    pageNumber = parseInt(pageString);\r\n                } catch (error) {\r\n                    // Ignore page number\r\n                }\r\n            }\r\n\r\n            if (pageNumber <= 0) {\r\n                throw new Error('PDFOUNDRY.ERROR.PageMustBePositive');\r\n            }\r\n\r\n            const i18nOpen = game.i18n.localize('PDFOUNDRY.ENRICH.LinkTitleOpen');\r\n            const i18nPage = game.i18n.localize('PDFOUNDRY.ENRICH.LinkTitlePage');\r\n            const linkTitle = `${i18nOpen} ${nameOrCode} ${i18nPage} ${pageNumber}`;\r\n            const result = `<a class=\"pdfoundry-link\" title=\"${linkTitle}\" data-ref=\"${nameOrCode}\" data-page=\"${pageNumber}\">${linkText}</a>`;\r\n\r\n            return this._text.slice(0, this._sPos) + result + this._text.slice(this._ePos + 1);\r\n        } else {\r\n            // Case 2 - User does not have permissions to see the PDF\r\n            return this._text.slice(0, this._sPos) + linkText + this._text.slice(this._ePos + 1);\r\n        }\r\n    }\r\n}\r\n","import { getPDFDataFromItem, isPDF } from '../Util';\r\n\r\n/**\r\n * @private\r\n * A plugin for TinyMCE that handles Drag + Drop\r\n */\r\nexport default class TinyMCEPlugin {\r\n    private static pluginName = 'PDFoundry_HTMLEnrich_Drop';\r\n\r\n    /**\r\n     * Register plugin with Foundry + TinyMCE\r\n     */\r\n    public static Register() {\r\n        // @ts-ignore\r\n        tinyMCE.PluginManager.add(TinyMCEPlugin.pluginName, function (editor) {\r\n            editor.on('BeforeSetContent', (event) => TinyMCEPlugin.Handle(event));\r\n        });\r\n        CONFIG.TinyMCE.plugins = `${TinyMCEPlugin.pluginName} ${CONFIG.TinyMCE.plugins}`;\r\n    }\r\n\r\n    private static Handle(event: any) {\r\n        if (event.initial) return;\r\n        if (!event.selection || event.set !== undefined) {\r\n            return;\r\n        }\r\n\r\n        const initialContent = event.content;\r\n\r\n        const lBracket = initialContent.indexOf('[');\r\n        const rBracket = initialContent.indexOf(']');\r\n        const entityId = initialContent.slice(lBracket + 1, rBracket);\r\n\r\n        const entity = game.items.get(entityId);\r\n        if (entity === null || !isPDF(entity)) {\r\n            return;\r\n        }\r\n\r\n        const pdfData = getPDFDataFromItem(entity);\r\n        if (!pdfData) {\r\n            return;\r\n        }\r\n\r\n        const codeOrName = pdfData.code ? pdfData.code : pdfData.name;\r\n\r\n        event.content = `@PDF[${codeOrName}|page=1]{${pdfData.name}}`;\r\n    }\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport Settings from './Settings';\r\n\r\n/**\r\n * Localization helper\r\n * @private\r\n */\r\nexport default class I18n {\r\n    /**\r\n     * Load the localization file for the user's language.\r\n     */\r\n    public static async initialize() {\r\n        const lang = game.i18n.lang;\r\n        // user's language path\r\n        const u_path = `systems/${Settings.DIST_PATH}/locale/${lang}/config.json`;\r\n        // english fallback path\r\n        const f_path = `systems/${Settings.DIST_PATH}/locale/en/config.json`;\r\n\r\n        let json;\r\n        try {\r\n            json = await $.getJSON(u_path);\r\n        } catch (error) {\r\n            // if no translation exits for the users locale the fallback\r\n            json = await $.getJSON(f_path);\r\n        }\r\n\r\n        for (const key of Object.keys(json)) {\r\n            game.i18n.translations[key] = json[key];\r\n        }\r\n\r\n        // setup the fallback as english so partial translations do not display keys\r\n        let fb_json = await $.getJSON(f_path);\r\n        for (const key of Object.keys(fb_json)) {\r\n            // @ts-ignore\r\n            game.i18n._fallback[key] = json[key];\r\n        }\r\n    }\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/**\r\n * Internal settings and helper methods for PDFoundry.\r\n * @private\r\n */\r\nexport default class Settings {\r\n    /**\r\n     * Are feedback notifications enabled? Disable if you wish\r\n     *  to handle them yourself.\r\n     */\r\n    public static NOTIFICATIONS: boolean = true;\r\n\r\n    public static EXTERNAL_SYSTEM_NAME: string = '../modules/pdfoundry';\r\n    public static INTERNAL_MODULE_NAME: string = 'pdfoundry';\r\n\r\n    public static DIST_NAME = 'pdfoundry-dist';\r\n\r\n    public static get DIST_PATH() {\r\n        return `${Settings.EXTERNAL_SYSTEM_NAME}/${Settings.DIST_NAME}`;\r\n    }\r\n\r\n    public static PDF_ENTITY_TYPE: string = 'PDFoundry_PDF';\r\n\r\n    public static SETTING_KEY = {\r\n        EXISTING_VIEWER: 'ShowInExistingViewer',\r\n        CACHE_SIZE: 'CacheSize',\r\n        HELP_SEEN: 'PDFoundry_HelpSeen',\r\n    };\r\n\r\n    public static get SOCKET_NAME() {\r\n        return `system.${Settings.EXTERNAL_SYSTEM_NAME}`;\r\n    }\r\n\r\n    public static initialize() {\r\n        Settings.register(Settings.SETTING_KEY.CACHE_SIZE, {\r\n            name: game.i18n.localize('PDFOUNDRY.SETTINGS.CacheSizeName'),\r\n            scope: 'user',\r\n            type: Number,\r\n            hint: game.i18n.localize('PDFOUNDRY.SETTINGS.CacheSizeHint'),\r\n            default: 256,\r\n            config: true,\r\n            onChange: async (mb) => {\r\n                mb = Math.round(mb);\r\n                mb = Math.max(mb, 64);\r\n                mb = Math.min(mb, 1024);\r\n                await Settings.set(Settings.SETTING_KEY.CACHE_SIZE, mb);\r\n            },\r\n        });\r\n\r\n        Settings.register(Settings.SETTING_KEY.EXISTING_VIEWER, {\r\n            name: game.i18n.localize('PDFOUNDRY.SETTINGS.ShowInExistingViewerName'),\r\n            scope: 'user',\r\n            type: Boolean,\r\n            hint: game.i18n.localize('PDFOUNDRY.SETTINGS.ShowInExistingViewerHint'),\r\n            default: true,\r\n            config: true,\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Wrapper around game.settings.register. Ensures scope is correct.\r\n     * @param key\r\n     * @param data\r\n     */\r\n    public static register(key: string, data: any) {\r\n        game.settings.register(Settings.EXTERNAL_SYSTEM_NAME, key, data);\r\n    }\r\n\r\n    /**\r\n     * Wrapper around game.settings.get. Ensures scope is correct.\r\n     * @param key\r\n     */\r\n    public static get(key: string) {\r\n        return game.settings.get(Settings.EXTERNAL_SYSTEM_NAME, key);\r\n    }\r\n\r\n    /**\r\n     * Wrapper around game.settings.set. Ensures scope is correct.\r\n     * @param key\r\n     * @param value\r\n     */\r\n    public static async set(key: string, value: any) {\r\n        return game.settings.set(Settings.EXTERNAL_SYSTEM_NAME, key, value);\r\n    }\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport PreloadEvent from './events/PreloadEvent';\r\nimport Viewer from '../viewer/Viewer';\r\nimport Api from '../Api';\r\nimport Settings from '../settings/Settings';\r\nimport SetViewEvent from './events/SetViewEvent';\r\nimport PDFCache from '../cache/PDFCache';\r\n\r\n/**\r\n * @private\r\n */\r\nexport class Socket {\r\n    public static initialize() {\r\n        // @ts-ignore\r\n        game.socket.on(Settings.SOCKET_NAME, (event) => {\r\n            const { userIds, type, payload } = event;\r\n            // null = all users, otherwise check if this event effects us\r\n            if (userIds !== null && !userIds.includes(game.userId)) {\r\n                return;\r\n            }\r\n\r\n            if (type === SetViewEvent.EVENT_TYPE) {\r\n                Socket.handleSetView(payload);\r\n                return;\r\n            } else if (type === PreloadEvent.EVENT_TYPE) {\r\n                Socket.handlePreloadPDF(payload);\r\n                return;\r\n            } else {\r\n                if (type.includes('PDFOUNDRY')) {\r\n                    console.error(`Event of type ${type} has no handler.`);\r\n                    return;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    public static handleSetView(data: any) {\r\n        if (Settings.get(Settings.SETTING_KEY.EXISTING_VIEWER)) {\r\n            function appIsViewer(app: Application): app is Viewer {\r\n                return app['pdfData'] !== undefined;\r\n            }\r\n\r\n            for (const app of Object.values(ui.windows)) {\r\n                if (!appIsViewer(app)) {\r\n                    continue;\r\n                }\r\n\r\n                const pdfData = app.pdfData;\r\n                if (data.pdfData.url === pdfData.url) {\r\n                    app.page = data.page;\r\n                    return;\r\n                }\r\n            }\r\n            // App not found, fall through.\r\n        }\r\n        Api.openPDF(data.pdfData, data.page);\r\n    }\r\n\r\n    public static handlePreloadPDF(data: any) {\r\n        PDFCache.preload(data.url);\r\n    }\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport SocketEvent from './SocketEvent';\r\n\r\n/**\r\n * @private\r\n */\r\nexport default class PreloadEvent extends SocketEvent {\r\n    public static get EVENT_TYPE() {\r\n        return `${super.EVENT_TYPE}/PRELOAD_PDF`;\r\n    }\r\n\r\n    get type() {\r\n        return PreloadEvent.EVENT_TYPE;\r\n    }\r\n\r\n    public url: string;\r\n\r\n    constructor(userIds: string[] | null, url: string) {\r\n        super(userIds);\r\n\r\n        this.url = url;\r\n    }\r\n\r\n    protected getPayload(): any {\r\n        const payload = super.getPayload();\r\n        payload.url = this.url;\r\n        return payload;\r\n    }\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport SocketEvent from './SocketEvent';\r\nimport { PDFData } from '../../common/types/PDFData';\r\n\r\n/**\r\n * @private\r\n */\r\nexport default class SetViewEvent extends SocketEvent {\r\n    public static get EVENT_TYPE() {\r\n        return `${super.EVENT_TYPE}/SET_VIEW`;\r\n    }\r\n\r\n    get type() {\r\n        return SetViewEvent.EVENT_TYPE;\r\n    }\r\n\r\n    public page: number;\r\n    public pdfData: PDFData;\r\n\r\n    constructor(userIds: string[] | null, pdfData: PDFData, page: number) {\r\n        super(userIds);\r\n\r\n        this.pdfData = pdfData;\r\n        this.page = page;\r\n    }\r\n\r\n    protected getPayload() {\r\n        const payload = super.getPayload();\r\n        payload.pdfData = this.pdfData;\r\n        payload.page = this.page;\r\n        return payload;\r\n    }\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport Settings from '../../settings/Settings';\r\n\r\n/**\r\n * @private\r\n */\r\nexport default abstract class SocketEvent {\r\n    /**\r\n     * The type of this event.\r\n     */\r\n    public static get EVENT_TYPE() {\r\n        return 'PDFOUNDRY';\r\n    }\r\n\r\n    /**\r\n     * The type of this event.\r\n     */\r\n    public abstract get type();\r\n\r\n    /**\r\n     * The user ids that should handle this event.\r\n     */\r\n    protected userIds: string[] | null;\r\n\r\n    protected constructor(userIds: string[] | null) {\r\n        this.userIds = userIds;\r\n    }\r\n\r\n    /**\r\n     * Get any data that will be sent with the event.\r\n     */\r\n    protected getPayload(): any {\r\n        return {};\r\n    }\r\n\r\n    public emit() {\r\n        // @ts-ignore\r\n        game.socket.emit(Settings.SOCKET_NAME, {\r\n            type: this.type,\r\n            userIds: this.userIds,\r\n            payload: this.getPayload(),\r\n        });\r\n    }\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport PlayerSelect from '../app/PlayerSelect';\r\nimport { getUserIdsExceptMe } from '../Util';\r\nimport { PDFViewerEvent } from '../common/types/PDFHooks';\r\nimport { PDFData } from '../common/types/PDFData';\r\nimport { PDFjsViewer } from '../common/types/PDFjsViewer';\r\nimport Settings from '../settings/Settings';\r\nimport { PDFjsEventBus } from '../common/types/PDFjsEventBus';\r\nimport SetViewEvent from '../socket/events/SetViewEvent';\r\nimport EventStore from '../common/helpers/events';\r\n\r\n/**\r\n * The PDFoundry Viewer class provides the core logic opening PDFs and binding their events.\r\n * You cannot create a new instance of this class, you must do so with the API.\r\n *\r\n * See {@link Api.openPDF}, {@link Api.openPDFByCode}, {@link Api.openPDFByName}, {@link Api.openURL} which all return a\r\n * promise which resolve with an instance of this class.\r\n */\r\nexport default class Viewer extends Application {\r\n    static get defaultOptions() {\r\n        const options = super.defaultOptions;\r\n        options.classes = ['app', 'window-app', 'pdfoundry-viewer'];\r\n        options.template = `systems/${Settings.EXTERNAL_SYSTEM_NAME}/pdfoundry-dist/templates/app/pdf-viewer.html`;\r\n        options.title = game.i18n.localize('PDFOUNDRY.VIEWER.ViewPDF');\r\n        options.width = 8.5 * 100 + 64;\r\n        options.height = 11 * 100 + 64;\r\n        options.resizable = true;\r\n        return options;\r\n    }\r\n\r\n    protected _frame: HTMLIFrameElement;\r\n    protected _viewer: PDFjsViewer;\r\n    protected _eventBus: PDFjsEventBus;\r\n    protected _pdfData: PDFData;\r\n    protected _eventStore: EventStore<PDFViewerEvent>;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    constructor(pdfData?: PDFData, options?: ApplicationOptions) {\r\n        super(options);\r\n\r\n        if (pdfData === undefined) {\r\n            pdfData = {\r\n                name: game.i18n.localize('PDFOUNDRY.VIEWER.Title'),\r\n                code: '',\r\n                offset: 0,\r\n                url: '',\r\n                cache: false,\r\n            };\r\n        }\r\n\r\n        this._pdfData = pdfData;\r\n        this._eventStore = new EventStore<PDFViewerEvent>();\r\n    }\r\n\r\n    // <editor-fold desc=\"Getters & Setters\">\r\n\r\n    /**\r\n     * Returns a copy of the PDFData this viewer is using.\r\n     * Changes to this data will not reflect in the viewer.\r\n     */\r\n    public get pdfData() {\r\n        return duplicate(this._pdfData);\r\n    }\r\n\r\n    /**\r\n     * Get the currently viewed page.\r\n     */\r\n    public get page() {\r\n        return this._viewer.page;\r\n    }\r\n\r\n    /**\r\n     * Set the currently viewed page.\r\n     * @param value\r\n     */\r\n    public set page(value: number) {\r\n        this._viewer.page = value;\r\n    }\r\n\r\n    // </editor-fold>\r\n\r\n    // <editor-fold desc=\"Foundry Overrides\">\r\n\r\n    public get title(): string {\r\n        let title = this._pdfData.name;\r\n        if (this._pdfData.code !== '') {\r\n            title = `${title} (${this._pdfData.code})`;\r\n        }\r\n        return title;\r\n    }\r\n\r\n    protected _getHeaderButtons(): any[] {\r\n        const buttons = super._getHeaderButtons();\r\n        //TODO: Standardize this to function w/ the Item sheet one\r\n        buttons.unshift({\r\n            class: 'pdf-sheet-github',\r\n            icon: 'fas fa-external-link-alt',\r\n            label: 'PDFoundry',\r\n            onclick: () => window.open('https://github.com/Djphoenix719/PDFoundry', '_blank'),\r\n        });\r\n\r\n        buttons.unshift({\r\n            class: 'pdf-sheet-show-players',\r\n            icon: 'fas fa-eye',\r\n            label: game.i18n.localize('PDFOUNDRY.VIEWER.ShowToPlayersText'),\r\n            onclick: (event) => this.showTo(event),\r\n        });\r\n\r\n        return buttons;\r\n    }\r\n\r\n    public getData(options?: any): any | Promise<any> {\r\n        const data = super.getData(options);\r\n        data.systemName = Settings.EXTERNAL_SYSTEM_NAME;\r\n        return data;\r\n    }\r\n\r\n    protected async activateListeners(html: JQuery): Promise<void> {\r\n        this._eventStore.fire('viewerOpening', this);\r\n        super.activateListeners(html);\r\n\r\n        this._frame = html.parent().find('iframe.pdfViewer').get(0) as HTMLIFrameElement;\r\n        this.getViewer().then(async (viewer) => {\r\n            this._viewer = viewer;\r\n\r\n            this._eventStore.fire('viewerOpened', this);\r\n\r\n            this.getEventBus().then((eventBus) => {\r\n                this._eventBus = eventBus;\r\n                this._eventBus.on('pagerendered', this.onPageRendered.bind(this));\r\n                this._eventBus.on('pagechanging', this.onPageChanging.bind(this));\r\n                this._eventBus.on('updateviewarea', this.onViewAreaUpdated.bind(this));\r\n                this._eventBus.on('scalechanging', this.onScaleChanging.bind(this));\r\n\r\n                // const listeners = eventBus._listeners;\r\n                // for (const eventName of Object.keys(listeners)) {\r\n                //     eventBus.on(eventName, (...args) => {\r\n                //         Viewer.logEvent(eventName, args);\r\n                //     });\r\n                // }\r\n\r\n                this._eventStore.fire('viewerReady', this);\r\n            });\r\n        });\r\n\r\n        // _getHeaderButtons does not permit titles...\r\n        $(html).parents().parents().find('.pdf-sheet-show-players').prop('title', game.i18n.localize('PDFOUNDRY.VIEWER.ShowToPlayersTitle'));\r\n    }\r\n\r\n    // </editor-fold>\r\n\r\n    // <editor-fold desc=\"Events\">\r\n\r\n    protected onPageChanging(event) {\r\n        this._eventStore.fire('pageChanging', this, {\r\n            pageLabel: event.pageLabel,\r\n            pageNumber: event.pageNumber,\r\n        });\r\n    }\r\n\r\n    protected onPageRendered(event) {\r\n        this._eventStore.fire('pageRendered', this, {\r\n            pageNumber: event.pageNumber,\r\n            pageLabel: event.source.pageLabel,\r\n            width: event.source.width,\r\n            height: event.source.height,\r\n            rotation: event.source.rotation,\r\n            scale: event.source.scale,\r\n            canvas: event.source.canvas,\r\n            div: event.source.div,\r\n            error: event.source.error,\r\n        });\r\n    }\r\n\r\n    protected onViewAreaUpdated(event) {\r\n        this._eventStore.fire('viewAreaUpdated', this, {\r\n            top: event.location.top,\r\n            left: event.location.left,\r\n            pageNumber: event.location.pageNumber,\r\n            rotation: event.location.rotation,\r\n            scale: event.location.scale,\r\n        });\r\n    }\r\n\r\n    protected onScaleChanging(event) {\r\n        this._eventStore.fire('scaleChanging', this, {\r\n            presetValue: event.presetValue,\r\n            scale: event.scale,\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Register a callback to occur when an event fires. See individual events for descriptions and use {@link Api.DEBUG.EVENTS} to log and analyze events.\r\n     * @param eventName\r\n     * @param callback\r\n     */\r\n    public on(eventName: PDFViewerEvent, callback: Function): void {\r\n        this._eventStore.on(eventName, callback);\r\n    }\r\n\r\n    /**\r\n     * Deregister an event that has been registered with {@link on} or {@link once}.\r\n     * @param eventName\r\n     * @param callback\r\n     */\r\n    public off(eventName: PDFViewerEvent, callback: Function): void {\r\n        this._eventStore.off(eventName, callback);\r\n    }\r\n\r\n    /**\r\n     * Like {@link on} but only fires on the next occurrence.\r\n     * @param eventName\r\n     * @param callback\r\n     */\r\n    public once(eventName: PDFViewerEvent, callback: Function): void {\r\n        this._eventStore.once(eventName, callback);\r\n    }\r\n\r\n    // </editor-fold>\r\n\r\n    // private static logEvent(key: string, ...args) {\r\n    //     console.warn(key);\r\n    //     console.warn(args);\r\n    // }\r\n\r\n    public async close(): Promise<any> {\r\n        this._eventStore.fire('viewerClosed', this);\r\n        return super.close();\r\n    }\r\n\r\n    /**\r\n     * Show the current page to GMs.\r\n     */\r\n    protected showTo(event: MouseEvent) {\r\n        const pdfData = this.pdfData;\r\n        pdfData.offset = 0;\r\n\r\n        const ids = getUserIdsExceptMe();\r\n        if (event.shiftKey) {\r\n            new SetViewEvent(ids, pdfData, this.page).emit();\r\n        } else {\r\n            new PlayerSelect(ids, (filteredIds) => {\r\n                new SetViewEvent(filteredIds, pdfData, this.page).emit();\r\n            }).render(true);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Wait for the internal PDFjs viewer to be ready and usable.\r\n     */\r\n    protected getViewer(): Promise<PDFjsViewer> {\r\n        if (this._viewer) {\r\n            return Promise.resolve(this._viewer);\r\n        }\r\n\r\n        return new Promise<any>((resolve) => {\r\n            let timeout;\r\n            const returnOrWait = () => {\r\n                // If our window has finished initializing...\r\n                if (this._frame) {\r\n                    // If PDFjs has finished initializing...\r\n                    if (this._frame.contentWindow && this._frame.contentWindow['PDFViewerApplication']) {\r\n                        const viewer = this._frame.contentWindow['PDFViewerApplication'];\r\n                        resolve(viewer);\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                // If any ifs fall through, try again in a few ms\r\n                timeout = setTimeout(returnOrWait, 5);\r\n            };\r\n            returnOrWait();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Wait for the internal PDFjs eventBus to be ready and usable.\r\n     */\r\n    protected getEventBus(): Promise<PDFjsEventBus> {\r\n        if (this._eventBus) {\r\n            return Promise.resolve(this._eventBus);\r\n        }\r\n\r\n        return new Promise<any>((resolve) => {\r\n            this.getViewer().then((viewer) => {\r\n                let timeout;\r\n                const returnOrWait = () => {\r\n                    if (viewer.eventBus) {\r\n                        resolve(viewer.eventBus);\r\n                        return;\r\n                    }\r\n                    timeout = setTimeout(returnOrWait, 5);\r\n                };\r\n                returnOrWait();\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Finish the download and return the byte array for the file.\r\n     */\r\n    public download(): Promise<Uint8Array> {\r\n        return new Promise<Uint8Array>(async (resolve) => {\r\n            const viewer = await this.getViewer();\r\n            let timeout;\r\n            const returnOrWait = () => {\r\n                if (viewer.downloadComplete) {\r\n                    resolve(viewer.pdfDocument.getData());\r\n                    return;\r\n                }\r\n\r\n                timeout = setTimeout(returnOrWait, 50);\r\n            };\r\n            returnOrWait();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Open a PDF\r\n     * @param pdfSource A URL or byte array to open.\r\n     * @param page The initial page to open to\r\n     */\r\n    public async open(pdfSource: string | Uint8Array, page?: number) {\r\n        const pdfjsViewer = await this.getViewer();\r\n\r\n        if (page) {\r\n            pdfjsViewer.initialBookmark = `page=${page}`;\r\n        }\r\n\r\n        await pdfjsViewer.open(pdfSource);\r\n    }\r\n}\r\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvcGRmb3VuZHJ5L0FwaS50cyIsInNyYy9wZGZvdW5kcnkvTWFpbi50cyIsInNyYy9wZGZvdW5kcnkvU2V0dXAudHMiLCJzcmMvcGRmb3VuZHJ5L1V0aWwudHMiLCJzcmMvcGRmb3VuZHJ5L2FwcC9QREZJdGVtU2hlZXQudHMiLCJzcmMvcGRmb3VuZHJ5L2FwcC9QbGF5ZXJTZWxlY3QudHMiLCJzcmMvcGRmb3VuZHJ5L2NhY2hlL0NhY2hlRXJyb3IudHMiLCJzcmMvcGRmb3VuZHJ5L2NhY2hlL0NhY2hlSGVscGVyLnRzIiwic3JjL3BkZm91bmRyeS9jYWNoZS9QREZDYWNoZS50cyIsInNyYy9wZGZvdW5kcnkvY29tbW9uL2hlbHBlcnMvZXZlbnRzLnRzIiwic3JjL3BkZm91bmRyeS9lbnJpY2hlci9IVE1MRW5yaWNoZXIudHMiLCJzcmMvcGRmb3VuZHJ5L2VucmljaGVyL1RpbnlNQ0VQbHVnaW4udHMiLCJzcmMvcGRmb3VuZHJ5L3NldHRpbmdzL0kxOG4udHMiLCJzcmMvcGRmb3VuZHJ5L3NldHRpbmdzL1NldHRpbmdzLnRzIiwic3JjL3BkZm91bmRyeS9zb2NrZXQvU29ja2V0LnRzIiwic3JjL3BkZm91bmRyeS9zb2NrZXQvZXZlbnRzL1ByZWxvYWRFdmVudC50cyIsInNyYy9wZGZvdW5kcnkvc29ja2V0L2V2ZW50cy9TZXRWaWV3RXZlbnQudHMiLCJzcmMvcGRmb3VuZHJ5L3NvY2tldC9ldmVudHMvU29ja2V0RXZlbnQudHMiLCJzcmMvcGRmb3VuZHJ5L3ZpZXdlci9WaWV3ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7O0FDQUE7Ozs7Ozs7Ozs7Ozs7R0FhRzs7Ozs7Ozs7Ozs7QUFFSCxpQ0FBNkY7QUFDN0YsNENBQXFDO0FBRXJDLGtEQUEyQztBQUMzQywrQ0FBd0M7QUFPeEM7Ozs7Ozs7R0FPRztBQUNILFNBQWUsV0FBVyxDQUFDLE1BQWMsRUFBRSxHQUFX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LEVBQUUsSUFBYTs7WUFDM0QsTUFBTSxXQUFXLEdBQUcsTUFBTSxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7WUFFM0MsSUFBSSxJQUFJLEVBQUU7Z0JBQ04sV0FBVyxDQUFDLGVBQWUsR0FBRyxRQUFRLElBQUksRUFBRSxDQUFDO2FBQ2hEO1lBRUQsTUFBTSxXQUFXLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3RDLENBQUM7S0FBQTtDQUNKO0FBM1RELHlCQTJUQyIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsIi8qIENvcHlyaWdodCAyMDIwIEFuZHJldyBDdWNjaW5lbGxvXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuXHJcbmltcG9ydCB7IGZpbGVFeGlzdHMsIGdldEFic29sdXRlVVJMLCBnZXRQREZEYXRhRnJvbUl0ZW0sIHZhbGlkYXRlQWJzb2x1dGVVUkwgfSBmcm9tICcuL1V0aWwnO1xyXG5pbXBvcnQgVmlld2VyIGZyb20gJy4vdmlld2VyL1ZpZXdlcic7XHJcbmltcG9ydCB7IFBERkRhdGEgfSBmcm9tICcuL2NvbW1vbi90eXBlcy9QREZEYXRhJztcclxuaW1wb3J0IFNldHRpbmdzIGZyb20gJy4vc2V0dGluZ3MvU2V0dGluZ3MnO1xyXG5pbXBvcnQgUERGQ2FjaGUgZnJvbSAnLi9jYWNoZS9QREZDYWNoZSc7XHJcblxyXG4vKipcclxuICogQSBmdW5jdGlvbiB0byBwYXNzZWQgdG8gZ2V0UERGRGF0YSB0byBmaW5kIHVzZXIgc3BlY2lmaWVkIFBERiBkYXRhLlxyXG4gKi9cclxudHlwZSBJdGVtQ29tcGFyZXIgPSAoaXRlbTogSXRlbSkgPT4gYm9vbGVhbjtcclxuXHJcbi8qKlxyXG4gKiBPcGVuIHRoZSBzcGVjaWZpZWQgUERGIGluIGEgcHJvdmlkZWQgdmlld2VyXHJcbiAqIEBwYXJhbSB2aWV3ZXJcclxuICogQHBhcmFtIHVybFxyXG4gKiBAcGFyYW0gcGFnZVxyXG4gKiBAcGFyYW0gY2FjaGVcclxuICogQHByaXZhdGVcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIF9oYW5kbGVPcGVuKHZpZXdlcjogVmlld2VyLCB1cmw6IHN0cmluZywgcGFnZTogbnVtYmVyLCBjYWNoZTogYm9vbGVhbikge1xyXG4gICAgaWYgKGNhY2hlKSB7XHJcbiAgICAgICAgY29uc3QgY2FjaGVkQnl0ZXMgPSBhd2FpdCBQREZDYWNoZS5nZXRDYWNoZSh1cmwpO1xyXG4gICAgICAgIC8vIElmIHdlIGhhdmUgYSBjYWNoZSBoaXQgb3BlbiB0aGUgY2FjaGVkIGRhdGFcclxuICAgICAgICBpZiAoY2FjaGVkQnl0ZXMpIHtcclxuICAgICAgICAgICAgYXdhaXQgdmlld2VyLm9wZW4oY2FjaGVkQnl0ZXMsIHBhZ2UpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIE90aGVyd2lzZSB3ZSBzaG91bGQgb3BlbiBpdCBieSB1cmxcclxuICAgICAgICAgICAgYXdhaXQgdmlld2VyLm9wZW4odXJsLCBwYWdlKTtcclxuICAgICAgICAgICAgLy8gQW5kIHdoZW4gdGhlIGRvd25sb2FkIGlzIGNvbXBsZXRlIHNldCB0aGUgY2FjaGVcclxuICAgICAgICAgICAgdmlld2VyLmRvd25sb2FkKCkudGhlbigoYnl0ZXMpID0+IHtcclxuICAgICAgICAgICAgICAgIFBERkNhY2hlLnNldENhY2hlKHVybCwgYnl0ZXMpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGF3YWl0IHZpZXdlci5vcGVuKHVybCwgcGFnZSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBUaGUgUERGb3VuZHJ5IEFQSVxyXG4gKlxyXG4gKiAjIyBZb3UgY2FuIGFjY2VzcyB0aGUgQVBJIHdpdGggYHVpLlBERm91bmRyeWAuXHJcbiAqL1xyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBcGkge1xyXG4gICAgLyoqXHJcbiAgICAgKiBFbmFibGUgYWRkaXRpb25hbCBkZWJ1ZyBpbmZvcm1hdGlvbiBmb3IgdGhlIHNwZWNpZmllZCBjYXRlZ29yeS5cclxuICAgICAqIEBjYXRlZ29yeSBEZWJ1Z1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIERFQlVHID0ge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFdoZW4gc2V0IHRvIHRydWUsIGVuYWJsZXMgdGhlIGxvZ2dpbmcgZXZlbnQgbmFtZXMgYW5kIGFyZ3VtZW50cyB0byBjb25zb2xlLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIEVWRU5UUzogZmFsc2UsXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIDxlZGl0b3ItZm9sZCBkZXNjPVwiR2V0UERGRGF0YSBNZXRob2RzXCI+XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBIZWxwZXIgbWV0aG9kLiBBbGlhcyBmb3Ige0BsaW5rIEFwaS5nZXRQREZEYXRhfSB3aXRoIGEgY29tcGFyZXIgdGhhdCBzZWFyY2hlcyBieSBQREYgQ29kZS5cclxuICAgICAqIEBwYXJhbSBjb2RlIFdoaWNoIGNvZGUgdG8gc2VhcmNoIGZvciBhIFBERiB3aXRoLlxyXG4gICAgICogQGNhdGVnb3J5IFBERkRhdGFcclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBnZXRQREZEYXRhQnlDb2RlKGNvZGU6IHN0cmluZyk6IFBERkRhdGEgfCBudWxsIHtcclxuICAgICAgICByZXR1cm4gQXBpLmdldFBERkRhdGEoKGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW0uZGF0YS5kYXRhLmNvZGUgPT09IGNvZGU7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBIZWxwZXIgbWV0aG9kLiBBbGlhcyBmb3Ige0BsaW5rIEFwaS5nZXRQREZEYXRhfSB3aXRoIGEgY29tcGFyZXIgdGhhdCBzZWFyY2hlcyBieSBQREYgTmFtZS5cclxuICAgICAqIEBwYXJhbSBuYW1lIFdoaWNoIG5hbWUgdG8gc2VhcmNoIGZvciBhIFBERiB3aXRoLlxyXG4gICAgICogQHBhcmFtIGNhc2VJbnNlbnNpdGl2ZSBJZiBhIGNhc2UgaW5zZW5zaXRpdmUgc2VhcmNoIHNob3VsZCBiZSBkb25lLlxyXG4gICAgICogQGNhdGVnb3J5IFBERkRhdGFcclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBnZXRQREZEYXRhQnlOYW1lKG5hbWU6IHN0cmluZywgY2FzZUluc2Vuc2l0aXZlOiBib29sZWFuID0gdHJ1ZSk6IFBERkRhdGEgfCBudWxsIHtcclxuICAgICAgICBpZiAoY2FzZUluc2Vuc2l0aXZlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBBcGkuZ2V0UERGRGF0YSgoaXRlbSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0ubmFtZS50b0xvd2VyQ2FzZSgpID09PSBuYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBBcGkuZ2V0UERGRGF0YSgoaXRlbSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0ubmFtZSA9PT0gbmFtZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogRmluZHMgYSBQREYgZW50aXR5IGNyZWF0ZWQgYnkgdGhlIHVzZXIgYW5kIGNvbnN0cnVjdHMgYSB7QGxpbmsgUERGRGF0YX0gb2JqZWN0IG9mIHRoZSByZXN1bHRpbmcgUERGJ3MgZGF0YS5cclxuICAgICAqIEBwYXJhbSBjb21wYXJlciBBIGNvbXBhcmlzb24gZnVuY3Rpb24gdGhhdCB3aWxsIGJlIHVzZWQuXHJcbiAgICAgKiBAcGFyYW0gYWxsb3dJbnZpc2libGUgSWYgdHJ1ZSwgUERGcyBoaWRkZW4gZnJvbSB0aGUgYWN0aXZlIHVzZXIgd2lsbCBiZSByZXR1cm5lZC5cclxuICAgICAqIEBjYXRlZ29yeSBQREZEYXRhXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgZ2V0UERGRGF0YShjb21wYXJlcjogSXRlbUNvbXBhcmVyLCBhbGxvd0ludmlzaWJsZTogYm9vbGVhbiA9IHRydWUpOiBQREZEYXRhIHwgbnVsbCB7XHJcbiAgICAgICAgY29uc3QgcGRmOiBJdGVtID0gZ2FtZS5pdGVtcy5maW5kKChpdGVtOiBJdGVtKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBpdGVtLnR5cGUgPT09IFNldHRpbmdzLlBERl9FTlRJVFlfVFlQRSAmJiAoaXRlbS52aXNpYmxlIHx8IGFsbG93SW52aXNpYmxlKSAmJiBjb21wYXJlcihpdGVtKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGdldFBERkRhdGFGcm9tSXRlbShwZGYpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIDwvZWRpdG9yLWZvbGQ+XHJcblxyXG4gICAgLy8gPGVkaXRvci1mb2xkIGRlc2M9XCJPcGVuUERGIE1ldGhvZHNcIj5cclxuXHJcbiAgICAvKipcclxuICAgICAqIE9wZW4gdGhlIFBERiB3aXRoIHRoZSBwcm92aWRlZCBjb2RlIHRvIHRoZSBzcGVjaWZpZWQgcGFnZS5cclxuICAgICAqIEhlbHBlciBmb3Ige0BsaW5rIGdldFBERkRhdGFCeUNvZGV9IHRoZW4ge0BsaW5rIG9wZW5QREZ9LlxyXG4gICAgICogQGNhdGVnb3J5IE9wZW5cclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBhc3luYyBvcGVuUERGQnlDb2RlKGNvZGU6IHN0cmluZywgcGFnZTogbnVtYmVyID0gMSk6IFByb21pc2U8Vmlld2VyPiB7XHJcbiAgICAgICAgY29uc3QgcGRmID0gdGhpcy5nZXRQREZEYXRhQnlDb2RlKGNvZGUpO1xyXG5cclxuICAgICAgICBpZiAocGRmID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gZ2FtZS5pMThuLmxvY2FsaXplKCdQREZPVU5EUlkuRVJST1IuTm9QREZXaXRoQ29kZScpO1xyXG5cclxuICAgICAgICAgICAgaWYgKFNldHRpbmdzLk5PVElGSUNBVElPTlMpIHtcclxuICAgICAgICAgICAgICAgIHVpLm5vdGlmaWNhdGlvbnMuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3BlblBERihwZGYsIHBhZ2UpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogT3BlbiB0aGUgUERGIHdpdGggdGhlIHByb3ZpZGVkIGNvZGUgdG8gdGhlIHNwZWNpZmllZCBwYWdlLlxyXG4gICAgICogSGVscGVyIGZvciB7QGxpbmsgZ2V0UERGRGF0YUJ5Q29kZX0gdGhlbiB7QGxpbmsgb3BlblBERn0uXHJcbiAgICAgKiBAY2F0ZWdvcnkgT3BlblxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGFzeW5jIG9wZW5QREZCeU5hbWUobmFtZTogc3RyaW5nLCBwYWdlOiBudW1iZXIgPSAxKTogUHJvbWlzZTxWaWV3ZXI+IHtcclxuICAgICAgICBjb25zdCBwZGYgPSB0aGlzLmdldFBERkRhdGFCeU5hbWUobmFtZSk7XHJcblxyXG4gICAgICAgIGlmIChwZGYgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGdhbWUuaTE4bi5sb2NhbGl6ZSgnUERGT1VORFJZLkVSUk9SLk5vUERGV2l0aE5hbWUnKTtcclxuICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IobWVzc2FnZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoU2V0dGluZ3MuTk9USUZJQ0FUSU9OUykge1xyXG4gICAgICAgICAgICAgICAgdWkubm90aWZpY2F0aW9ucy5lcnJvcihlcnJvci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLm9wZW5QREYocGRmLCBwYWdlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIE9wZW4gdGhlIHByb3ZpZGVkIHtAbGluayBQREZEYXRhfSB0byB0aGUgc3BlY2lmaWVkIHBhZ2UuXHJcbiAgICAgKiBAcGFyYW0gcGRmIFRoZSBQREYgdG8gb3Blbi4gU2VlIHtAbGluayBBcGkuZ2V0UERGRGF0YX0uXHJcbiAgICAgKiBAcGFyYW0gcGFnZSBUaGUgcGFnZSB0byBvcGVuIHRoZSBQREYgdG8uXHJcbiAgICAgKiBAY2F0ZWdvcnkgT3BlblxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGFzeW5jIG9wZW5QREYocGRmOiBQREZEYXRhLCBwYWdlOiBudW1iZXIgPSAxKTogUHJvbWlzZTxWaWV3ZXI+IHtcclxuICAgICAgICBsZXQgeyB1cmwsIG9mZnNldCwgY2FjaGUgfSA9IHBkZjtcclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZiBvZmZzZXQgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIG9mZnNldCA9IHBhcnNlSW50KG9mZnNldCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXZhbGlkYXRlQWJzb2x1dGVVUkwodXJsKSkge1xyXG4gICAgICAgICAgICB1cmwgPSBnZXRBYnNvbHV0ZVVSTCh1cmwpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3Qgdmlld2VyID0gbmV3IFZpZXdlcihwZGYpO1xyXG4gICAgICAgIHZpZXdlci5yZW5kZXIodHJ1ZSk7XHJcblxyXG4gICAgICAgIGF3YWl0IF9oYW5kbGVPcGVuKHZpZXdlciwgdXJsLCBwYWdlICsgb2Zmc2V0LCBjYWNoZSk7XHJcblxyXG4gICAgICAgIHJldHVybiB2aWV3ZXI7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBPcGVuIGEgVVJMIGFzIGEgUERGLlxyXG4gICAgICogQHBhcmFtIHVybCBUaGUgVVJMIHRvIG9wZW4gKG11c3QgYmUgYWJzb2x1dGUpLlxyXG4gICAgICogQHBhcmFtIHBhZ2UgV2hpY2ggcGFnZSB0byBvcGVuIHRvLiBNdXN0IGJlID49IDEuXHJcbiAgICAgKiBAcGFyYW0gY2FjaGUgSWYgVVJMIGJhc2VkIGNhY2hpbmcgc2hvdWxkIGJlIHVzZWQuXHJcbiAgICAgKiBAY2F0ZWdvcnkgT3BlblxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGFzeW5jIG9wZW5VUkwodXJsOiBzdHJpbmcsIHBhZ2U6IG51bWJlciA9IDEsIGNhY2hlOiBib29sZWFuID0gdHJ1ZSk6IFByb21pc2U8Vmlld2VyPiB7XHJcbiAgICAgICAgaWYgKGlzTmFOKHBhZ2UpIHx8IHBhZ2UgPD0gMCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFBhZ2UgbXVzdCBiZSA+IDAsIGJ1dCAke3BhZ2V9IHdhcyBnaXZlbi5gKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghdmFsaWRhdGVBYnNvbHV0ZVVSTCh1cmwpKSB7XHJcbiAgICAgICAgICAgIHVybCA9IGdldEFic29sdXRlVVJMKHVybCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB2aWV3ZXIgPSBuZXcgVmlld2VyKCk7XHJcbiAgICAgICAgdmlld2VyLnJlbmRlcih0cnVlKTtcclxuXHJcbiAgICAgICAgYXdhaXQgX2hhbmRsZU9wZW4odmlld2VyLCB1cmwsIHBhZ2UsIGNhY2hlKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHZpZXdlcjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFNob3dzIHRoZSB1c2VyIG1hbnVhbCB0byB0aGUgYWN0aXZlIHVzZXIuXHJcbiAgICAgKiBAY2F0ZWdvcnkgVXRpbGl0eVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGFzeW5jIHNob3dIZWxwKCk6IFByb21pc2U8Vmlld2VyPiB7XHJcbiAgICAgICAgYXdhaXQgZ2FtZS51c2VyLnNldEZsYWcoU2V0dGluZ3MuRVhURVJOQUxfU1lTVEVNX05BTUUsIFNldHRpbmdzLlNFVFRJTkdfS0VZLkhFTFBfU0VFTiwgdHJ1ZSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGxhbmcgPSBnYW1lLmkxOG4ubGFuZztcclxuICAgICAgICBsZXQgbWFudWFsUGF0aCA9IGAke3dpbmRvdy5vcmlnaW59L3N5c3RlbXMvJHtTZXR0aW5ncy5ESVNUX1BBVEh9L2Fzc2V0cy9tYW51YWwvJHtsYW5nfS9tYW51YWwucGRmYDtcclxuICAgICAgICBjb25zdCBtYW51YWxFeGlzdHMgPSBhd2FpdCBmaWxlRXhpc3RzKG1hbnVhbFBhdGgpO1xyXG5cclxuICAgICAgICBpZiAoIW1hbnVhbEV4aXN0cykge1xyXG4gICAgICAgICAgICBtYW51YWxQYXRoID0gYCR7d2luZG93Lm9yaWdpbn0vc3lzdGVtcy8ke1NldHRpbmdzLkRJU1RfUEFUSH0vYXNzZXRzL21hbnVhbC9lbi9tYW51YWwucGRmYDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHBkZkRhdGE6IFBERkRhdGEgPSB7XHJcbiAgICAgICAgICAgIG5hbWU6IGdhbWUuaTE4bi5sb2NhbGl6ZSgnUERGT1VORFJZLk1BTlVBTC5OYW1lJyksXHJcbiAgICAgICAgICAgIGNvZGU6ICcnLFxyXG4gICAgICAgICAgICBvZmZzZXQ6IDAsXHJcbiAgICAgICAgICAgIHVybDogbWFudWFsUGF0aCxcclxuICAgICAgICAgICAgY2FjaGU6IGZhbHNlLFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBBcGkub3BlblBERihwZGZEYXRhKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyA8L2VkaXRvci1mb2xkPlxyXG59XHJcbiIsIi8qIENvcHlyaWdodCAyMDIwIEFuZHJldyBDdWNjaW5lbGxvXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuXHJcbmltcG9ydCBTZXR1cCBmcm9tICcuL1NldHVwJztcclxuXHJcblNldHVwLnJ1bigpO1xyXG4iLCIvKiBDb3B5cmlnaHQgMjAyMCBBbmRyZXcgQ3VjY2luZWxsb1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcblxyXG5pbXBvcnQgeyBnZXRBYnNvbHV0ZVVSTCwgZ2V0UERGRGF0YUZyb21JdGVtIH0gZnJvbSAnLi9VdGlsJztcclxuaW1wb3J0IHsgUERGSXRlbVNoZWV0IH0gZnJvbSAnLi9hcHAvUERGSXRlbVNoZWV0JztcclxuaW1wb3J0IFByZWxvYWRFdmVudCBmcm9tICcuL3NvY2tldC9ldmVudHMvUHJlbG9hZEV2ZW50JztcclxuaW1wb3J0IHsgU29ja2V0IH0gZnJvbSAnLi9zb2NrZXQvU29ja2V0JztcclxuaW1wb3J0IFNldHRpbmdzIGZyb20gJy4vc2V0dGluZ3MvU2V0dGluZ3MnO1xyXG5pbXBvcnQgUERGQ2FjaGUgZnJvbSAnLi9jYWNoZS9QREZDYWNoZSc7XHJcbmltcG9ydCBJMThuIGZyb20gJy4vc2V0dGluZ3MvSTE4bic7XHJcbmltcG9ydCBBcGkgZnJvbSAnLi9BcGknO1xyXG5pbXBvcnQgSFRNTEVucmljaGVyIGZyb20gJy4vZW5yaWNoZXIvSFRNTEVucmljaGVyJztcclxuaW1wb3J0IFRpbnlNQ0VQbHVnaW4gZnJvbSAnLi9lbnJpY2hlci9UaW55TUNFUGx1Z2luJztcclxuXHJcbi8qKlxyXG4gKiBBIGNvbGxlY3Rpb24gb2YgbWV0aG9kcyB1c2VkIGZvciBzZXR0aW5nIHVwIHRoZSBBUEkgJiBzeXN0ZW0gc3RhdGUuXHJcbiAqIEBwcml2YXRlXHJcbiAqL1xyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTZXR1cCB7XHJcbiAgICAvKipcclxuICAgICAqIFJ1biBzZXR1cCB0YXNrcy5cclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBydW4oKSB7XHJcbiAgICAgICAgLy8gUmVnaXN0ZXIgdGhlIFBERm91bmRyeSBBUGkgb24gdGhlIFVJXHJcbiAgICAgICAgdWlbJ1BERm91bmRyeSddID0gQXBpO1xyXG5cclxuICAgICAgICAvLyBSZWdpc3RlciBzeXN0ZW0gJiBjc3Mgc3luY2hyb25vdXNseVxyXG4gICAgICAgIFNldHVwLnJlZ2lzdGVyU3lzdGVtKCk7XHJcbiAgICAgICAgU2V0dXAuaW5qZWN0U3R5bGVzKCk7XHJcblxyXG4gICAgICAgIC8vIFNldHVwIHRhc2tzIHJlcXVpcmluZyBGVlRUIGlzIGxvYWRlZFxyXG4gICAgICAgIEhvb2tzLm9uY2UoJ3JlYWR5JywgU2V0dXAubGF0ZVJ1bik7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBMYXRlIHNldHVwIHRhc2tzIGhhcHBlbiB3aGVuIHRoZSBzeXN0ZW0gaXMgbG9hZGVkXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgbGF0ZVJ1bigpIHtcclxuICAgICAgICAvLyBSZWdpc3RlciB0aGUgUERGIHNoZWV0IHdpdGggdGhlIGNsYXNzIHBpY2tlclxyXG4gICAgICAgIFNldHVwLnNldHVwU2hlZXRzKCk7XHJcbiAgICAgICAgLy8gUmVnaXN0ZXIgc29ja2V0IGV2ZW50IGhhbmRsZXJzXHJcbiAgICAgICAgU29ja2V0LmluaXRpYWxpemUoKTtcclxuXHJcbiAgICAgICAgLy8gQmluZCBhbHdheXMtcnVuIGV2ZW50IGhhbmRsZXJzXHJcbiAgICAgICAgLy8gRW5yaWNoIEpvdXJuYWwgJiBJdGVtIFNoZWV0IHJpY2ggdGV4dCBsaW5rc1xyXG4gICAgICAgIEhvb2tzLm9uKCdyZW5kZXJJdGVtU2hlZXQnLCBIVE1MRW5yaWNoZXIuSGFuZGxlRW5yaWNoKTtcclxuICAgICAgICBIb29rcy5vbigncmVuZGVySm91cm5hbFNoZWV0JywgSFRNTEVucmljaGVyLkhhbmRsZUVucmljaCk7XHJcbiAgICAgICAgSG9va3Mub24oJ3JlbmRlckFjdG9yU2hlZXQnLCBIVE1MRW5yaWNoZXIuSGFuZGxlRW5yaWNoKTtcclxuXHJcbiAgICAgICAgLy8gUmVnaXN0ZXIgVGlueU1DRSBkcmFnICsgZHJvcCBldmVudHNcclxuICAgICAgICBUaW55TUNFUGx1Z2luLlJlZ2lzdGVyKCk7XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIEluaXRpYWxpemUgdGhlIHNldHRpbmdzXHJcbiAgICAgICAgICAgIGF3YWl0IFNldHRpbmdzLmluaXRpYWxpemUoKTtcclxuICAgICAgICAgICAgYXdhaXQgUERGQ2FjaGUuaW5pdGlhbGl6ZSgpO1xyXG4gICAgICAgICAgICBhd2FpdCBJMThuLmluaXRpYWxpemUoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFBERm91bmRyeSBpcyByZWFkeVxyXG4gICAgICAgICAgICBTZXR1cC51c2VyTG9naW4oKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEluamVjdCB0aGUgQ1NTIGZpbGUgaW50byB0aGUgaGVhZGVyLCBzbyBpdCBkb2Vzbid0IGhhdmUgdG8gYmUgcmVmZXJlbmNlZCBpbiB0aGUgc3lzdGVtLmpzb25cclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBpbmplY3RTdHlsZXMoKSB7XHJcbiAgICAgICAgY29uc3QgaGVhZCA9ICQoJ2hlYWQnKTtcclxuICAgICAgICBjb25zdCBsaW5rID0gYDxsaW5rIGhyZWY9XCJzeXN0ZW1zLyR7U2V0dGluZ3MuRElTVF9QQVRIfS9idW5kbGUuY3NzXCIgcmVsPVwic3R5bGVzaGVldFwiIHR5cGU9XCJ0ZXh0L2Nzc1wiIG1lZGlhPVwiYWxsXCI+YDtcclxuICAgICAgICBoZWFkLmFwcGVuZCgkKGxpbmspKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFB1bGxzIHRoZSBzeXN0ZW0gbmFtZSBmcm9tIHRoZSBzY3JpcHQgdGFncy5cclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyByZWdpc3RlclN5c3RlbSgpIHtcclxuICAgICAgICBjb25zdCBzY3JpcHRzID0gJCgnc2NyaXB0Jyk7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzY3JpcHRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNjcmlwdCA9IHNjcmlwdHMuZ2V0KGkpIGFzIEhUTUxTY3JpcHRFbGVtZW50O1xyXG4gICAgICAgICAgICBjb25zdCBmb2xkZXJzID0gc2NyaXB0LnNyYy5zcGxpdCgnLycpO1xyXG4gICAgICAgICAgICBjb25zdCBkaXN0SWR4ID0gZm9sZGVycy5pbmRleE9mKFNldHRpbmdzLkRJU1RfTkFNRSk7XHJcbiAgICAgICAgICAgIGlmIChkaXN0SWR4ID09PSAtMSkgY29udGludWU7XHJcblxyXG4gICAgICAgICAgICBpZiAoZm9sZGVyc1tkaXN0SWR4IC0gMV0gPT09ICdwZGZvdW5kcnknKSBicmVhaztcclxuXHJcbiAgICAgICAgICAgIFNldHRpbmdzLkVYVEVSTkFMX1NZU1RFTV9OQU1FID0gZm9sZGVyc1tkaXN0SWR4IC0gMV07XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJlZ2lzdGVyIHRoZSBQREYgc2hlZXQgYW5kIHVucmVnaXN0ZXIgaW52YWxpZCBzaGVldCB0eXBlcyBmcm9tIGl0LlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIHNldHVwU2hlZXRzKCkge1xyXG4gICAgICAgIEl0ZW1zLnJlZ2lzdGVyU2hlZXQoU2V0dGluZ3MuSU5URVJOQUxfTU9EVUxFX05BTUUsIFBERkl0ZW1TaGVldCwge1xyXG4gICAgICAgICAgICB0eXBlczogW1NldHRpbmdzLlBERl9FTlRJVFlfVFlQRV0sXHJcbiAgICAgICAgICAgIG1ha2VEZWZhdWx0OiB0cnVlLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBVbnJlZ2lzdGVyIGFsbCBvdGhlciBpdGVtIHNoZWV0cyBmb3IgdGhlIFBERiBlbnRpdHlcclxuICAgICAgICBjb25zdCBwZGZvdW5kcnlLZXkgPSBgJHtTZXR0aW5ncy5JTlRFUk5BTF9NT0RVTEVfTkFNRX0uJHtQREZJdGVtU2hlZXQubmFtZX1gO1xyXG4gICAgICAgIGNvbnN0IHNoZWV0cyA9IENPTkZJRy5JdGVtLnNoZWV0Q2xhc3Nlc1tTZXR0aW5ncy5QREZfRU5USVRZX1RZUEVdO1xyXG4gICAgICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKHNoZWV0cykpIHtcclxuICAgICAgICAgICAgY29uc3Qgc2hlZXQgPSBzaGVldHNba2V5XTtcclxuICAgICAgICAgICAgLy8ga2VlcCB0aGUgUERGb3VuZHJ5IHNoZWV0XHJcbiAgICAgICAgICAgIGlmIChzaGVldC5pZCA9PT0gcGRmb3VuZHJ5S2V5KSB7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gaWQgaXMgTU9EVUxFLkNMQVNTX05BTUVcclxuICAgICAgICAgICAgY29uc3QgW21vZHVsZV0gPSBzaGVldC5pZC5zcGxpdCgnLicpO1xyXG4gICAgICAgICAgICBJdGVtcy51bnJlZ2lzdGVyU2hlZXQobW9kdWxlLCBzaGVldC5jbHMsIHtcclxuICAgICAgICAgICAgICAgIHR5cGVzOiBbU2V0dGluZ3MuUERGX0VOVElUWV9UWVBFXSxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0IGFkZGl0aW9uYWwgY29udGV4dCBtZW51IGljb25zIGZvciBQREYgaXRlbXNcclxuICAgICAqIEBwYXJhbSBodG1sXHJcbiAgICAgKiBAcGFyYW0gb3B0aW9uc1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGdldEl0ZW1Db250ZXh0T3B0aW9ucyhodG1sLCBvcHRpb25zOiBhbnlbXSkge1xyXG4gICAgICAgIGNvbnN0IGdldEl0ZW1Gcm9tQ29udGV4dCA9IChodG1sOiBKUXVlcnk8SFRNTEVsZW1lbnQ+KTogSXRlbSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGlkID0gaHRtbC5kYXRhKCdlbnRpdHktaWQnKTtcclxuICAgICAgICAgICAgcmV0dXJuIGdhbWUuaXRlbXMuZ2V0KGlkKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAoZ2FtZS51c2VyLmlzR00pIHtcclxuICAgICAgICAgICAgb3B0aW9ucy51bnNoaWZ0KHtcclxuICAgICAgICAgICAgICAgIG5hbWU6IGdhbWUuaTE4bi5sb2NhbGl6ZSgnUERGT1VORFJZLkNPTlRFWFQuUHJlbG9hZFBERicpLFxyXG4gICAgICAgICAgICAgICAgaWNvbjogJzxpIGNsYXNzPVwiZmFzIGZhLWRvd25sb2FkIGZhLWZ3XCI+PC9pPicsXHJcbiAgICAgICAgICAgICAgICBjb25kaXRpb246IChlbnRpdHlIdG1sOiBKUXVlcnk8SFRNTEVsZW1lbnQ+KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IGdldEl0ZW1Gcm9tQ29udGV4dChlbnRpdHlIdG1sKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS50eXBlICE9PSBTZXR0aW5ncy5QREZfRU5USVRZX1RZUEUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyB1cmwgfSA9IGl0ZW0uZGF0YS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1cmwgIT09ICcnO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrOiAoZW50aXR5SHRtbDogSlF1ZXJ5PEhUTUxFbGVtZW50PikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBnZXRJdGVtRnJvbUNvbnRleHQoZW50aXR5SHRtbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGRmID0gZ2V0UERGRGF0YUZyb21JdGVtKGl0ZW0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAocGRmID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vVE9ETzogRXJyb3IgaGFuZGxpbmdcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyB1cmwgfSA9IHBkZjtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBldmVudCA9IG5ldyBQcmVsb2FkRXZlbnQobnVsbCwgZ2V0QWJzb2x1dGVVUkwodXJsKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuZW1pdCgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBQREZDYWNoZS5wcmVsb2FkKHVybCk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG9wdGlvbnMudW5zaGlmdCh7XHJcbiAgICAgICAgICAgIG5hbWU6IGdhbWUuaTE4bi5sb2NhbGl6ZSgnUERGT1VORFJZLkNPTlRFWFQuT3BlblBERicpLFxyXG4gICAgICAgICAgICBpY29uOiAnPGkgY2xhc3M9XCJmYXIgZmEtZmlsZS1wZGZcIj48L2k+JyxcclxuICAgICAgICAgICAgY29uZGl0aW9uOiAoZW50aXR5SHRtbDogSlF1ZXJ5PEhUTUxFbGVtZW50PikgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IGdldEl0ZW1Gcm9tQ29udGV4dChlbnRpdHlIdG1sKTtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLnR5cGUgIT09IFNldHRpbmdzLlBERl9FTlRJVFlfVFlQRSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCB7IHVybCB9ID0gaXRlbS5kYXRhLmRhdGE7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdXJsICE9PSAnJztcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY2FsbGJhY2s6IChlbnRpdHlIdG1sOiBKUXVlcnk8SFRNTEVsZW1lbnQ+KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gZ2V0SXRlbUZyb21Db250ZXh0KGVudGl0eUh0bWwpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcGRmID0gZ2V0UERGRGF0YUZyb21JdGVtKGl0ZW0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChwZGYgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL1RPRE86IEVycm9yIGhhbmRsaW5nXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIEFwaS5vcGVuUERGKHBkZiwgMSk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgdXNlckxvZ2luKCkge1xyXG4gICAgICAgIGxldCB2aWV3ZWQ7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgdmlld2VkID0gZ2FtZS51c2VyLmdldEZsYWcoU2V0dGluZ3MuRVhURVJOQUxfU1lTVEVNX05BTUUsIFNldHRpbmdzLlNFVFRJTkdfS0VZLkhFTFBfU0VFTik7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgdmlld2VkID0gZmFsc2U7XHJcbiAgICAgICAgfSBmaW5hbGx5IHtcclxuICAgICAgICAgICAgaWYgKCF2aWV3ZWQpIHtcclxuICAgICAgICAgICAgICAgIEFwaS5zaG93SGVscCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogSG9vayBoYW5kbGVyIGZvciBkZWZhdWx0IGRhdGEgZm9yIGEgUERGXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgYXN5bmMgcHJlQ3JlYXRlSXRlbShlbnRpdHksIC4uLmFyZ3MpIHtcclxuICAgICAgICBpZiAoZW50aXR5LnR5cGUgIT09IFNldHRpbmdzLlBERl9FTlRJVFlfVFlQRSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVudGl0eS5pbWcgPSBgc3lzdGVtcy8ke1NldHRpbmdzLkRJU1RfUEFUSH0vYXNzZXRzL3BkZl9pY29uLnN2Z2A7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBIb29rIGhhbmRsZXIgZm9yIHJlbmRlcmluZyB0aGUgc2V0dGluZ3MgdGFiXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgb25SZW5kZXJTZXR0aW5ncyhzZXR0aW5nczogYW55LCBodG1sOiBKUXVlcnk8SFRNTEVsZW1lbnQ+LCBkYXRhOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBpY29uID0gJzxpIGNsYXNzPVwiZmFyIGZhLWZpbGUtcGRmXCI+PC9pPic7XHJcbiAgICAgICAgY29uc3QgYnV0dG9uID0gJChgPGJ1dHRvbj4ke2ljb259ICR7Z2FtZS5pMThuLmxvY2FsaXplKCdQREZPVU5EUlkuU0VUVElOR1MuT3BlbkhlbHAnKX08L2J1dHRvbj5gKTtcclxuICAgICAgICBidXR0b24ub24oJ2NsaWNrJywgQXBpLnNob3dIZWxwKTtcclxuXHJcbiAgICAgICAgaHRtbC5maW5kKCdoMicpLmxhc3QoKS5iZWZvcmUoYnV0dG9uKTtcclxuICAgIH1cclxufVxyXG5cclxuLy8gPGVkaXRvci1mb2xkIGRlc2M9XCJQZXJzaXN0ZW50IEhvb2tzXCI+XHJcblxyXG4vLyBwcmVDcmVhdGVJdGVtIC0gU2V0dXAgZGVmYXVsdCB2YWx1ZXMgZm9yIGEgbmV3IFBERm91bmRyeV9QREZcclxuSG9va3Mub24oJ3ByZUNyZWF0ZUl0ZW0nLCBTZXR1cC5wcmVDcmVhdGVJdGVtKTtcclxuLy8gZ2V0SXRlbURpcmVjdG9yeUVudHJ5Q29udGV4dCAtIFNldHVwIGNvbnRleHQgbWVudSBmb3IgJ09wZW4gUERGJyBsaW5rc1xyXG5Ib29rcy5vbignZ2V0SXRlbURpcmVjdG9yeUVudHJ5Q29udGV4dCcsIFNldHVwLmdldEl0ZW1Db250ZXh0T3B0aW9ucyk7XHJcbi8vIHJlbmRlclNldHRpbmdzIC0gSW5qZWN0IGEgJ09wZW4gTWFudWFsJyBidXR0b24gaW50byBoZWxwIHNlY3Rpb25cclxuSG9va3Mub24oJ3JlbmRlclNldHRpbmdzJywgU2V0dXAub25SZW5kZXJTZXR0aW5ncyk7XHJcbiIsIi8qIENvcHlyaWdodCAyMDIwIEFuZHJldyBDdWNjaW5lbGxvXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuXHJcbmltcG9ydCB7IFBERkRhdGEgfSBmcm9tICcuL2NvbW1vbi90eXBlcy9QREZEYXRhJztcclxuaW1wb3J0IFNldHRpbmdzIGZyb20gJy4vc2V0dGluZ3MvU2V0dGluZ3MnO1xyXG5cclxuLyoqXHJcbiAqIEhlbHBlciBtZXRob2QuIENvbnZlcnQgYSByZWxhdGl2ZSBVUkwgdG8gYSBhYnNvbHV0ZSBVUkxcclxuICogIGJ5IHByZXBlbmRpbmcgdGhlIHdpbmRvdyBvcmlnaW4gdG8gdGhlIHJlbGF0aXZlIFVSTC5cclxuICogQHBhcmFtIGRhdGFVcmxcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRBYnNvbHV0ZVVSTChkYXRhVXJsOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgLy8gQW1hem9uIFMzIGJ1Y2tldHMgYXJlIGFscmVhZHkgYWJzb2x1dGVcclxuICAgIGlmIChkYXRhVXJsLmluY2x1ZGVzKCdhbWF6b25hd3MuY29tJykpIHtcclxuICAgICAgICByZXR1cm4gZGF0YVVybDtcclxuICAgIH1cclxuICAgIHJldHVybiBgJHt3aW5kb3cub3JpZ2lufS8ke2RhdGFVcmx9YDtcclxufVxyXG5cclxuLyoqXHJcbiAqIFB1bGwgcmVsZXZhbnQgZGF0YSBmcm9tIGFuIGl0ZW0sIGNyZWF0aW5nIGEge0BsaW5rIFBERkRhdGF9LlxyXG4gKiBAcGFyYW0gaXRlbSBUaGUgaXRlbSB0byBwdWxsIGRhdGEgZnJvbS5cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRQREZEYXRhRnJvbUl0ZW0oaXRlbTogSXRlbSk6IFBERkRhdGEgfCBudWxsIHtcclxuICAgIGlmIChpdGVtID09PSB1bmRlZmluZWQgfHwgaXRlbSA9PT0gbnVsbCkge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCB7IGNvZGUsIHVybCwgb2Zmc2V0LCBjYWNoZSB9ID0gaXRlbS5kYXRhLmRhdGE7XHJcbiAgICBsZXQgbmFtZSA9IGl0ZW0ubmFtZTtcclxuXHJcbiAgICBpZiAodHlwZW9mIG9mZnNldCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICBvZmZzZXQgPSBwYXJzZUludChvZmZzZXQpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgbmFtZSxcclxuICAgICAgICBjb2RlLFxyXG4gICAgICAgIHVybCxcclxuICAgICAgICBvZmZzZXQsXHJcbiAgICAgICAgY2FjaGUsXHJcbiAgICB9O1xyXG59XHJcblxyXG4vKipcclxuICogUmV0dXJucyB0cnVlIGlmIHRoZSBVUkwgc3RhcnRzIHdpdGggdGhlIG9yaWdpbi5cclxuICogQHBhcmFtIGRhdGFVcmwgQSB1cmwuXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVBYnNvbHV0ZVVSTChkYXRhVXJsOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIHJldHVybiBkYXRhVXJsLnN0YXJ0c1dpdGgod2luZG93Lm9yaWdpbik7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBSZXR1cm4gYWxsIHVzZXJzIGlkcyBleGNlcHQgdGhlIGFjdGl2ZSB1c2VyXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0VXNlcklkc0V4Y2VwdE1lKCkge1xyXG4gICAgcmV0dXJuIGdhbWUudXNlcnNcclxuICAgICAgICAuZmlsdGVyKCh1c2VyKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB1c2VyLmlkICE9PSBnYW1lLnVzZXJJZDtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5tYXAoKHVzZXIpID0+IHVzZXIuaWQpO1xyXG59XHJcblxyXG4vKipcclxuICogR2V0cyB1c2VycyB3aXRoIGEgcm9sZSBudW1iZXIgYmV0d2VlbiB0aGUgcHJvdmlkZWQgbG93ZXIgaW5jbHVzaXZlIGFuZCB1cHBlciBpbmNsdXNpdmUgYm91bmRzLlxyXG4gKiBAcGFyYW0gbG93ZXJcclxuICogQHBhcmFtIHVwcGVyXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0VXNlcklkc0JldHdlZW5Sb2xlcyhsb3dlcjogbnVtYmVyLCB1cHBlcjogbnVtYmVyKSB7XHJcbiAgICByZXR1cm4gZ2FtZS51c2Vyc1xyXG4gICAgICAgIC5maWx0ZXIoKHVzZXIpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHVzZXIucm9sZSA+PSBsb3dlciAmJiB1c2VyLnJvbGUgPD0gdXBwZXI7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAubWFwKCh1c2VyKSA9PiB1c2VyLmlkKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldHMgdXNlcnMgd2l0aCBhIHJvbGUgbnVtYmVyIGV4YWN0bHkgbWF0Y2hpbmcgdGhlIG9uZSBwcm92aWRlZC5cclxuICogQHBhcmFtIHJvbGVcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRVc2VySWRzT2ZSb2xlKHJvbGU6IG51bWJlcikge1xyXG4gICAgcmV0dXJuIGdhbWUudXNlcnNcclxuICAgICAgICAuZmlsdGVyKCh1c2VyKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB1c2VyLnJvbGUgPT09IHJvbGU7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAubWFwKCh1c2VyKSA9PiB1c2VyLmlkKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldHMgdXNlcnMgd2l0aCBhIHJvbGUgbnVtYmVyIGF0IGxlYXN0IHRoZSBvbmUgcHJvdmlkZWQuXHJcbiAqIEBwYXJhbSByb2xlXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0VXNlcklkc0F0TGVhc3RSb2xlKHJvbGU6IG51bWJlcikge1xyXG4gICAgcmV0dXJuIGdhbWUudXNlcnNcclxuICAgICAgICAuZmlsdGVyKCh1c2VyKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB1c2VyLnJvbGUgPj0gcm9sZTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5tYXAoKHVzZXIpID0+IHVzZXIuaWQpO1xyXG59XHJcblxyXG4vKipcclxuICogR2V0cyB1c2VycyB3aXRoIGEgcm9sZSBudW1iZXIgYXQgbW9zdCB0aGUgb25lIHByb3ZpZGVkLlxyXG4gKiBAcGFyYW0gcm9sZVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFVzZXJJZHNBdE1vc3RSb2xlKHJvbGU6IG51bWJlcikge1xyXG4gICAgcmV0dXJuIGdhbWUudXNlcnNcclxuICAgICAgICAuZmlsdGVyKCh1c2VyKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB1c2VyLnJvbGUgPD0gcm9sZTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5tYXAoKHVzZXIpID0+IHVzZXIuaWQpO1xyXG59XHJcblxyXG4vKipcclxuICogQ2hlY2tzIGlmIGEgcmVtb3RlIGZpbGUgZXhpc3RzIGF0IHRoZSBzcGVjaWZpZWQgcGF0aC4gVGhhdCBpcywgaWYgdGhlIFVSTCBpcyB2YWxpZC4gVGhpcyBkb2VzIG5vdCBndWFyYW50ZWUgYVxyXG4gKiB2YWxpZCBmaWxlIGV4aXN0cyBhdCB0aGF0IGxvY2F0aW9uLiBGb3IgZXhhbXBsZSwgYW4gSFRNTCBmaWxlIHdpbGwgcmVzdWx0IGluIHRydWUgYnV0IG5vdCBiZSBhIHZhbGlkIFBERi5cclxuICogQHBhcmFtIHBhdGhcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBmaWxlRXhpc3RzKHBhdGg6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPGJvb2xlYW4+KChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAkLmFqYXgocGF0aCwge1xyXG4gICAgICAgICAgICB0eXBlOiAnSEVBRCcsXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGVycm9yOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKGZhbHNlKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogUmV0dXJucyB0cnVlIGlmIHRoZSBwcm92aWRlZCBlbnRpdHkgaXMgYSBQREZcclxuICogQHBhcmFtIGVudGl0eVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGlzUERGKGVudGl0eTogRW50aXR5KSB7XHJcbiAgICByZXR1cm4gZW50aXR5LmRhdGEudHlwZSA9PT0gU2V0dGluZ3MuUERGX0VOVElUWV9UWVBFO1xyXG59XHJcbiIsIi8qIENvcHlyaWdodCAyMDIwIEFuZHJldyBDdWNjaW5lbGxvXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuXHJcbmltcG9ydCBTZXR0aW5ncyBmcm9tICcuLi9zZXR0aW5ncy9TZXR0aW5ncyc7XHJcbmltcG9ydCBBcGkgZnJvbSAnLi4vQXBpJztcclxuaW1wb3J0IHsgZ2V0QWJzb2x1dGVVUkwgfSBmcm9tICcuLi9VdGlsJztcclxuXHJcbi8qKlxyXG4gKiBFeHRlbmRzIHRoZSBiYXNlIEl0ZW1TaGVldCBmb3IgbGlua2VkIFBERiB2aWV3aW5nLlxyXG4gKiBAcHJpdmF0ZVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFBERkl0ZW1TaGVldCBleHRlbmRzIEl0ZW1TaGVldCB7XHJcbiAgICBzdGF0aWMgZ2V0IGRlZmF1bHRPcHRpb25zKCkge1xyXG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSBzdXBlci5kZWZhdWx0T3B0aW9ucztcclxuICAgICAgICBvcHRpb25zLmNsYXNzZXMgPSBbJ3NoZWV0JywgJ2l0ZW0nXTtcclxuICAgICAgICBvcHRpb25zLndpZHRoID0gNjUwO1xyXG4gICAgICAgIG9wdGlvbnMuaGVpZ2h0ID0gJ2F1dG8nO1xyXG4gICAgICAgIG9wdGlvbnMudGVtcGxhdGUgPSBgc3lzdGVtcy8ke1NldHRpbmdzLkRJU1RfUEFUSH0vdGVtcGxhdGVzL3NoZWV0L3BkZi1zaGVldC5odG1sYDtcclxuICAgICAgICByZXR1cm4gb3B0aW9ucztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEhlbHBlciBtZXRob2QgdG8gZ2V0IGEgaWQgaW4gdGhlIGh0bWwgZm9ybVxyXG4gICAgICogaHRtbCBpZHMgYXJlIHByZXBlbmRlZCB3aXRoIHRoZSBpZCBvZiB0aGUgaXRlbSB0byBwcmVzZXJ2ZSB1bmlxdWVuZXNzXHJcbiAgICAgKiAgd2hpY2ggaXMgbWFuZGF0b3J5IHRvIGFsbG93IG11bHRpcGxlIGZvcm1zIHRvIGJlIG9wZW5cclxuICAgICAqIEBwYXJhbSBodG1sXHJcbiAgICAgKiBAcGFyYW0gaWRcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBfZ2V0QnlJRChodG1sOiBKUXVlcnk8SFRNTEVsZW1lbnQ+LCBpZDogc3RyaW5nKTogSlF1ZXJ5PEhUTUxFbGVtZW50PiB7XHJcbiAgICAgICAgcmV0dXJuIGh0bWwucGFyZW50KCkucGFyZW50KCkuZmluZChgIyR7dGhpcy5pdGVtLl9pZH0tJHtpZH1gKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgX2dldEhlYWRlckJ1dHRvbnMoKTogYW55W10ge1xyXG4gICAgICAgIGNvbnN0IGJ1dHRvbnMgPSBzdXBlci5fZ2V0SGVhZGVyQnV0dG9ucygpO1xyXG4gICAgICAgIGJ1dHRvbnMudW5zaGlmdCh7XHJcbiAgICAgICAgICAgIGNsYXNzOiAncGRmLXNoZWV0LW1hbnVhbCcsXHJcbiAgICAgICAgICAgIGljb246ICdmYXMgZmEtcXVlc3Rpb24tY2lyY2xlJyxcclxuICAgICAgICAgICAgbGFiZWw6ICdIZWxwJyxcclxuICAgICAgICAgICAgb25jbGljazogKCkgPT4gQXBpLnNob3dIZWxwKCksXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy9UT0RPOiBTdGFuZGFyZGl6ZSB0aGlzIHRvIGZ1bmN0aW9uIHcvIHRoZSBWaWV3ZXIgb25lXHJcbiAgICAgICAgYnV0dG9ucy51bnNoaWZ0KHtcclxuICAgICAgICAgICAgY2xhc3M6ICdwZGYtc2hlZXQtZ2l0aHViJyxcclxuICAgICAgICAgICAgaWNvbjogJ2ZhcyBmYS1leHRlcm5hbC1saW5rLWFsdCcsXHJcbiAgICAgICAgICAgIGxhYmVsOiAnUERGb3VuZHJ5JyxcclxuICAgICAgICAgICAgb25jbGljazogKCkgPT4gd2luZG93Lm9wZW4oJ2h0dHBzOi8vZ2l0aHViLmNvbS9EanBob2VuaXg3MTkvUERGb3VuZHJ5JywgJ19ibGFuaycpLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBidXR0b25zO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBhY3RpdmF0ZUxpc3RlbmVycyhodG1sOiBKUXVlcnk8SFRNTEVsZW1lbnQ+KTogdm9pZCB7XHJcbiAgICAgICAgc3VwZXIuYWN0aXZhdGVMaXN0ZW5lcnMoaHRtbCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHVybElucHV0ID0gdGhpcy5fZ2V0QnlJRChodG1sLCAnZGF0YVxcXFwudXJsJyk7XHJcbiAgICAgICAgY29uc3Qgb2Zmc2V0SW5wdXQgPSB0aGlzLl9nZXRCeUlEKGh0bWwsICdkYXRhXFxcXC5vZmZzZXQnKTtcclxuXHJcbiAgICAgICAgLy8gQmxvY2sgZW50ZXIgZnJvbSBkaXNwbGF5aW5nIHRoZSBQREZcclxuICAgICAgICBodG1sLmZpbmQoJ2lucHV0Jykub24oJ2tleXByZXNzJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChldmVudC5rZXkgPT09ICdFbnRlcicpIHtcclxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gVGVzdCBidXR0b25cclxuICAgICAgICB0aGlzLl9nZXRCeUlEKGh0bWwsICdwZGYtdGVzdCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgbGV0IHVybFZhbHVlID0gdXJsSW5wdXQudmFsKCk7XHJcbiAgICAgICAgICAgIGxldCBvZmZzZXRWYWx1ZSA9IG9mZnNldElucHV0LnZhbCgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHVybFZhbHVlID09PSBudWxsIHx8IHVybFZhbHVlID09PSB1bmRlZmluZWQpIHJldHVybjtcclxuICAgICAgICAgICAgaWYgKG9mZnNldFZhbHVlID09PSBudWxsIHx8IG9mZnNldFZhbHVlID09PSB1bmRlZmluZWQpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIHVybFZhbHVlID0gdXJsVmFsdWUudG9TdHJpbmcoKTtcclxuXHJcbiAgICAgICAgICAgIHVybFZhbHVlID0gZ2V0QWJzb2x1dGVVUkwodXJsVmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgaWYgKG9mZnNldFZhbHVlLnRvU3RyaW5nKCkudHJpbSgpID09PSAnJykge1xyXG4gICAgICAgICAgICAgICAgb2Zmc2V0VmFsdWUgPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9mZnNldFZhbHVlID0gcGFyc2VJbnQob2Zmc2V0VmFsdWUgYXMgc3RyaW5nKTtcclxuXHJcbiAgICAgICAgICAgIEFwaS5vcGVuVVJMKHVybFZhbHVlLCA1ICsgb2Zmc2V0VmFsdWUsIGZhbHNlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gQnJvd3NlIGJ1dHRvblxyXG4gICAgICAgIHRoaXMuX2dldEJ5SUQoaHRtbCwgJ3BkZi1icm93c2UnKS5vbignY2xpY2snLCBhc3luYyBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGZwID0gbmV3IEZpbGVQaWNrZXIoe30pO1xyXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlIFRPRE86IGZvdW5kcnktcGMtdHlwZXNcclxuICAgICAgICAgICAgZnAuZXh0ZW5zaW9ucyA9IFsnLnBkZiddO1xyXG4gICAgICAgICAgICBmcC5maWVsZCA9IHVybElucHV0WzBdO1xyXG5cclxuICAgICAgICAgICAgbGV0IHVybFZhbHVlID0gdXJsSW5wdXQudmFsKCk7XHJcbiAgICAgICAgICAgIGlmICh1cmxWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBmcC5icm93c2UodXJsVmFsdWUudG9TdHJpbmcoKS50cmltKCkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmcC5yZW5kZXIodHJ1ZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuIiwiLyogQ29weXJpZ2h0IDIwMjAgQW5kcmV3IEN1Y2NpbmVsbG9cclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5cclxuaW1wb3J0IFNldHRpbmdzIGZyb20gJy4uL3NldHRpbmdzL1NldHRpbmdzJztcclxuXHJcbi8qKlxyXG4gKiBDYWxsYmFjayB0eXBlIGZvciBwbGF5ZXIgc2VsZWN0aW9uXHJcbiAqIEBwcml2YXRlXHJcbiAqL1xyXG5leHBvcnQgdHlwZSBQREZQbGF5ZXJTZWxlY3RDYWxsYmFjayA9IChpZHM6IFtdKSA9PiB2b2lkO1xyXG5cclxuLyoqXHJcbiAqIEFuIGFwcGxpY2F0aW9uIHRoYXQgYWxsb3dzIHNlbGVjdGlvbiBvZiBwbGF5ZXJzLlxyXG4gKiBAcHJpdmF0ZVxyXG4gKi9cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGxheWVyU2VsZWN0IGV4dGVuZHMgQXBwbGljYXRpb24ge1xyXG4gICAgc3RhdGljIGdldCBkZWZhdWx0T3B0aW9ucygpIHtcclxuICAgICAgICBjb25zdCBvcHRpb25zID0gc3VwZXIuZGVmYXVsdE9wdGlvbnM7XHJcbiAgICAgICAgb3B0aW9ucy5jbGFzc2VzID0gWydzaGVldCcsICdpdGVtJ107XHJcbiAgICAgICAgb3B0aW9ucy50ZW1wbGF0ZSA9IGBzeXN0ZW1zLyR7U2V0dGluZ3MuRElTVF9QQVRIfS90ZW1wbGF0ZXMvYXBwL3BkZi1wbGF5ZXItc2VsZWN0Lmh0bWxgO1xyXG4gICAgICAgIG9wdGlvbnMud2lkdGggPSAnYXV0byc7XHJcbiAgICAgICAgb3B0aW9ucy5oZWlnaHQgPSAnYXV0byc7XHJcbiAgICAgICAgb3B0aW9ucy50aXRsZSA9IGdhbWUuaTE4bi5sb2NhbGl6ZSgnUERGT1VORFJZLlZJRVdFUi5TZWxlY3RQbGF5ZXJzJyk7XHJcbiAgICAgICAgcmV0dXJuIG9wdGlvbnM7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBfaWRzO1xyXG4gICAgcHJpdmF0ZSByZWFkb25seSBfY2FsbGJhY2s7XHJcblxyXG4gICAgY29uc3RydWN0b3IoaWRzOiBzdHJpbmdbXSwgY2I6IFBERlBsYXllclNlbGVjdENhbGxiYWNrLCBvcHRpb25zPzogQXBwbGljYXRpb25PcHRpb25zKSB7XHJcbiAgICAgICAgc3VwZXIob3B0aW9ucyk7XHJcblxyXG4gICAgICAgIHRoaXMuX2lkcyA9IGlkcztcclxuICAgICAgICB0aGlzLl9jYWxsYmFjayA9IGNiO1xyXG4gICAgfVxyXG5cclxuICAgIGdldERhdGEob3B0aW9ucz86IGFueSk6IGFueSB8IFByb21pc2U8YW55PiB7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IHN1cGVyLmdldERhdGEob3B0aW9ucyk7XHJcblxyXG4gICAgICAgIGNvbnN0IHVzZXJzOiBhbnlbXSA9IFtdO1xyXG4gICAgICAgIGZvciAoY29uc3QgaWQgb2YgdGhpcy5faWRzKSB7XHJcbiAgICAgICAgICAgIHVzZXJzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgbmFtZTogZ2FtZS51c2Vycy5nZXQoaWQpLm5hbWUsXHJcbiAgICAgICAgICAgICAgICBpZCxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB1c2Vycy5zb3J0KChhLCBiKSA9PiBhLm5hbWUubG9jYWxlQ29tcGFyZShiLm5hbWUpKTtcclxuXHJcbiAgICAgICAgZGF0YVsndXNlcnMnXSA9IHVzZXJzO1xyXG4gICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBhY3RpdmF0ZUxpc3RlbmVycyhodG1sOiBKUXVlcnk8SFRNTEVsZW1lbnQ+IHwgSFRNTEVsZW1lbnQpOiB2b2lkIHtcclxuICAgICAgICBzdXBlci5hY3RpdmF0ZUxpc3RlbmVycyhodG1sKTtcclxuXHJcbiAgICAgICAgY29uc3QgYnV0dG9uID0gJChodG1sKS5maW5kKCcjY29uZmlybScpO1xyXG4gICAgICAgIGJ1dHRvbi5vbignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NhbGxiYWNrKHRoaXMuY29sbGVjdElkcygpKTtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ29sbGVjdCBzZWxlY3RlZCBpZHMgZnJvbSB0aGUgaHRtbFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIGNvbGxlY3RJZHMoKTogc3RyaW5nW10ge1xyXG4gICAgICAgIGNvbnN0IGlkczogc3RyaW5nW10gPSBbXTtcclxuICAgICAgICBjb25zdCBjaGVja2JveGVzID0gJCh0aGlzLmVsZW1lbnQpLmZpbmQoJ2lucHV0W3R5cGU9Y2hlY2tib3hdJyk7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaGVja2JveGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNoZWNrYm94ID0gJChjaGVja2JveGVzW2ldKTtcclxuICAgICAgICAgICAgaWYgKGNoZWNrYm94LnByb3AoJ2NoZWNrZWQnKSkge1xyXG4gICAgICAgICAgICAgICAgaWRzLnB1c2goY2hlY2tib3gucHJvcCgnaWQnKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGlkcztcclxuICAgIH1cclxufVxyXG4iLCIvKiBDb3B5cmlnaHQgMjAyMCBBbmRyZXcgQ3VjY2luZWxsb1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcblxyXG4vKipcclxuICogQW4gZXJyb3IgdGhhdCBvY2N1cnMgZHVyaW5nIGNhY2hlIG9wZXJhdGlvbnNcclxuICogQHByaXZhdGVcclxuICovXHJcbmV4cG9ydCBjbGFzcyBDYWNoZUVycm9yIGV4dGVuZHMgRXJyb3Ige1xyXG4gICAgY29uc3RydWN0b3IoaW5kZXg6IHN0cmluZywgc3RvcmU6IHN0cmluZywgbWVzc2FnZT86IHN0cmluZykge1xyXG4gICAgICAgIHN1cGVyKGBFcnJvciBpbiAke2luZGV4fT4ke3N0b3JlfTogJHttZXNzYWdlfWApO1xyXG4gICAgfVxyXG59XHJcbiIsIi8qIENvcHlyaWdodCAyMDIwIEFuZHJldyBDdWNjaW5lbGxvXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuXHJcbmltcG9ydCB7IENhY2hlRXJyb3IgfSBmcm9tICcuL0NhY2hlRXJyb3InO1xyXG5cclxuLyoqXHJcbiAqIENsYXNzIHRoYXQgZGVhbHMgd2l0aCBnZXR0aW5nL3NldHRpbmcgZnJvbSBhbiBpbmRleGVkIGRiXHJcbiAqIE1vc3RseSBleGlzdHMgdG8gc2VwYXJhdGUgbG9naWMgZm9yIHRoZSBQREZDYWNoZSBmcm9tIGxvZ2ljXHJcbiAqIGRlYWxpbmcgd2l0aCB0aGUgZGF0YWJhc2VcclxuICogQHByaXZhdGVcclxuICovXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENhY2hlSGVscGVyIHtcclxuICAgIHByaXZhdGUgX3ZlcnNpb246IG51bWJlcjtcclxuXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9pbmRleE5hbWU6IHN0cmluZztcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgX3N0b3JlTmFtZXM6IHN0cmluZ1tdO1xyXG5cclxuICAgIHByaXZhdGUgX2RiOiBJREJEYXRhYmFzZTtcclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGFzeW5jIGNyZWF0ZUFuZE9wZW4oaW5kZXhOYW1lOiBzdHJpbmcsIHN0b3JlTmFtZXM6IHN0cmluZ1tdLCB2ZXJzaW9uOiBudW1iZXIpIHtcclxuICAgICAgICBjb25zdCBoZWxwZXIgPSBuZXcgQ2FjaGVIZWxwZXIoaW5kZXhOYW1lLCBzdG9yZU5hbWVzLCB2ZXJzaW9uKTtcclxuICAgICAgICBhd2FpdCBoZWxwZXIub3BlbigpO1xyXG4gICAgICAgIHJldHVybiBoZWxwZXI7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldCByZWFkeSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZGIgIT09IHVuZGVmaW5lZDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY29uc3RydWN0b3IoaW5kZXhOYW1lOiBzdHJpbmcsIHN0b3JlTmFtZXM6IHN0cmluZ1tdLCB2ZXJzaW9uOiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLl9pbmRleE5hbWUgPSBgJHtpbmRleE5hbWV9YDtcclxuICAgICAgICB0aGlzLl9zdG9yZU5hbWVzID0gc3RvcmVOYW1lcztcclxuICAgICAgICB0aGlzLl92ZXJzaW9uID0gdmVyc2lvbjtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG5ld1RyYW5zYWN0aW9uKHN0b3JlTmFtZTogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSB0aGlzLl9kYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsICdyZWFkd3JpdGUnKTtcclxuICAgICAgICBjb25zdCBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcbiAgICAgICAgcmV0dXJuIHsgdHJhbnNhY3Rpb24sIHN0b3JlIH07XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG9wZW4oKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICAgICAgY29uc3QgdGhhdCA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPHZvaWQ+KGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgY29uc3QgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKHRoYXQuX2luZGV4TmFtZSwgdGhhdC5fdmVyc2lvbik7XHJcbiAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICB0aGF0Ll9kYiA9IHRoaXMucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgdGhhdC5fZGIgPSB0aGlzLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhhdC5fc3RvcmVOYW1lcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBvYmplY3Qgc3RvcmUgaWYgaXQgZG9lc24ndCBleGlzdFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGF0Ll9kYi5jcmVhdGVPYmplY3RTdG9yZSh0aGF0Ll9zdG9yZU5hbWVzW2ldLCB7fSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlIHBhc3NcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGV2ZW50LnRhcmdldC5lcnJvcik7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldChrZXk6IElEQlZhbGlkS2V5LCB2YWx1ZTogYW55LCBzdG9yZU5hbWU6IHN0cmluZywgZm9yY2U6IGJvb2xlYW4gPSBmYWxzZSk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5fZGIpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBDYWNoZUVycm9yKHRoaXMuX2luZGV4TmFtZSwgc3RvcmVOYW1lLCAnRGF0YWJhc2UgaXMgbm90IGluaXRpYWxpemVkLicpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGhhdCA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICBsZXQgeyB0cmFuc2FjdGlvbiwgc3RvcmUgfSA9IHRoaXMubmV3VHJhbnNhY3Rpb24oc3RvcmVOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBQcm9wYWdhdGUgZXJyb3JzIHVwd2FyZHMsIG90aGVyd2lzZSB0aGV5IGZhaWwgc2lsZW50bHlcclxuICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uLm9uZXJyb3IgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGV2ZW50LnRhcmdldC5lcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGtleVJlcXVlc3QgPSBzdG9yZS5nZXRLZXkoa2V5KTtcclxuICAgICAgICAgICAgICAgIGtleVJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8ga2V5IGFscmVhZHkgZXhpc3RzIGluIHRoZSBzdG9yZVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXlSZXF1ZXN0LnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzaG91bGQgd2UgZm9yY2UgdGhlIG5ldyB2YWx1ZSBieSBkZWxldGluZyB0aGUgb2xkP1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZm9yY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuZGVsKGtleSwgc3RvcmVOYW1lKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoeyB0cmFuc2FjdGlvbiwgc3RvcmUgfSA9IHRoYXQubmV3VHJhbnNhY3Rpb24oc3RvcmVOYW1lKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmUuYWRkKHZhbHVlLCBrZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IENhY2hlRXJyb3IodGhhdC5faW5kZXhOYW1lLCBzdG9yZU5hbWUsIGBLZXkgJHtrZXl9IGFscmVhZHkgZXhpc3RzLmApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmUuYWRkKHZhbHVlLCBrZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXQoa2V5OiBJREJWYWxpZEtleSwgc3RvcmVOYW1lOiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5fZGIpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBDYWNoZUVycm9yKHRoaXMuX2luZGV4TmFtZSwgc3RvcmVOYW1lLCAnRGF0YWJhc2UgaXMgbm90IGluaXRpYWxpemVkLicpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbGV0IHsgdHJhbnNhY3Rpb24sIHN0b3JlIH0gPSB0aGlzLm5ld1RyYW5zYWN0aW9uKHN0b3JlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gUHJvcGFnYXRlIGVycm9ycyB1cHdhcmRzLCBvdGhlcndpc2UgdGhleSBmYWlsIHNpbGVudGx5XHJcbiAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChldmVudC50YXJnZXQuZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBnZXRSZXF1ZXN0ID0gc3RvcmUuZ2V0KGtleSk7XHJcbiAgICAgICAgICAgICAgICBnZXRSZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUodGhpcy5yZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBnZXRSZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGV2ZW50LnRhcmdldC5lcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGRlbChrZXk6IElEQlZhbGlkS2V5LCBzdG9yZU5hbWU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7IHRyYW5zYWN0aW9uLCBzdG9yZSB9ID0gdGhpcy5uZXdUcmFuc2FjdGlvbihzdG9yZU5hbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uLm9uZXJyb3IgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGV2ZW50LnRhcmdldC5lcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgc3RvcmUuZGVsZXRlKGtleSk7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGtleXMoc3RvcmVOYW1lOiBzdHJpbmcpOiBQcm9taXNlPElEQlZhbGlkS2V5W10+IHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8SURCVmFsaWRLZXlbXT4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgeyB0cmFuc2FjdGlvbiwgc3RvcmUgfSA9IHRoaXMubmV3VHJhbnNhY3Rpb24oc3RvcmVOYW1lKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGtleXNSZXF1ZXN0ID0gc3RvcmUuZ2V0QWxsS2V5cygpO1xyXG5cclxuICAgICAgICAgICAgICAgIGtleXNSZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGtleXNSZXF1ZXN0LnJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAga2V5c1JlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXZlbnQudGFyZ2V0LmVycm9yKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjbHIoc3RvcmVOYW1lOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgeyBzdG9yZSB9ID0gdGhpcy5uZXdUcmFuc2FjdGlvbihzdG9yZU5hbWUpO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qga2V5cyA9IHN0b3JlLmdldEFsbEtleXMoKTtcclxuICAgICAgICAgICAgICAgIGtleXMub25zdWNjZXNzID0gKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb21pc2VzOiBQcm9taXNlPHZvaWQ+W10gPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKHRoaXMuZGVsKGtleSwgc3RvcmVOYW1lKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIFByb21pc2UuYWxsKHByb21pc2VzKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG4iLCIvKiBDb3B5cmlnaHQgMjAyMCBBbmRyZXcgQ3VjY2luZWxsb1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcblxyXG5pbXBvcnQgU2V0dGluZ3MgZnJvbSAnLi4vc2V0dGluZ3MvU2V0dGluZ3MnO1xyXG5pbXBvcnQgQ2FjaGVIZWxwZXIgZnJvbSAnLi9DYWNoZUhlbHBlcic7XHJcblxyXG4vKipcclxuICogTWV0YSBpbmZvcm1hdGlvbiBhYm91dCBhIGNhY2hlIGVudHJ5XHJcbiAqIEBwcml2YXRlXHJcbiAqL1xyXG50eXBlIENhY2hlRGF0YSA9IHtcclxuICAgIC8qKlxyXG4gICAgICogVGhlIHNpemUgaW4gYnl0ZXMgdGhpcyBjYWNoZSBlbnRyeSB0YWtlcyB1cC5cclxuICAgICAqL1xyXG4gICAgc2l6ZTogbnVtYmVyO1xyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgZGF0ZSB0aGUgY2FjaGUgd2FzIGxhc3QgYWNjZXNzZWQsIHJlcHJlc2VudGVkIGJ5IGEgSVNPIHN0cmluZy5cclxuICAgICAqL1xyXG4gICAgZGF0ZUFjY2Vzc2VkOiBzdHJpbmc7XHJcbn07XHJcblxyXG4vKipcclxuICogSGFuZGxlcyBjYWNoaW5nIGZvciBQREZzXHJcbiAqIEBwcml2YXRlXHJcbiAqL1xyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQREZDYWNoZSB7XHJcbiAgICAvLyA8ZWRpdG9yLWZvbGQgZGVzYz1cIlN0YXRpYyBQcm9wZXJ0aWVzXCI+XHJcbiAgICAvKipcclxuICAgICAqIE1heCBzaXplIG9mIHRoZSBjYWNoZSBmb3IgdGhlIGFjdGl2ZSB1c2VyLCBkZWZhdWx0cyB0byAyNTYgTUIuXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgZ2V0IE1BWF9CWVRFUygpIHtcclxuICAgICAgICByZXR1cm4gZ2FtZS5zZXR0aW5ncy5nZXQoU2V0dGluZ3MuRVhURVJOQUxfU1lTVEVNX05BTUUsICdDYWNoZVNpemUnKSAqIDIgKiogMjA7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgSURCX05BTUU6IHN0cmluZyA9ICdQREZvdW5kcnknO1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgSURCX1ZFUlNJT046IG51bWJlciA9IDE7XHJcblxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgQ0FDSEU6IHN0cmluZyA9IGBDYWNoZWA7XHJcbiAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBNRVRBOiBzdHJpbmcgPSBgTWV0YWA7XHJcblxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgX2NhY2hlSGVscGVyOiBDYWNoZUhlbHBlcjtcclxuICAgIC8vIDwvZWRpdG9yLWZvbGQ+XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBhc3luYyBpbml0aWFsaXplKCkge1xyXG4gICAgICAgIFBERkNhY2hlLl9jYWNoZUhlbHBlciA9IGF3YWl0IENhY2hlSGVscGVyLmNyZWF0ZUFuZE9wZW4oUERGQ2FjaGUuSURCX05BTUUsIFtQREZDYWNoZS5DQUNIRSwgUERGQ2FjaGUuTUVUQV0sIFBERkNhY2hlLklEQl9WRVJTSU9OKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEdldCBtZXRhIGluZm9ybWF0aW9uIGFib3V0IGEgcHJvdmlkZWQga2V5ICh1cmwpLlxyXG4gICAgICogQHBhcmFtIGtleVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGFzeW5jIGdldE1ldGEoa2V5OiBzdHJpbmcpOiBQcm9taXNlPENhY2hlRGF0YSB8IG51bGw+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgUERGQ2FjaGUuX2NhY2hlSGVscGVyLmdldChrZXksIFBERkNhY2hlLk1FVEEpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFNldCBtZXRhIGluZm9ybWF0aW9uIGFib3V0IGEgcHJvdmlkZWQga2V5ICh1cmwpLiBTZWUge0BsaW5rIENhY2hlRGF0YX0uXHJcbiAgICAgKiBAcGFyYW0ga2V5XHJcbiAgICAgKiBAcGFyYW0gbWV0YVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGFzeW5jIHNldE1ldGEoa2V5OiBzdHJpbmcsIG1ldGE6IENhY2hlRGF0YSk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgICAgIGF3YWl0IFBERkNhY2hlLl9jYWNoZUhlbHBlci5zZXQoa2V5LCBtZXRhLCBQREZDYWNoZS5NRVRBLCB0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEdldCB0aGUgYnl0ZSBhcnJheSByZXByZXNlbnRpbmcgdGhlIGtleSAodXJsKSBmcm9tIHRoZSB1c2VyJ3MgY2FjaGUuXHJcbiAgICAgKiBAcGFyYW0ga2V5XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgYXN5bmMgZ2V0Q2FjaGUoa2V5OiBzdHJpbmcpOiBQcm9taXNlPFVpbnQ4QXJyYXkgfCBudWxsPiB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgYnl0ZXMgPSBhd2FpdCBQREZDYWNoZS5fY2FjaGVIZWxwZXIuZ2V0KGtleSwgUERGQ2FjaGUuQ0FDSEUpO1xyXG4gICAgICAgICAgICBjb25zdCBtZXRhOiBDYWNoZURhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICBkYXRlQWNjZXNzZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgICAgICAgIHNpemU6IGJ5dGVzLmxlbmd0aCxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgYXdhaXQgUERGQ2FjaGUuc2V0TWV0YShrZXksIG1ldGEpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGJ5dGVzO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFNldCB0aGUgdmFsdWUgb2YgdGhlIGNhY2hlIGZvciB0aGUgc3BlY2lmaWMga2V5ICh1cmwpIHRvIHRoZSBwcm92aWRlZCBieXRlIGFycmF5LlxyXG4gICAgICogQHBhcmFtIGtleVxyXG4gICAgICogQHBhcmFtIGJ5dGVzXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgYXN5bmMgc2V0Q2FjaGUoa2V5OiBzdHJpbmcsIGJ5dGVzOiBVaW50OEFycmF5KSB7XHJcbiAgICAgICAgY29uc3QgbWV0YTogQ2FjaGVEYXRhID0ge1xyXG4gICAgICAgICAgICBkYXRlQWNjZXNzZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgICAgc2l6ZTogYnl0ZXMubGVuZ3RoLFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGF3YWl0IFBERkNhY2hlLl9jYWNoZUhlbHBlci5zZXQoa2V5LCBieXRlcywgUERGQ2FjaGUuQ0FDSEUsIHRydWUpO1xyXG4gICAgICAgIGF3YWl0IFBERkNhY2hlLnNldE1ldGEoa2V5LCBtZXRhKTtcclxuICAgICAgICBhd2FpdCB0aGlzLnBydW5lKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBQcmVsb2FkIHRoZSBQREYgYXQgdGhlIHNwZWNpZmllZCBrZXkgKHVybCksIGNhY2hpbmcgaXQgaW1tZWRpYXRlbHkuXHJcbiAgICAgKiBAcGFyYW0ga2V5XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgcHJlbG9hZChrZXk6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPihhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhY2hlZEJ5dGVzID0gYXdhaXQgUERGQ2FjaGUuZ2V0Q2FjaGUoa2V5KTtcclxuICAgICAgICAgICAgaWYgKGNhY2hlZEJ5dGVzICE9PSBudWxsICYmIGNhY2hlZEJ5dGVzLmJ5dGVMZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goa2V5KTtcclxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBmZXRjaGVkQnl0ZXMgPSBuZXcgVWludDhBcnJheShhd2FpdCByZXNwb25zZS5hcnJheUJ1ZmZlcigpKTtcclxuICAgICAgICAgICAgICAgIGlmIChmZXRjaGVkQnl0ZXMuYnl0ZUxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBQREZDYWNoZS5zZXRDYWNoZShrZXksIGZldGNoZWRCeXRlcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KCdGZXRjaCBmYWlsZWQuJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoJ0ZldGNoIGZhaWxlZC4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUHJ1bmUgdGhlIGFjdGl2ZSB1c2VyJ3MgY2FjaGUgdW50aWwgaXQgaXMgYmVsb3cgdGhlIHVzZXIncyBjYWNoZSBzaXplIGxpbWl0LlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGFzeW5jIHBydW5lKCkge1xyXG4gICAgICAgIGNvbnN0IGtleXMgPSBhd2FpdCB0aGlzLl9jYWNoZUhlbHBlci5rZXlzKFBERkNhY2hlLk1FVEEpO1xyXG5cclxuICAgICAgICBsZXQgdG90YWxCeXRlcyA9IDA7XHJcbiAgICAgICAgbGV0IG1ldGFzOiBhbnlbXSA9IFtdO1xyXG4gICAgICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXMpIHtcclxuICAgICAgICAgICAgY29uc3QgbWV0YSA9IGF3YWl0IHRoaXMuX2NhY2hlSGVscGVyLmdldChrZXksIFBERkNhY2hlLk1FVEEpO1xyXG4gICAgICAgICAgICBtZXRhLmRhdGVBY2Nlc3NlZCA9IERhdGUucGFyc2UobWV0YS5kYXRlQWNjZXNzZWQpO1xyXG4gICAgICAgICAgICBtZXRhLnNpemUgPSBwYXJzZUludChtZXRhLnNpemUpO1xyXG5cclxuICAgICAgICAgICAgdG90YWxCeXRlcyArPSBtZXRhLnNpemU7XHJcblxyXG4gICAgICAgICAgICBtZXRhcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgIGtleSxcclxuICAgICAgICAgICAgICAgIG1ldGEsXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbWV0YXMgPSBtZXRhcy5zb3J0KChhLCBiKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBhLm1ldGEuZGF0ZUFjY2Vzc2VkIC0gYi5tZXRhLmRhdGVBY2Nlc3NlZDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtZXRhcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAodG90YWxCeXRlcyA8IFBERkNhY2hlLk1BWF9CWVRFUykge1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG5leHQgPSBtZXRhc1tpXTtcclxuXHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuX2NhY2hlSGVscGVyLmRlbChuZXh0LmtleSwgUERGQ2FjaGUuTUVUQSk7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuX2NhY2hlSGVscGVyLmRlbChuZXh0LmtleSwgUERGQ2FjaGUuQ0FDSEUpO1xyXG5cclxuICAgICAgICAgICAgdG90YWxCeXRlcyAtPSBuZXh0Lm1ldGEuc2l6ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwiLyogQ29weXJpZ2h0IDIwMjAgQW5kcmV3IEN1Y2NpbmVsbG9cclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5cclxuaW1wb3J0IEFwaSBmcm9tICcuLi8uLi9BcGknO1xyXG5cclxuLyoqXHJcbiAqIEBwcml2YXRlXHJcbiAqL1xyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBFdmVudFN0b3JlPFRLZXlzIGV4dGVuZHMgc3RyaW5nID0gc3RyaW5nPiB7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9tYXA6IE1hcDxzdHJpbmcsIEZ1bmN0aW9uW10+O1xyXG5cclxuICAgIHB1YmxpYyBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLl9tYXAgPSBuZXcgTWFwPHN0cmluZywgRnVuY3Rpb25bXT4oKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFR1cm4gb24gYW4gZXZlbnQgY2FsbGJhY2sgZm9yIHRoZSBzcGVjaWZpZWQgZXZlbnQuXHJcbiAgICAgKiBAcGFyYW0gZXZlbnROYW1lXHJcbiAgICAgKiBAcGFyYW0gY2FsbGJhY2tcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uKGV2ZW50TmFtZTogVEtleXMsIGNhbGxiYWNrOiBGdW5jdGlvbikge1xyXG4gICAgICAgIGlmICghdGhpcy5fbWFwLmhhcyhldmVudE5hbWUpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX21hcC5zZXQoZXZlbnROYW1lLCBbXSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBjYWxsYmFja3MgPSB0aGlzLl9tYXAuZ2V0KGV2ZW50TmFtZSkgYXMgRnVuY3Rpb25bXTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNhbGxiYWNrcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAoY2FsbGJhY2tzW2ldID09PSBjYWxsYmFjaykgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYWxsYmFja3MucHVzaChjYWxsYmFjayk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBMaWtlIHtAc2VlIG9ufSBidXQgb25seSBmaXJlcyBvbmNlLlxyXG4gICAgICogQHBhcmFtIGV2ZW50TmFtZVxyXG4gICAgICogQHBhcmFtIGNhbGxiYWNrXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvbmNlKGV2ZW50TmFtZTogVEtleXMsIGNhbGxiYWNrOiBGdW5jdGlvbikge1xyXG4gICAgICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xyXG4gICAgICAgIGNvbnN0IHdyYXBwZXIgPSBmdW5jdGlvbiAoLi4uYXJncykge1xyXG4gICAgICAgICAgICBjYWxsYmFjayhhcmdzKTtcclxuICAgICAgICAgICAgdGhhdC5vZmYoZXZlbnROYW1lLCB3cmFwcGVyKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoYXQub24oZXZlbnROYW1lLCB3cmFwcGVyKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFR1cm4gb2ZmIGFuIGV2ZW50IGNhbGxiYWNrIGZvciB0aGUgc3BlY2lmaWVkIGV2ZW50LlxyXG4gICAgICogQHBhcmFtIGV2ZW50TmFtZVxyXG4gICAgICogQHBhcmFtIGNhbGxiYWNrXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvZmYoZXZlbnROYW1lOiBUS2V5cywgY2FsbGJhY2s6IEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9tYXAuaGFzKGV2ZW50TmFtZSkpIHtcclxuICAgICAgICAgICAgdGhpcy5fbWFwLnNldChldmVudE5hbWUsIFtdKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNhbGxiYWNrcyA9IHRoaXMuX21hcC5nZXQoZXZlbnROYW1lKSBhcyBGdW5jdGlvbltdO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2FsbGJhY2tzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChjYWxsYmFja3NbaV0gPT09IGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFja3Muc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogRmlyZSBhbiBldmVudCBhbmQgZm9yd2FyZCB0aGUgYXJncyB0byBhbGwgaGFuZGxlcnNcclxuICAgICAqIEBwYXJhbSBldmVudE5hbWVcclxuICAgICAqIEBwYXJhbSBhcmdzXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBmaXJlKGV2ZW50TmFtZTogVEtleXMsIC4uLmFyZ3MpIHtcclxuICAgICAgICBpZiAoQXBpLkRFQlVHLkVWRU5UUykge1xyXG4gICAgICAgICAgICBjb25zb2xlLmRlYnVnKGBQREZvdW5kcnk6OiR7ZXZlbnROYW1lfWApO1xyXG4gICAgICAgICAgICBjb25zb2xlLmRlYnVnKGFyZ3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLl9tYXAuaGFzKGV2ZW50TmFtZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgY2FsbGJhY2tzID0gdGhpcy5fbWFwLmdldChldmVudE5hbWUpIGFzIEZ1bmN0aW9uW107XHJcbiAgICAgICAgZm9yIChjb25zdCBjYWxsYmFjayBvZiBjYWxsYmFja3MpIHtcclxuICAgICAgICAgICAgY2FsbGJhY2soLi4uYXJncyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsImltcG9ydCB7IFBERkl0ZW1TaGVldCB9IGZyb20gJy4uL2FwcC9QREZJdGVtU2hlZXQnO1xyXG5pbXBvcnQgU2V0dGluZ3MgZnJvbSAnLi4vc2V0dGluZ3MvU2V0dGluZ3MnO1xyXG5pbXBvcnQgQXBpIGZyb20gJy4uL0FwaSc7XHJcblxyXG4vKipcclxuICogQHByaXZhdGVcclxuICogRW5yaWNoZXMgVGlueU1DRSBlZGl0b3IgY29udGVudFxyXG4gKi9cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSFRNTEVucmljaGVyIHtcclxuICAgIHB1YmxpYyBzdGF0aWMgSGFuZGxlRW5yaWNoKGFwcDogQXBwbGljYXRpb24sIGh0bWw6IEpRdWVyeSwgZGF0YTogYW55KSB7XHJcbiAgICAgICAgaWYgKGFwcCBpbnN0YW5jZW9mIFBERkl0ZW1TaGVldCkgcmV0dXJuO1xyXG5cclxuICAgICAgICBIVE1MRW5yaWNoZXIuRW5yaWNoSFRNTChodG1sKTtcclxuICAgICAgICBIVE1MRW5yaWNoZXIuQmluZENsaWNrcyhodG1sKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHN0YXRpYyBFbnJpY2hIVE1MKGh0bWw6IEpRdWVyeSkge1xyXG4gICAgICAgIC8vIEVucmljaCBIVE1MXHJcbiAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGh0bWwuZmluZCgnZGl2LmVkaXRvci1jb250ZW50ID4gKicpKSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAvLyBXZSByZXBsYWNlIG9uZSBhdCBhIHRpbWUgdW50aWwgZG9uZVxyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGVsZW1lbnQuaW5uZXJUZXh0LmluY2x1ZGVzKCdAUERGJykpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmlubmVySFRNTCA9IG5ldyBIVE1MRW5yaWNoZXIoJChlbGVtZW50KSwgZWxlbWVudC5pbm5lckhUTUwpLmVucmljaCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgLy8gRXJyb3JzIGdldCBwcm9wYWdhdGVkIGZyb20gaW5zdGFuY2UgZm9yIHByb3BlciBlcnJvciBtb2RlbGluZ1xyXG4gICAgICAgICAgICAgICAgaWYgKFNldHRpbmdzLk5PVElGSUNBVElPTlMpIHtcclxuICAgICAgICAgICAgICAgICAgICB1aS5ub3RpZmljYXRpb25zLmVycm9yKGVycm9yLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHN0YXRpYyBCaW5kQ2xpY2tzKGh0bWw6IEpRdWVyeSkge1xyXG4gICAgICAgIGh0bWwuZmluZCgnYS5wZGZvdW5kcnktbGluaycpLm9uKCdjbGljaycsIChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgLy8gVGhpcyB3aWxsIGFsd2F5cyBiZSBhbiBhbmNob3JcclxuICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gJChldmVudC5jdXJyZW50VGFyZ2V0IGFzIEhUTUxBbmNob3JFbGVtZW50KTtcclxuICAgICAgICAgICAgY29uc3QgcmVmID0gdGFyZ2V0LmRhdGEoJ3JlZicpO1xyXG4gICAgICAgICAgICBjb25zdCBwYWdlID0gdGFyZ2V0LmRhdGEoJ3BhZ2UnKTtcclxuXHJcbiAgICAgICAgICAgIC8vIHJlZiBjYW4gbWF0Y2ggbmFtZSBvciBjb2RlXHJcbiAgICAgICAgICAgIGxldCBwZGZEYXRhID0gQXBpLmdldFBERkRhdGEoKGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLm5hbWUgPT09IHJlZiB8fCBpdGVtLmRhdGEuZGF0YS5jb2RlID09PSByZWY7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFwZGZEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB1aS5ub3RpZmljYXRpb25zLmVycm9yKGBVbmFibGUgdG8gZmluZCBhIFBERiB3aXRoIGEgbmFtZSBvciBjb2RlIG1hdGNoaW5nICR7cmVmfS5gKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBBcGkub3BlblBERihwZGZEYXRhLCBwYWdlKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9zUG9zOiBudW1iZXI7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9lUG9zOiBudW1iZXI7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IF90ZXh0OiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9lbGVtZW50OiBKUXVlcnk7XHJcblxyXG4gICAgY29uc3RydWN0b3IocDogSlF1ZXJ5LCB0ZXh0OiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLl9lbGVtZW50ID0gcDtcclxuICAgICAgICB0aGlzLl90ZXh0ID0gdGV4dDtcclxuXHJcbiAgICAgICAgdGhpcy5fc1BvcyA9IHRoaXMuX3RleHQuaW5kZXhPZignQCcpO1xyXG4gICAgICAgIHRoaXMuX2VQb3MgPSB0aGlzLl90ZXh0LmluZGV4T2YoJ30nLCB0aGlzLl9zUG9zICsgMSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGVucmljaCgpOiBzdHJpbmcge1xyXG4gICAgICAgIGNvbnN0IGVucmljaE1lID0gdGhpcy5fdGV4dC5zbGljZSh0aGlzLl9zUG9zLCB0aGlzLl9lUG9zICsgMSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGxCcmFja2V0ID0gZW5yaWNoTWUuaW5kZXhPZignWycpO1xyXG4gICAgICAgIGNvbnN0IHJCcmFja2V0ID0gZW5yaWNoTWUuaW5kZXhPZignXScpO1xyXG4gICAgICAgIGNvbnN0IGxDdXJseSA9IGVucmljaE1lLmluZGV4T2YoJ3snKTtcclxuICAgICAgICBjb25zdCByQ3VybHkgPSBlbnJpY2hNZS5pbmRleE9mKCd9Jyk7XHJcblxyXG4gICAgICAgIC8vIFJlcXVpcmVkIGNoYXJhY3RlciBpcyBtaXNzaW5nXHJcbiAgICAgICAgaWYgKGxCcmFja2V0ID09PSAtMSB8fCByQnJhY2tldCA9PT0gLTEgfHwgbEN1cmx5ID09PSAtMSB8fCByQ3VybHkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihnYW1lLmkxOG4ubG9jYWxpemUoJ1BERk9VTkRSWS5FTlJJQ0guSW52YWxpZEZvcm1hdCcpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gT3JkZXIgaXMgbm90IGNvcnJlY3RcclxuICAgICAgICBpZiAockN1cmx5IDwgbEN1cmx5IHx8IGxDdXJseSA8IHJCcmFja2V0IHx8IHJCcmFja2V0IDwgbEJyYWNrZXQpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGdhbWUuaTE4bi5sb2NhbGl6ZSgnUERGT1VORFJZLkVOUklDSC5JbnZhbGlkRm9ybWF0JykpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IGVucmljaE1lLnNsaWNlKGxCcmFja2V0ICsgMSwgckJyYWNrZXQpO1xyXG4gICAgICAgIC8vIE11bHRpcGxlIGRpdmlkZXJzIGFyZSBub3Qgc3VwcG9ydGVkXHJcbiAgICAgICAgaWYgKG9wdGlvbnMuaW5kZXhPZignfCcpICE9PSBvcHRpb25zLmxhc3RJbmRleE9mKCd8JykpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGdhbWUuaTE4bi5sb2NhbGl6ZSgnUERGT1VORFJZLkVOUklDSC5JbnZhbGlkRm9ybWF0JykpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGxpbmtUZXh0ID0gZW5yaWNoTWUuc2xpY2UobEN1cmx5ICsgMSwgckN1cmx5KTtcclxuICAgICAgICAvLyBFbXB0eSBuYW1lcyBhcmUgbm90IHN1cHBvcnRlZFxyXG4gICAgICAgIGlmIChsaW5rVGV4dCA9PT0gdW5kZWZpbmVkIHx8IGxpbmtUZXh0ID09PSAnJykge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZ2FtZS5pMThuLmxvY2FsaXplKCdQREZPVU5EUlkuRU5SSUNILkVtcHR5TGlua1RleHQnKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgcGFnZU51bWJlciA9IDE7XHJcbiAgICAgICAgY29uc3QgW25hbWVPckNvZGUsIHF1ZXJ5U3RyaW5nXSA9IG9wdGlvbnMuc3BsaXQoJ3wnKTtcclxuXHJcbiAgICAgICAgLy8gR2V0dGluZyB0aGUgUERGIHdpdGhvdXQgaW52aXNpYmxlIFBERnMgdG8gY2hlY2sgcGVybWlzc2lvbnNcclxuICAgICAgICBsZXQgcGRmRGF0YSA9IEFwaS5nZXRQREZEYXRhKChpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBpdGVtLm5hbWUgPT09IG5hbWVPckNvZGUgfHwgaXRlbS5kYXRhLmRhdGEuY29kZSA9PT0gbmFtZU9yQ29kZTtcclxuICAgICAgICB9LCBmYWxzZSk7XHJcblxyXG4gICAgICAgIGlmIChwZGZEYXRhKSB7XHJcbiAgICAgICAgICAgIC8vIENhc2UgMSAtIFVzZXIgaGFzIHBlcm1pc3Npb25zIHRvIHNlZSB0aGUgUERGXHJcbiAgICAgICAgICAgIGlmIChxdWVyeVN0cmluZyAhPT0gdW5kZWZpbmVkICYmIHF1ZXJ5U3RyaW5nICE9PSAnJykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgW18sIHBhZ2VTdHJpbmddID0gcXVlcnlTdHJpbmcuc3BsaXQoJz0nKTtcclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFnZU51bWJlciA9IHBhcnNlSW50KHBhZ2VTdHJpbmcpO1xyXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgcGFnZSBudW1iZXJcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHBhZ2VOdW1iZXIgPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQREZPVU5EUlkuRVJST1IuUGFnZU11c3RCZVBvc2l0aXZlJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGkxOG5PcGVuID0gZ2FtZS5pMThuLmxvY2FsaXplKCdQREZPVU5EUlkuRU5SSUNILkxpbmtUaXRsZU9wZW4nKTtcclxuICAgICAgICAgICAgY29uc3QgaTE4blBhZ2UgPSBnYW1lLmkxOG4ubG9jYWxpemUoJ1BERk9VTkRSWS5FTlJJQ0guTGlua1RpdGxlUGFnZScpO1xyXG4gICAgICAgICAgICBjb25zdCBsaW5rVGl0bGUgPSBgJHtpMThuT3Blbn0gJHtuYW1lT3JDb2RlfSAke2kxOG5QYWdlfSAke3BhZ2VOdW1iZXJ9YDtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYDxhIGNsYXNzPVwicGRmb3VuZHJ5LWxpbmtcIiB0aXRsZT1cIiR7bGlua1RpdGxlfVwiIGRhdGEtcmVmPVwiJHtuYW1lT3JDb2RlfVwiIGRhdGEtcGFnZT1cIiR7cGFnZU51bWJlcn1cIj4ke2xpbmtUZXh0fTwvYT5gO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RleHQuc2xpY2UoMCwgdGhpcy5fc1BvcykgKyByZXN1bHQgKyB0aGlzLl90ZXh0LnNsaWNlKHRoaXMuX2VQb3MgKyAxKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBDYXNlIDIgLSBVc2VyIGRvZXMgbm90IGhhdmUgcGVybWlzc2lvbnMgdG8gc2VlIHRoZSBQREZcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RleHQuc2xpY2UoMCwgdGhpcy5fc1BvcykgKyBsaW5rVGV4dCArIHRoaXMuX3RleHQuc2xpY2UodGhpcy5fZVBvcyArIDEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJpbXBvcnQgeyBnZXRQREZEYXRhRnJvbUl0ZW0sIGlzUERGIH0gZnJvbSAnLi4vVXRpbCc7XHJcblxyXG4vKipcclxuICogQHByaXZhdGVcclxuICogQSBwbHVnaW4gZm9yIFRpbnlNQ0UgdGhhdCBoYW5kbGVzIERyYWcgKyBEcm9wXHJcbiAqL1xyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUaW55TUNFUGx1Z2luIHtcclxuICAgIHByaXZhdGUgc3RhdGljIHBsdWdpbk5hbWUgPSAnUERGb3VuZHJ5X0hUTUxFbnJpY2hfRHJvcCc7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZWdpc3RlciBwbHVnaW4gd2l0aCBGb3VuZHJ5ICsgVGlueU1DRVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIFJlZ2lzdGVyKCkge1xyXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICB0aW55TUNFLlBsdWdpbk1hbmFnZXIuYWRkKFRpbnlNQ0VQbHVnaW4ucGx1Z2luTmFtZSwgZnVuY3Rpb24gKGVkaXRvcikge1xyXG4gICAgICAgICAgICBlZGl0b3Iub24oJ0JlZm9yZVNldENvbnRlbnQnLCAoZXZlbnQpID0+IFRpbnlNQ0VQbHVnaW4uSGFuZGxlKGV2ZW50KSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgQ09ORklHLlRpbnlNQ0UucGx1Z2lucyA9IGAke1RpbnlNQ0VQbHVnaW4ucGx1Z2luTmFtZX0gJHtDT05GSUcuVGlueU1DRS5wbHVnaW5zfWA7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgSGFuZGxlKGV2ZW50OiBhbnkpIHtcclxuICAgICAgICBpZiAoZXZlbnQuaW5pdGlhbCkgcmV0dXJuO1xyXG4gICAgICAgIGlmICghZXZlbnQuc2VsZWN0aW9uIHx8IGV2ZW50LnNldCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGluaXRpYWxDb250ZW50ID0gZXZlbnQuY29udGVudDtcclxuXHJcbiAgICAgICAgY29uc3QgbEJyYWNrZXQgPSBpbml0aWFsQ29udGVudC5pbmRleE9mKCdbJyk7XHJcbiAgICAgICAgY29uc3QgckJyYWNrZXQgPSBpbml0aWFsQ29udGVudC5pbmRleE9mKCddJyk7XHJcbiAgICAgICAgY29uc3QgZW50aXR5SWQgPSBpbml0aWFsQ29udGVudC5zbGljZShsQnJhY2tldCArIDEsIHJCcmFja2V0KTtcclxuXHJcbiAgICAgICAgY29uc3QgZW50aXR5ID0gZ2FtZS5pdGVtcy5nZXQoZW50aXR5SWQpO1xyXG4gICAgICAgIGlmIChlbnRpdHkgPT09IG51bGwgfHwgIWlzUERGKGVudGl0eSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcGRmRGF0YSA9IGdldFBERkRhdGFGcm9tSXRlbShlbnRpdHkpO1xyXG4gICAgICAgIGlmICghcGRmRGF0YSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBjb2RlT3JOYW1lID0gcGRmRGF0YS5jb2RlID8gcGRmRGF0YS5jb2RlIDogcGRmRGF0YS5uYW1lO1xyXG5cclxuICAgICAgICBldmVudC5jb250ZW50ID0gYEBQREZbJHtjb2RlT3JOYW1lfXxwYWdlPTFdeyR7cGRmRGF0YS5uYW1lfX1gO1xyXG4gICAgfVxyXG59XHJcbiIsIi8qIENvcHlyaWdodCAyMDIwIEFuZHJldyBDdWNjaW5lbGxvXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuXHJcbmltcG9ydCBTZXR0aW5ncyBmcm9tICcuL1NldHRpbmdzJztcclxuXHJcbi8qKlxyXG4gKiBMb2NhbGl6YXRpb24gaGVscGVyXHJcbiAqIEBwcml2YXRlXHJcbiAqL1xyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBJMThuIHtcclxuICAgIC8qKlxyXG4gICAgICogTG9hZCB0aGUgbG9jYWxpemF0aW9uIGZpbGUgZm9yIHRoZSB1c2VyJ3MgbGFuZ3VhZ2UuXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgYXN5bmMgaW5pdGlhbGl6ZSgpIHtcclxuICAgICAgICBjb25zdCBsYW5nID0gZ2FtZS5pMThuLmxhbmc7XHJcbiAgICAgICAgLy8gdXNlcidzIGxhbmd1YWdlIHBhdGhcclxuICAgICAgICBjb25zdCB1X3BhdGggPSBgc3lzdGVtcy8ke1NldHRpbmdzLkRJU1RfUEFUSH0vbG9jYWxlLyR7bGFuZ30vY29uZmlnLmpzb25gO1xyXG4gICAgICAgIC8vIGVuZ2xpc2ggZmFsbGJhY2sgcGF0aFxyXG4gICAgICAgIGNvbnN0IGZfcGF0aCA9IGBzeXN0ZW1zLyR7U2V0dGluZ3MuRElTVF9QQVRIfS9sb2NhbGUvZW4vY29uZmlnLmpzb25gO1xyXG5cclxuICAgICAgICBsZXQganNvbjtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBqc29uID0gYXdhaXQgJC5nZXRKU09OKHVfcGF0aCk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgLy8gaWYgbm8gdHJhbnNsYXRpb24gZXhpdHMgZm9yIHRoZSB1c2VycyBsb2NhbGUgdGhlIGZhbGxiYWNrXHJcbiAgICAgICAgICAgIGpzb24gPSBhd2FpdCAkLmdldEpTT04oZl9wYXRoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKGpzb24pKSB7XHJcbiAgICAgICAgICAgIGdhbWUuaTE4bi50cmFuc2xhdGlvbnNba2V5XSA9IGpzb25ba2V5XTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHNldHVwIHRoZSBmYWxsYmFjayBhcyBlbmdsaXNoIHNvIHBhcnRpYWwgdHJhbnNsYXRpb25zIGRvIG5vdCBkaXNwbGF5IGtleXNcclxuICAgICAgICBsZXQgZmJfanNvbiA9IGF3YWl0ICQuZ2V0SlNPTihmX3BhdGgpO1xyXG4gICAgICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKGZiX2pzb24pKSB7XHJcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgICAgZ2FtZS5pMThuLl9mYWxsYmFja1trZXldID0ganNvbltrZXldO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCIvKiBDb3B5cmlnaHQgMjAyMCBBbmRyZXcgQ3VjY2luZWxsb1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcblxyXG4vKipcclxuICogSW50ZXJuYWwgc2V0dGluZ3MgYW5kIGhlbHBlciBtZXRob2RzIGZvciBQREZvdW5kcnkuXHJcbiAqIEBwcml2YXRlXHJcbiAqL1xyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTZXR0aW5ncyB7XHJcbiAgICAvKipcclxuICAgICAqIEFyZSBmZWVkYmFjayBub3RpZmljYXRpb25zIGVuYWJsZWQ/IERpc2FibGUgaWYgeW91IHdpc2hcclxuICAgICAqICB0byBoYW5kbGUgdGhlbSB5b3Vyc2VsZi5cclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBOT1RJRklDQVRJT05TOiBib29sZWFuID0gdHJ1ZTtcclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIEVYVEVSTkFMX1NZU1RFTV9OQU1FOiBzdHJpbmcgPSAnLi4vbW9kdWxlcy9wZGZvdW5kcnknO1xyXG4gICAgcHVibGljIHN0YXRpYyBJTlRFUk5BTF9NT0RVTEVfTkFNRTogc3RyaW5nID0gJ3BkZm91bmRyeSc7XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBESVNUX05BTUUgPSAncGRmb3VuZHJ5LWRpc3QnO1xyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgZ2V0IERJU1RfUEFUSCgpIHtcclxuICAgICAgICByZXR1cm4gYCR7U2V0dGluZ3MuRVhURVJOQUxfU1lTVEVNX05BTUV9LyR7U2V0dGluZ3MuRElTVF9OQU1FfWA7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBQREZfRU5USVRZX1RZUEU6IHN0cmluZyA9ICdQREZvdW5kcnlfUERGJztcclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIFNFVFRJTkdfS0VZID0ge1xyXG4gICAgICAgIEVYSVNUSU5HX1ZJRVdFUjogJ1Nob3dJbkV4aXN0aW5nVmlld2VyJyxcclxuICAgICAgICBDQUNIRV9TSVpFOiAnQ2FjaGVTaXplJyxcclxuICAgICAgICBIRUxQX1NFRU46ICdQREZvdW5kcnlfSGVscFNlZW4nLFxyXG4gICAgfTtcclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGdldCBTT0NLRVRfTkFNRSgpIHtcclxuICAgICAgICByZXR1cm4gYHN5c3RlbS4ke1NldHRpbmdzLkVYVEVSTkFMX1NZU1RFTV9OQU1FfWA7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBpbml0aWFsaXplKCkge1xyXG4gICAgICAgIFNldHRpbmdzLnJlZ2lzdGVyKFNldHRpbmdzLlNFVFRJTkdfS0VZLkNBQ0hFX1NJWkUsIHtcclxuICAgICAgICAgICAgbmFtZTogZ2FtZS5pMThuLmxvY2FsaXplKCdQREZPVU5EUlkuU0VUVElOR1MuQ2FjaGVTaXplTmFtZScpLFxyXG4gICAgICAgICAgICBzY29wZTogJ3VzZXInLFxyXG4gICAgICAgICAgICB0eXBlOiBOdW1iZXIsXHJcbiAgICAgICAgICAgIGhpbnQ6IGdhbWUuaTE4bi5sb2NhbGl6ZSgnUERGT1VORFJZLlNFVFRJTkdTLkNhY2hlU2l6ZUhpbnQnKSxcclxuICAgICAgICAgICAgZGVmYXVsdDogMjU2LFxyXG4gICAgICAgICAgICBjb25maWc6IHRydWUsXHJcbiAgICAgICAgICAgIG9uQ2hhbmdlOiBhc3luYyAobWIpID0+IHtcclxuICAgICAgICAgICAgICAgIG1iID0gTWF0aC5yb3VuZChtYik7XHJcbiAgICAgICAgICAgICAgICBtYiA9IE1hdGgubWF4KG1iLCA2NCk7XHJcbiAgICAgICAgICAgICAgICBtYiA9IE1hdGgubWluKG1iLCAxMDI0KTtcclxuICAgICAgICAgICAgICAgIGF3YWl0IFNldHRpbmdzLnNldChTZXR0aW5ncy5TRVRUSU5HX0tFWS5DQUNIRV9TSVpFLCBtYik7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIFNldHRpbmdzLnJlZ2lzdGVyKFNldHRpbmdzLlNFVFRJTkdfS0VZLkVYSVNUSU5HX1ZJRVdFUiwge1xyXG4gICAgICAgICAgICBuYW1lOiBnYW1lLmkxOG4ubG9jYWxpemUoJ1BERk9VTkRSWS5TRVRUSU5HUy5TaG93SW5FeGlzdGluZ1ZpZXdlck5hbWUnKSxcclxuICAgICAgICAgICAgc2NvcGU6ICd1c2VyJyxcclxuICAgICAgICAgICAgdHlwZTogQm9vbGVhbixcclxuICAgICAgICAgICAgaGludDogZ2FtZS5pMThuLmxvY2FsaXplKCdQREZPVU5EUlkuU0VUVElOR1MuU2hvd0luRXhpc3RpbmdWaWV3ZXJIaW50JyksXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IHRydWUsXHJcbiAgICAgICAgICAgIGNvbmZpZzogdHJ1ZSxcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFdyYXBwZXIgYXJvdW5kIGdhbWUuc2V0dGluZ3MucmVnaXN0ZXIuIEVuc3VyZXMgc2NvcGUgaXMgY29ycmVjdC5cclxuICAgICAqIEBwYXJhbSBrZXlcclxuICAgICAqIEBwYXJhbSBkYXRhXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgcmVnaXN0ZXIoa2V5OiBzdHJpbmcsIGRhdGE6IGFueSkge1xyXG4gICAgICAgIGdhbWUuc2V0dGluZ3MucmVnaXN0ZXIoU2V0dGluZ3MuRVhURVJOQUxfU1lTVEVNX05BTUUsIGtleSwgZGF0YSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBXcmFwcGVyIGFyb3VuZCBnYW1lLnNldHRpbmdzLmdldC4gRW5zdXJlcyBzY29wZSBpcyBjb3JyZWN0LlxyXG4gICAgICogQHBhcmFtIGtleVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGdldChrZXk6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiBnYW1lLnNldHRpbmdzLmdldChTZXR0aW5ncy5FWFRFUk5BTF9TWVNURU1fTkFNRSwga2V5KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFdyYXBwZXIgYXJvdW5kIGdhbWUuc2V0dGluZ3Muc2V0LiBFbnN1cmVzIHNjb3BlIGlzIGNvcnJlY3QuXHJcbiAgICAgKiBAcGFyYW0ga2V5XHJcbiAgICAgKiBAcGFyYW0gdmFsdWVcclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBhc3luYyBzZXQoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcclxuICAgICAgICByZXR1cm4gZ2FtZS5zZXR0aW5ncy5zZXQoU2V0dGluZ3MuRVhURVJOQUxfU1lTVEVNX05BTUUsIGtleSwgdmFsdWUpO1xyXG4gICAgfVxyXG59XHJcbiIsIi8qIENvcHlyaWdodCAyMDIwIEFuZHJldyBDdWNjaW5lbGxvXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuXHJcbmltcG9ydCBQcmVsb2FkRXZlbnQgZnJvbSAnLi9ldmVudHMvUHJlbG9hZEV2ZW50JztcclxuaW1wb3J0IFZpZXdlciBmcm9tICcuLi92aWV3ZXIvVmlld2VyJztcclxuaW1wb3J0IEFwaSBmcm9tICcuLi9BcGknO1xyXG5pbXBvcnQgU2V0dGluZ3MgZnJvbSAnLi4vc2V0dGluZ3MvU2V0dGluZ3MnO1xyXG5pbXBvcnQgU2V0Vmlld0V2ZW50IGZyb20gJy4vZXZlbnRzL1NldFZpZXdFdmVudCc7XHJcbmltcG9ydCBQREZDYWNoZSBmcm9tICcuLi9jYWNoZS9QREZDYWNoZSc7XHJcblxyXG4vKipcclxuICogQHByaXZhdGVcclxuICovXHJcbmV4cG9ydCBjbGFzcyBTb2NrZXQge1xyXG4gICAgcHVibGljIHN0YXRpYyBpbml0aWFsaXplKCkge1xyXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICBnYW1lLnNvY2tldC5vbihTZXR0aW5ncy5TT0NLRVRfTkFNRSwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgdXNlcklkcywgdHlwZSwgcGF5bG9hZCB9ID0gZXZlbnQ7XHJcbiAgICAgICAgICAgIC8vIG51bGwgPSBhbGwgdXNlcnMsIG90aGVyd2lzZSBjaGVjayBpZiB0aGlzIGV2ZW50IGVmZmVjdHMgdXNcclxuICAgICAgICAgICAgaWYgKHVzZXJJZHMgIT09IG51bGwgJiYgIXVzZXJJZHMuaW5jbHVkZXMoZ2FtZS51c2VySWQpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0eXBlID09PSBTZXRWaWV3RXZlbnQuRVZFTlRfVFlQRSkge1xyXG4gICAgICAgICAgICAgICAgU29ja2V0LmhhbmRsZVNldFZpZXcocGF5bG9hZCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gUHJlbG9hZEV2ZW50LkVWRU5UX1RZUEUpIHtcclxuICAgICAgICAgICAgICAgIFNvY2tldC5oYW5kbGVQcmVsb2FkUERGKHBheWxvYWQpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGUuaW5jbHVkZXMoJ1BERk9VTkRSWScpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRXZlbnQgb2YgdHlwZSAke3R5cGV9IGhhcyBubyBoYW5kbGVyLmApO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgaGFuZGxlU2V0VmlldyhkYXRhOiBhbnkpIHtcclxuICAgICAgICBpZiAoU2V0dGluZ3MuZ2V0KFNldHRpbmdzLlNFVFRJTkdfS0VZLkVYSVNUSU5HX1ZJRVdFUikpIHtcclxuICAgICAgICAgICAgZnVuY3Rpb24gYXBwSXNWaWV3ZXIoYXBwOiBBcHBsaWNhdGlvbik6IGFwcCBpcyBWaWV3ZXIge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFwcFsncGRmRGF0YSddICE9PSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgYXBwIG9mIE9iamVjdC52YWx1ZXModWkud2luZG93cykpIHtcclxuICAgICAgICAgICAgICAgIGlmICghYXBwSXNWaWV3ZXIoYXBwKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IHBkZkRhdGEgPSBhcHAucGRmRGF0YTtcclxuICAgICAgICAgICAgICAgIGlmIChkYXRhLnBkZkRhdGEudXJsID09PSBwZGZEYXRhLnVybCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFwcC5wYWdlID0gZGF0YS5wYWdlO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBBcHAgbm90IGZvdW5kLCBmYWxsIHRocm91Z2guXHJcbiAgICAgICAgfVxyXG4gICAgICAgIEFwaS5vcGVuUERGKGRhdGEucGRmRGF0YSwgZGF0YS5wYWdlKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGhhbmRsZVByZWxvYWRQREYoZGF0YTogYW55KSB7XHJcbiAgICAgICAgUERGQ2FjaGUucHJlbG9hZChkYXRhLnVybCk7XHJcbiAgICB9XHJcbn1cclxuIiwiLyogQ29weXJpZ2h0IDIwMjAgQW5kcmV3IEN1Y2NpbmVsbG9cclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5cclxuaW1wb3J0IFNvY2tldEV2ZW50IGZyb20gJy4vU29ja2V0RXZlbnQnO1xyXG5cclxuLyoqXHJcbiAqIEBwcml2YXRlXHJcbiAqL1xyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQcmVsb2FkRXZlbnQgZXh0ZW5kcyBTb2NrZXRFdmVudCB7XHJcbiAgICBwdWJsaWMgc3RhdGljIGdldCBFVkVOVF9UWVBFKCkge1xyXG4gICAgICAgIHJldHVybiBgJHtzdXBlci5FVkVOVF9UWVBFfS9QUkVMT0FEX1BERmA7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHR5cGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIFByZWxvYWRFdmVudC5FVkVOVF9UWVBFO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyB1cmw6IHN0cmluZztcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih1c2VySWRzOiBzdHJpbmdbXSB8IG51bGwsIHVybDogc3RyaW5nKSB7XHJcbiAgICAgICAgc3VwZXIodXNlcklkcyk7XHJcblxyXG4gICAgICAgIHRoaXMudXJsID0gdXJsO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBnZXRQYXlsb2FkKCk6IGFueSB7XHJcbiAgICAgICAgY29uc3QgcGF5bG9hZCA9IHN1cGVyLmdldFBheWxvYWQoKTtcclxuICAgICAgICBwYXlsb2FkLnVybCA9IHRoaXMudXJsO1xyXG4gICAgICAgIHJldHVybiBwYXlsb2FkO1xyXG4gICAgfVxyXG59XHJcbiIsIi8qIENvcHlyaWdodCAyMDIwIEFuZHJldyBDdWNjaW5lbGxvXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuXHJcbmltcG9ydCBTb2NrZXRFdmVudCBmcm9tICcuL1NvY2tldEV2ZW50JztcclxuaW1wb3J0IHsgUERGRGF0YSB9IGZyb20gJy4uLy4uL2NvbW1vbi90eXBlcy9QREZEYXRhJztcclxuXHJcbi8qKlxyXG4gKiBAcHJpdmF0ZVxyXG4gKi9cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2V0Vmlld0V2ZW50IGV4dGVuZHMgU29ja2V0RXZlbnQge1xyXG4gICAgcHVibGljIHN0YXRpYyBnZXQgRVZFTlRfVFlQRSgpIHtcclxuICAgICAgICByZXR1cm4gYCR7c3VwZXIuRVZFTlRfVFlQRX0vU0VUX1ZJRVdgO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB0eXBlKCkge1xyXG4gICAgICAgIHJldHVybiBTZXRWaWV3RXZlbnQuRVZFTlRfVFlQRTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcGFnZTogbnVtYmVyO1xyXG4gICAgcHVibGljIHBkZkRhdGE6IFBERkRhdGE7XHJcblxyXG4gICAgY29uc3RydWN0b3IodXNlcklkczogc3RyaW5nW10gfCBudWxsLCBwZGZEYXRhOiBQREZEYXRhLCBwYWdlOiBudW1iZXIpIHtcclxuICAgICAgICBzdXBlcih1c2VySWRzKTtcclxuXHJcbiAgICAgICAgdGhpcy5wZGZEYXRhID0gcGRmRGF0YTtcclxuICAgICAgICB0aGlzLnBhZ2UgPSBwYWdlO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBnZXRQYXlsb2FkKCkge1xyXG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSBzdXBlci5nZXRQYXlsb2FkKCk7XHJcbiAgICAgICAgcGF5bG9hZC5wZGZEYXRhID0gdGhpcy5wZGZEYXRhO1xyXG4gICAgICAgIHBheWxvYWQucGFnZSA9IHRoaXMucGFnZTtcclxuICAgICAgICByZXR1cm4gcGF5bG9hZDtcclxuICAgIH1cclxufVxyXG4iLCIvKiBDb3B5cmlnaHQgMjAyMCBBbmRyZXcgQ3VjY2luZWxsb1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcblxyXG5pbXBvcnQgU2V0dGluZ3MgZnJvbSAnLi4vLi4vc2V0dGluZ3MvU2V0dGluZ3MnO1xyXG5cclxuLyoqXHJcbiAqIEBwcml2YXRlXHJcbiAqL1xyXG5leHBvcnQgZGVmYXVsdCBhYnN0cmFjdCBjbGFzcyBTb2NrZXRFdmVudCB7XHJcbiAgICAvKipcclxuICAgICAqIFRoZSB0eXBlIG9mIHRoaXMgZXZlbnQuXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgZ2V0IEVWRU5UX1RZUEUoKSB7XHJcbiAgICAgICAgcmV0dXJuICdQREZPVU5EUlknO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogVGhlIHR5cGUgb2YgdGhpcyBldmVudC5cclxuICAgICAqL1xyXG4gICAgcHVibGljIGFic3RyYWN0IGdldCB0eXBlKCk7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgdXNlciBpZHMgdGhhdCBzaG91bGQgaGFuZGxlIHRoaXMgZXZlbnQuXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCB1c2VySWRzOiBzdHJpbmdbXSB8IG51bGw7XHJcblxyXG4gICAgcHJvdGVjdGVkIGNvbnN0cnVjdG9yKHVzZXJJZHM6IHN0cmluZ1tdIHwgbnVsbCkge1xyXG4gICAgICAgIHRoaXMudXNlcklkcyA9IHVzZXJJZHM7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXQgYW55IGRhdGEgdGhhdCB3aWxsIGJlIHNlbnQgd2l0aCB0aGUgZXZlbnQuXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBnZXRQYXlsb2FkKCk6IGFueSB7XHJcbiAgICAgICAgcmV0dXJuIHt9O1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBlbWl0KCkge1xyXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICBnYW1lLnNvY2tldC5lbWl0KFNldHRpbmdzLlNPQ0tFVF9OQU1FLCB7XHJcbiAgICAgICAgICAgIHR5cGU6IHRoaXMudHlwZSxcclxuICAgICAgICAgICAgdXNlcklkczogdGhpcy51c2VySWRzLFxyXG4gICAgICAgICAgICBwYXlsb2FkOiB0aGlzLmdldFBheWxvYWQoKSxcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG4iLCIvKiBDb3B5cmlnaHQgMjAyMCBBbmRyZXcgQ3VjY2luZWxsb1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcblxyXG5pbXBvcnQgUGxheWVyU2VsZWN0IGZyb20gJy4uL2FwcC9QbGF5ZXJTZWxlY3QnO1xyXG5pbXBvcnQgeyBnZXRVc2VySWRzRXhjZXB0TWUgfSBmcm9tICcuLi9VdGlsJztcclxuaW1wb3J0IHsgUERGVmlld2VyRXZlbnQgfSBmcm9tICcuLi9jb21tb24vdHlwZXMvUERGSG9va3MnO1xyXG5pbXBvcnQgeyBQREZEYXRhIH0gZnJvbSAnLi4vY29tbW9uL3R5cGVzL1BERkRhdGEnO1xyXG5pbXBvcnQgeyBQREZqc1ZpZXdlciB9IGZyb20gJy4uL2NvbW1vbi90eXBlcy9QREZqc1ZpZXdlcic7XHJcbmltcG9ydCBTZXR0aW5ncyBmcm9tICcuLi9zZXR0aW5ncy9TZXR0aW5ncyc7XHJcbmltcG9ydCB7IFBERmpzRXZlbnRCdXMgfSBmcm9tICcuLi9jb21tb24vdHlwZXMvUERGanNFdmVudEJ1cyc7XHJcbmltcG9ydCBTZXRWaWV3RXZlbnQgZnJvbSAnLi4vc29ja2V0L2V2ZW50cy9TZXRWaWV3RXZlbnQnO1xyXG5pbXBvcnQgRXZlbnRTdG9yZSBmcm9tICcuLi9jb21tb24vaGVscGVycy9ldmVudHMnO1xyXG5cclxuLyoqXHJcbiAqIFRoZSBQREZvdW5kcnkgVmlld2VyIGNsYXNzIHByb3ZpZGVzIHRoZSBjb3JlIGxvZ2ljIG9wZW5pbmcgUERGcyBhbmQgYmluZGluZyB0aGVpciBldmVudHMuXHJcbiAqIFlvdSBjYW5ub3QgY3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIHRoaXMgY2xhc3MsIHlvdSBtdXN0IGRvIHNvIHdpdGggdGhlIEFQSS5cclxuICpcclxuICogU2VlIHtAbGluayBBcGkub3BlblBERn0sIHtAbGluayBBcGkub3BlblBERkJ5Q29kZX0sIHtAbGluayBBcGkub3BlblBERkJ5TmFtZX0sIHtAbGluayBBcGkub3BlblVSTH0gd2hpY2ggYWxsIHJldHVybiBhXHJcbiAqIHByb21pc2Ugd2hpY2ggcmVzb2x2ZSB3aXRoIGFuIGluc3RhbmNlIG9mIHRoaXMgY2xhc3MuXHJcbiAqL1xyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBWaWV3ZXIgZXh0ZW5kcyBBcHBsaWNhdGlvbiB7XHJcbiAgICBzdGF0aWMgZ2V0IGRlZmF1bHRPcHRpb25zKCkge1xyXG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSBzdXBlci5kZWZhdWx0T3B0aW9ucztcclxuICAgICAgICBvcHRpb25zLmNsYXNzZXMgPSBbJ2FwcCcsICd3aW5kb3ctYXBwJywgJ3BkZm91bmRyeS12aWV3ZXInXTtcclxuICAgICAgICBvcHRpb25zLnRlbXBsYXRlID0gYHN5c3RlbXMvJHtTZXR0aW5ncy5FWFRFUk5BTF9TWVNURU1fTkFNRX0vcGRmb3VuZHJ5LWRpc3QvdGVtcGxhdGVzL2FwcC9wZGYtdmlld2VyLmh0bWxgO1xyXG4gICAgICAgIG9wdGlvbnMudGl0bGUgPSBnYW1lLmkxOG4ubG9jYWxpemUoJ1BERk9VTkRSWS5WSUVXRVIuVmlld1BERicpO1xyXG4gICAgICAgIG9wdGlvbnMud2lkdGggPSA4LjUgKiAxMDAgKyA2NDtcclxuICAgICAgICBvcHRpb25zLmhlaWdodCA9IDExICogMTAwICsgNjQ7XHJcbiAgICAgICAgb3B0aW9ucy5yZXNpemFibGUgPSB0cnVlO1xyXG4gICAgICAgIHJldHVybiBvcHRpb25zO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBfZnJhbWU6IEhUTUxJRnJhbWVFbGVtZW50O1xyXG4gICAgcHJvdGVjdGVkIF92aWV3ZXI6IFBERmpzVmlld2VyO1xyXG4gICAgcHJvdGVjdGVkIF9ldmVudEJ1czogUERGanNFdmVudEJ1cztcclxuICAgIHByb3RlY3RlZCBfcGRmRGF0YTogUERGRGF0YTtcclxuICAgIHByb3RlY3RlZCBfZXZlbnRTdG9yZTogRXZlbnRTdG9yZTxQREZWaWV3ZXJFdmVudD47XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAaW50ZXJuYWxcclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3IocGRmRGF0YT86IFBERkRhdGEsIG9wdGlvbnM/OiBBcHBsaWNhdGlvbk9wdGlvbnMpIHtcclxuICAgICAgICBzdXBlcihvcHRpb25zKTtcclxuXHJcbiAgICAgICAgaWYgKHBkZkRhdGEgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBwZGZEYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgbmFtZTogZ2FtZS5pMThuLmxvY2FsaXplKCdQREZPVU5EUlkuVklFV0VSLlRpdGxlJyksXHJcbiAgICAgICAgICAgICAgICBjb2RlOiAnJyxcclxuICAgICAgICAgICAgICAgIG9mZnNldDogMCxcclxuICAgICAgICAgICAgICAgIHVybDogJycsXHJcbiAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl9wZGZEYXRhID0gcGRmRGF0YTtcclxuICAgICAgICB0aGlzLl9ldmVudFN0b3JlID0gbmV3IEV2ZW50U3RvcmU8UERGVmlld2VyRXZlbnQ+KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gPGVkaXRvci1mb2xkIGRlc2M9XCJHZXR0ZXJzICYgU2V0dGVyc1wiPlxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyBhIGNvcHkgb2YgdGhlIFBERkRhdGEgdGhpcyB2aWV3ZXIgaXMgdXNpbmcuXHJcbiAgICAgKiBDaGFuZ2VzIHRvIHRoaXMgZGF0YSB3aWxsIG5vdCByZWZsZWN0IGluIHRoZSB2aWV3ZXIuXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXQgcGRmRGF0YSgpIHtcclxuICAgICAgICByZXR1cm4gZHVwbGljYXRlKHRoaXMuX3BkZkRhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0IHRoZSBjdXJyZW50bHkgdmlld2VkIHBhZ2UuXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXQgcGFnZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmlld2VyLnBhZ2U7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTZXQgdGhlIGN1cnJlbnRseSB2aWV3ZWQgcGFnZS5cclxuICAgICAqIEBwYXJhbSB2YWx1ZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2V0IHBhZ2UodmFsdWU6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMuX3ZpZXdlci5wYWdlID0gdmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gPC9lZGl0b3ItZm9sZD5cclxuXHJcbiAgICAvLyA8ZWRpdG9yLWZvbGQgZGVzYz1cIkZvdW5kcnkgT3ZlcnJpZGVzXCI+XHJcblxyXG4gICAgcHVibGljIGdldCB0aXRsZSgpOiBzdHJpbmcge1xyXG4gICAgICAgIGxldCB0aXRsZSA9IHRoaXMuX3BkZkRhdGEubmFtZTtcclxuICAgICAgICBpZiAodGhpcy5fcGRmRGF0YS5jb2RlICE9PSAnJykge1xyXG4gICAgICAgICAgICB0aXRsZSA9IGAke3RpdGxlfSAoJHt0aGlzLl9wZGZEYXRhLmNvZGV9KWA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aXRsZTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgX2dldEhlYWRlckJ1dHRvbnMoKTogYW55W10ge1xyXG4gICAgICAgIGNvbnN0IGJ1dHRvbnMgPSBzdXBlci5fZ2V0SGVhZGVyQnV0dG9ucygpO1xyXG4gICAgICAgIC8vVE9ETzogU3RhbmRhcmRpemUgdGhpcyB0byBmdW5jdGlvbiB3LyB0aGUgSXRlbSBzaGVldCBvbmVcclxuICAgICAgICBidXR0b25zLnVuc2hpZnQoe1xyXG4gICAgICAgICAgICBjbGFzczogJ3BkZi1zaGVldC1naXRodWInLFxyXG4gICAgICAgICAgICBpY29uOiAnZmFzIGZhLWV4dGVybmFsLWxpbmstYWx0JyxcclxuICAgICAgICAgICAgbGFiZWw6ICdQREZvdW5kcnknLFxyXG4gICAgICAgICAgICBvbmNsaWNrOiAoKSA9PiB3aW5kb3cub3BlbignaHR0cHM6Ly9naXRodWIuY29tL0RqcGhvZW5peDcxOS9QREZvdW5kcnknLCAnX2JsYW5rJyksXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGJ1dHRvbnMudW5zaGlmdCh7XHJcbiAgICAgICAgICAgIGNsYXNzOiAncGRmLXNoZWV0LXNob3ctcGxheWVycycsXHJcbiAgICAgICAgICAgIGljb246ICdmYXMgZmEtZXllJyxcclxuICAgICAgICAgICAgbGFiZWw6IGdhbWUuaTE4bi5sb2NhbGl6ZSgnUERGT1VORFJZLlZJRVdFUi5TaG93VG9QbGF5ZXJzVGV4dCcpLFxyXG4gICAgICAgICAgICBvbmNsaWNrOiAoZXZlbnQpID0+IHRoaXMuc2hvd1RvKGV2ZW50KSxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGJ1dHRvbnM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldERhdGEob3B0aW9ucz86IGFueSk6IGFueSB8IFByb21pc2U8YW55PiB7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IHN1cGVyLmdldERhdGEob3B0aW9ucyk7XHJcbiAgICAgICAgZGF0YS5zeXN0ZW1OYW1lID0gU2V0dGluZ3MuRVhURVJOQUxfU1lTVEVNX05BTUU7XHJcbiAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIGFzeW5jIGFjdGl2YXRlTGlzdGVuZXJzKGh0bWw6IEpRdWVyeSk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgICAgIHRoaXMuX2V2ZW50U3RvcmUuZmlyZSgndmlld2VyT3BlbmluZycsIHRoaXMpO1xyXG4gICAgICAgIHN1cGVyLmFjdGl2YXRlTGlzdGVuZXJzKGh0bWwpO1xyXG5cclxuICAgICAgICB0aGlzLl9mcmFtZSA9IGh0bWwucGFyZW50KCkuZmluZCgnaWZyYW1lLnBkZlZpZXdlcicpLmdldCgwKSBhcyBIVE1MSUZyYW1lRWxlbWVudDtcclxuICAgICAgICB0aGlzLmdldFZpZXdlcigpLnRoZW4oYXN5bmMgKHZpZXdlcikgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl92aWV3ZXIgPSB2aWV3ZXI7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9ldmVudFN0b3JlLmZpcmUoJ3ZpZXdlck9wZW5lZCcsIHRoaXMpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5nZXRFdmVudEJ1cygpLnRoZW4oKGV2ZW50QnVzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ldmVudEJ1cyA9IGV2ZW50QnVzO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fZXZlbnRCdXMub24oJ3BhZ2VyZW5kZXJlZCcsIHRoaXMub25QYWdlUmVuZGVyZWQuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ldmVudEJ1cy5vbigncGFnZWNoYW5naW5nJywgdGhpcy5vblBhZ2VDaGFuZ2luZy5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2V2ZW50QnVzLm9uKCd1cGRhdGV2aWV3YXJlYScsIHRoaXMub25WaWV3QXJlYVVwZGF0ZWQuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ldmVudEJ1cy5vbignc2NhbGVjaGFuZ2luZycsIHRoaXMub25TY2FsZUNoYW5naW5nLmJpbmQodGhpcykpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIGNvbnN0IGxpc3RlbmVycyA9IGV2ZW50QnVzLl9saXN0ZW5lcnM7XHJcbiAgICAgICAgICAgICAgICAvLyBmb3IgKGNvbnN0IGV2ZW50TmFtZSBvZiBPYmplY3Qua2V5cyhsaXN0ZW5lcnMpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgZXZlbnRCdXMub24oZXZlbnROYW1lLCAoLi4uYXJncykgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICBWaWV3ZXIubG9nRXZlbnQoZXZlbnROYW1lLCBhcmdzKTtcclxuICAgICAgICAgICAgICAgIC8vICAgICB9KTtcclxuICAgICAgICAgICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ldmVudFN0b3JlLmZpcmUoJ3ZpZXdlclJlYWR5JywgdGhpcyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBfZ2V0SGVhZGVyQnV0dG9ucyBkb2VzIG5vdCBwZXJtaXQgdGl0bGVzLi4uXHJcbiAgICAgICAgJChodG1sKS5wYXJlbnRzKCkucGFyZW50cygpLmZpbmQoJy5wZGYtc2hlZXQtc2hvdy1wbGF5ZXJzJykucHJvcCgndGl0bGUnLCBnYW1lLmkxOG4ubG9jYWxpemUoJ1BERk9VTkRSWS5WSUVXRVIuU2hvd1RvUGxheWVyc1RpdGxlJykpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIDwvZWRpdG9yLWZvbGQ+XHJcblxyXG4gICAgLy8gPGVkaXRvci1mb2xkIGRlc2M9XCJFdmVudHNcIj5cclxuXHJcbiAgICBwcm90ZWN0ZWQgb25QYWdlQ2hhbmdpbmcoZXZlbnQpIHtcclxuICAgICAgICB0aGlzLl9ldmVudFN0b3JlLmZpcmUoJ3BhZ2VDaGFuZ2luZycsIHRoaXMsIHtcclxuICAgICAgICAgICAgcGFnZUxhYmVsOiBldmVudC5wYWdlTGFiZWwsXHJcbiAgICAgICAgICAgIHBhZ2VOdW1iZXI6IGV2ZW50LnBhZ2VOdW1iZXIsXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIG9uUGFnZVJlbmRlcmVkKGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5fZXZlbnRTdG9yZS5maXJlKCdwYWdlUmVuZGVyZWQnLCB0aGlzLCB7XHJcbiAgICAgICAgICAgIHBhZ2VOdW1iZXI6IGV2ZW50LnBhZ2VOdW1iZXIsXHJcbiAgICAgICAgICAgIHBhZ2VMYWJlbDogZXZlbnQuc291cmNlLnBhZ2VMYWJlbCxcclxuICAgICAgICAgICAgd2lkdGg6IGV2ZW50LnNvdXJjZS53aWR0aCxcclxuICAgICAgICAgICAgaGVpZ2h0OiBldmVudC5zb3VyY2UuaGVpZ2h0LFxyXG4gICAgICAgICAgICByb3RhdGlvbjogZXZlbnQuc291cmNlLnJvdGF0aW9uLFxyXG4gICAgICAgICAgICBzY2FsZTogZXZlbnQuc291cmNlLnNjYWxlLFxyXG4gICAgICAgICAgICBjYW52YXM6IGV2ZW50LnNvdXJjZS5jYW52YXMsXHJcbiAgICAgICAgICAgIGRpdjogZXZlbnQuc291cmNlLmRpdixcclxuICAgICAgICAgICAgZXJyb3I6IGV2ZW50LnNvdXJjZS5lcnJvcixcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgb25WaWV3QXJlYVVwZGF0ZWQoZXZlbnQpIHtcclxuICAgICAgICB0aGlzLl9ldmVudFN0b3JlLmZpcmUoJ3ZpZXdBcmVhVXBkYXRlZCcsIHRoaXMsIHtcclxuICAgICAgICAgICAgdG9wOiBldmVudC5sb2NhdGlvbi50b3AsXHJcbiAgICAgICAgICAgIGxlZnQ6IGV2ZW50LmxvY2F0aW9uLmxlZnQsXHJcbiAgICAgICAgICAgIHBhZ2VOdW1iZXI6IGV2ZW50LmxvY2F0aW9uLnBhZ2VOdW1iZXIsXHJcbiAgICAgICAgICAgIHJvdGF0aW9uOiBldmVudC5sb2NhdGlvbi5yb3RhdGlvbixcclxuICAgICAgICAgICAgc2NhbGU6IGV2ZW50LmxvY2F0aW9uLnNjYWxlLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBvblNjYWxlQ2hhbmdpbmcoZXZlbnQpIHtcclxuICAgICAgICB0aGlzLl9ldmVudFN0b3JlLmZpcmUoJ3NjYWxlQ2hhbmdpbmcnLCB0aGlzLCB7XHJcbiAgICAgICAgICAgIHByZXNldFZhbHVlOiBldmVudC5wcmVzZXRWYWx1ZSxcclxuICAgICAgICAgICAgc2NhbGU6IGV2ZW50LnNjYWxlLFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmVnaXN0ZXIgYSBjYWxsYmFjayB0byBvY2N1ciB3aGVuIGFuIGV2ZW50IGZpcmVzLiBTZWUgaW5kaXZpZHVhbCBldmVudHMgZm9yIGRlc2NyaXB0aW9ucyBhbmQgdXNlIHtAbGluayBBcGkuREVCVUcuRVZFTlRTfSB0byBsb2cgYW5kIGFuYWx5emUgZXZlbnRzLlxyXG4gICAgICogQHBhcmFtIGV2ZW50TmFtZVxyXG4gICAgICogQHBhcmFtIGNhbGxiYWNrXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvbihldmVudE5hbWU6IFBERlZpZXdlckV2ZW50LCBjYWxsYmFjazogRnVuY3Rpb24pOiB2b2lkIHtcclxuICAgICAgICB0aGlzLl9ldmVudFN0b3JlLm9uKGV2ZW50TmFtZSwgY2FsbGJhY2spO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogRGVyZWdpc3RlciBhbiBldmVudCB0aGF0IGhhcyBiZWVuIHJlZ2lzdGVyZWQgd2l0aCB7QGxpbmsgb259IG9yIHtAbGluayBvbmNlfS5cclxuICAgICAqIEBwYXJhbSBldmVudE5hbWVcclxuICAgICAqIEBwYXJhbSBjYWxsYmFja1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgb2ZmKGV2ZW50TmFtZTogUERGVmlld2VyRXZlbnQsIGNhbGxiYWNrOiBGdW5jdGlvbik6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuX2V2ZW50U3RvcmUub2ZmKGV2ZW50TmFtZSwgY2FsbGJhY2spO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogTGlrZSB7QGxpbmsgb259IGJ1dCBvbmx5IGZpcmVzIG9uIHRoZSBuZXh0IG9jY3VycmVuY2UuXHJcbiAgICAgKiBAcGFyYW0gZXZlbnROYW1lXHJcbiAgICAgKiBAcGFyYW0gY2FsbGJhY2tcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9uY2UoZXZlbnROYW1lOiBQREZWaWV3ZXJFdmVudCwgY2FsbGJhY2s6IEZ1bmN0aW9uKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5fZXZlbnRTdG9yZS5vbmNlKGV2ZW50TmFtZSwgY2FsbGJhY2spO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIDwvZWRpdG9yLWZvbGQ+XHJcblxyXG4gICAgLy8gcHJpdmF0ZSBzdGF0aWMgbG9nRXZlbnQoa2V5OiBzdHJpbmcsIC4uLmFyZ3MpIHtcclxuICAgIC8vICAgICBjb25zb2xlLndhcm4oa2V5KTtcclxuICAgIC8vICAgICBjb25zb2xlLndhcm4oYXJncyk7XHJcbiAgICAvLyB9XHJcblxyXG4gICAgcHVibGljIGFzeW5jIGNsb3NlKCk6IFByb21pc2U8YW55PiB7XHJcbiAgICAgICAgdGhpcy5fZXZlbnRTdG9yZS5maXJlKCd2aWV3ZXJDbG9zZWQnLCB0aGlzKTtcclxuICAgICAgICByZXR1cm4gc3VwZXIuY2xvc2UoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFNob3cgdGhlIGN1cnJlbnQgcGFnZSB0byBHTXMuXHJcbiAgICAgKi9cclxuICAgIHByb3RlY3RlZCBzaG93VG8oZXZlbnQ6IE1vdXNlRXZlbnQpIHtcclxuICAgICAgICBjb25zdCBwZGZEYXRhID0gdGhpcy5wZGZEYXRhO1xyXG4gICAgICAgIHBkZkRhdGEub2Zmc2V0ID0gMDtcclxuXHJcbiAgICAgICAgY29uc3QgaWRzID0gZ2V0VXNlcklkc0V4Y2VwdE1lKCk7XHJcbiAgICAgICAgaWYgKGV2ZW50LnNoaWZ0S2V5KSB7XHJcbiAgICAgICAgICAgIG5ldyBTZXRWaWV3RXZlbnQoaWRzLCBwZGZEYXRhLCB0aGlzLnBhZ2UpLmVtaXQoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBuZXcgUGxheWVyU2VsZWN0KGlkcywgKGZpbHRlcmVkSWRzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBuZXcgU2V0Vmlld0V2ZW50KGZpbHRlcmVkSWRzLCBwZGZEYXRhLCB0aGlzLnBhZ2UpLmVtaXQoKTtcclxuICAgICAgICAgICAgfSkucmVuZGVyKHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFdhaXQgZm9yIHRoZSBpbnRlcm5hbCBQREZqcyB2aWV3ZXIgdG8gYmUgcmVhZHkgYW5kIHVzYWJsZS5cclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIGdldFZpZXdlcigpOiBQcm9taXNlPFBERmpzVmlld2VyPiB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3ZpZXdlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMuX3ZpZXdlcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8YW55PigocmVzb2x2ZSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgdGltZW91dDtcclxuICAgICAgICAgICAgY29uc3QgcmV0dXJuT3JXYWl0ID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gSWYgb3VyIHdpbmRvdyBoYXMgZmluaXNoZWQgaW5pdGlhbGl6aW5nLi4uXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZnJhbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBJZiBQREZqcyBoYXMgZmluaXNoZWQgaW5pdGlhbGl6aW5nLi4uXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2ZyYW1lLmNvbnRlbnRXaW5kb3cgJiYgdGhpcy5fZnJhbWUuY29udGVudFdpbmRvd1snUERGVmlld2VyQXBwbGljYXRpb24nXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2aWV3ZXIgPSB0aGlzLl9mcmFtZS5jb250ZW50V2luZG93WydQREZWaWV3ZXJBcHBsaWNhdGlvbiddO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHZpZXdlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gSWYgYW55IGlmcyBmYWxsIHRocm91Z2gsIHRyeSBhZ2FpbiBpbiBhIGZldyBtc1xyXG4gICAgICAgICAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQocmV0dXJuT3JXYWl0LCA1KTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgcmV0dXJuT3JXYWl0KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBXYWl0IGZvciB0aGUgaW50ZXJuYWwgUERGanMgZXZlbnRCdXMgdG8gYmUgcmVhZHkgYW5kIHVzYWJsZS5cclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIGdldEV2ZW50QnVzKCk6IFByb21pc2U8UERGanNFdmVudEJ1cz4ge1xyXG4gICAgICAgIGlmICh0aGlzLl9ldmVudEJ1cykge1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMuX2V2ZW50QnVzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxhbnk+KChyZXNvbHZlKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0Vmlld2VyKCkudGhlbigodmlld2VyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdGltZW91dDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJldHVybk9yV2FpdCA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodmlld2VyLmV2ZW50QnVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodmlld2VyLmV2ZW50QnVzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChyZXR1cm5PcldhaXQsIDUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHJldHVybk9yV2FpdCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEZpbmlzaCB0aGUgZG93bmxvYWQgYW5kIHJldHVybiB0aGUgYnl0ZSBhcnJheSBmb3IgdGhlIGZpbGUuXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBkb3dubG9hZCgpOiBQcm9taXNlPFVpbnQ4QXJyYXk+IHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8VWludDhBcnJheT4oYXN5bmMgKHJlc29sdmUpID0+IHtcclxuICAgICAgICAgICAgY29uc3Qgdmlld2VyID0gYXdhaXQgdGhpcy5nZXRWaWV3ZXIoKTtcclxuICAgICAgICAgICAgbGV0IHRpbWVvdXQ7XHJcbiAgICAgICAgICAgIGNvbnN0IHJldHVybk9yV2FpdCA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh2aWV3ZXIuZG93bmxvYWRDb21wbGV0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUodmlld2VyLnBkZkRvY3VtZW50LmdldERhdGEoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KHJldHVybk9yV2FpdCwgNTApO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICByZXR1cm5PcldhaXQoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIE9wZW4gYSBQREZcclxuICAgICAqIEBwYXJhbSBwZGZTb3VyY2UgQSBVUkwgb3IgYnl0ZSBhcnJheSB0byBvcGVuLlxyXG4gICAgICogQHBhcmFtIHBhZ2UgVGhlIGluaXRpYWwgcGFnZSB0byBvcGVuIHRvXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBhc3luYyBvcGVuKHBkZlNvdXJjZTogc3RyaW5nIHwgVWludDhBcnJheSwgcGFnZT86IG51bWJlcikge1xyXG4gICAgICAgIGNvbnN0IHBkZmpzVmlld2VyID0gYXdhaXQgdGhpcy5nZXRWaWV3ZXIoKTtcclxuXHJcbiAgICAgICAgaWYgKHBhZ2UpIHtcclxuICAgICAgICAgICAgcGRmanNWaWV3ZXIuaW5pdGlhbEJvb2ttYXJrID0gYHBhZ2U9JHtwYWdlfWA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhd2FpdCBwZGZqc1ZpZXdlci5vcGVuKHBkZlNvdXJjZSk7XHJcbiAgICB9XHJcbn1cclxuIl19"}